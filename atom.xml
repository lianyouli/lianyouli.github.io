<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>联友的Blog</title>
  <icon>https://lianyouli.gitee.io/icon.png</icon>
  <subtitle>密涅瓦的猫头鹰在黄昏起飞</subtitle>
  <link href="https://lianyouli.gitee.io/atom.xml" rel="self"/>
  
  <link href="https://lianyouli.gitee.io/"/>
  <updated>2022-03-29T13:11:16.734Z</updated>
  <id>https://lianyouli.gitee.io/</id>
  
  <author>
    <name>李联友</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Nifi集群安装</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-dataflow-nifi-cluster-installation/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-dataflow-nifi-cluster-installation/</id>
    <published>2022-03-29T10:02:06.000Z</published>
    <updated>2022-03-29T13:11:16.734Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Nifi集群HTTP模式安装时遇到的一些问题记录集</p><p>官网：<a href="https://nifi.apache.org/index.html" target="_blank" rel="noopener">Apache NiFi</a></p><p>集群配置文档：<a href="https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#clustering" target="_blank" rel="noopener">NiFi System Administrator’s Guide (apache.org)</a></p></blockquote><a id="more"></a><h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><p><strong>nifi-1.5.3</strong></p><p><strong>Mac</strong></p><p><strong>JDK1.8</strong></p><p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329211103224.png" alt="image-20220329211103224"></p><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210938014.png" alt="image-20220329210938014" style="zoom:50%;"><p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329211029825.png" alt="image-20220329211029825"></p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="bin-nifi-env-sh"><a href="#bin-nifi-env-sh" class="headerlink" title="bin/nifi-env.sh"></a>bin/nifi-env.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/Library/Java/JavaVirtualMachines/openjdk-8.jdk/Contents/Home</span><br></pre></td></tr></table></figure><h3 id="conf-nifi-properties"><a href="#conf-nifi-properties" class="headerlink" title="conf/nifi.properties"></a>conf/nifi.properties</h3><ol><li><p>Site to Site properties<br>这里关闭了secure配置</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329182918332.png" alt="image-20220329182918332" style="zoom:50%;"></li><li><p>Web properties</p><p>这里http与https只能配置一个，因为我配置的是http，所以https注释了。</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329182857162.png" alt="image-20220329182857162" style="zoom:50%;"></li><li><p>security properties<br><strong>nifi.sensitive.props.key</strong>长度有要求，12位长度以上。</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329182529892.png" alt="image-20220329182529892" style="zoom:50%;"></li><li><p>cluster common properties</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329205623271.png" alt="image-20220329205623271" style="zoom:50%;"></li><li><p>cluster node properties</p><p><strong>nifi.cluster.flow.election.max.wait.time</strong>和<strong>nifi.cluster.flow.election.max.candidates</strong>可以根据实际情况来设置，因为我这里只有一个节点。端口也按自己的情况设置。</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329205726775.png" alt="image-20220329205726775" style="zoom:50%;"></li><li><p>cluster load balancing properties</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329205954078.png" alt="image-20220329205954078" style="zoom:50%;"></li><li><p>zookeeper properties, used for cluster management </p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210057852.png" alt="image-20220329205954078" style="zoom:50%;"></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment"># contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment"># this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment"># (the "License"); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment"># the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Core Properties #</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.file</span>=<span class="string">./conf/flow.xml.gz</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.dir</span>=<span class="string">./conf/archive/</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.max.time</span>=<span class="string">30 days</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.max.storage</span>=<span class="string">500 MB</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.max.count</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.flowcontroller.autoResumeState</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.flowcontroller.graceful.shutdown.period</span>=<span class="string">10 sec</span></span><br><span class="line"><span class="meta">nifi.flowservice.writedelay.interval</span>=<span class="string">500 ms</span></span><br><span class="line"><span class="meta">nifi.administrative.yield.duration</span>=<span class="string">30 sec</span></span><br><span class="line"><span class="comment"># If a component has no work to do (is "bored"), how long should we wait before checking again for work?</span></span><br><span class="line"><span class="meta">nifi.bored.yield.duration</span>=<span class="string">10 millis</span></span><br><span class="line"><span class="meta">nifi.queue.backpressure.count</span>=<span class="string">10000</span></span><br><span class="line"><span class="meta">nifi.queue.backpressure.size</span>=<span class="string">1 GB</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.authorizer.configuration.file</span>=<span class="string">./conf/authorizers.xml</span></span><br><span class="line"><span class="meta">nifi.login.identity.provider.configuration.file</span>=<span class="string">./conf/login-identity-providers.xml</span></span><br><span class="line"><span class="meta">nifi.templates.directory</span>=<span class="string">./conf/templates</span></span><br><span class="line"><span class="meta">nifi.ui.banner.text</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.ui.autorefresh.interval</span>=<span class="string">30 sec</span></span><br><span class="line"><span class="meta">nifi.nar.library.directory</span>=<span class="string">./lib</span></span><br><span class="line"><span class="meta">nifi.nar.library.autoload.directory</span>=<span class="string">./extensions</span></span><br><span class="line"><span class="meta">nifi.nar.working.directory</span>=<span class="string">./work/nar/</span></span><br><span class="line"><span class="meta">nifi.documentation.working.directory</span>=<span class="string">./work/docs/components</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################</span></span><br><span class="line"><span class="comment"># State Management #</span></span><br><span class="line"><span class="comment">####################</span></span><br><span class="line"><span class="meta">nifi.state.management.configuration.file</span>=<span class="string">./conf/state-management.xml</span></span><br><span class="line"><span class="comment"># The ID of the local state provider</span></span><br><span class="line"><span class="meta">nifi.state.management.provider.local</span>=<span class="string">local-provider</span></span><br><span class="line"><span class="comment"># The ID of the cluster-wide state provider. This will be ignored if NiFi is not clustered but must be populated if running in a cluster.</span></span><br><span class="line"><span class="meta">nifi.state.management.provider.cluster</span>=<span class="string">zk-provider</span></span><br><span class="line"><span class="comment"># Specifies whether or not this instance of NiFi should run an embedded ZooKeeper server</span></span><br><span class="line"><span class="meta">nifi.state.management.embedded.zookeeper.start</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># Properties file that provides the ZooKeeper properties to use if &lt;nifi.state.management.embedded.zookeeper.start&gt; is set to true</span></span><br><span class="line"><span class="meta">nifi.state.management.embedded.zookeeper.properties</span>=<span class="string">./conf/zookeeper.properties</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># H2 Settings</span></span><br><span class="line"><span class="meta">nifi.database.directory</span>=<span class="string">./database_repository</span></span><br><span class="line"><span class="meta">nifi.h2.url.append</span>=<span class="string">;LOCK_TIMEOUT=25000;WRITE_DELAY=0;AUTO_SERVER=FALSE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Repository Encryption properties override individual repository implementation properties</span></span><br><span class="line"><span class="meta">nifi.repository.encryption.protocol.version</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.id</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.provider</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.provider.keystore.location</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.provider.keystore.password</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FlowFile Repository</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.implementation</span>=<span class="string">org.apache.nifi.controller.repository.WriteAheadFlowFileRepository</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.wal.implementation</span>=<span class="string">org.apache.nifi.wali.SequentialAccessWriteAheadLog</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.directory</span>=<span class="string">./flowfile_repository</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.checkpoint.interval</span>=<span class="string">20 secs</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.always.sync</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.retain.orphaned.flowfiles</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.swap.manager.implementation</span>=<span class="string">org.apache.nifi.controller.FileSystemSwapManager</span></span><br><span class="line"><span class="meta">nifi.queue.swap.threshold</span>=<span class="string">20000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Content Repository</span></span><br><span class="line"><span class="meta">nifi.content.repository.implementation</span>=<span class="string">org.apache.nifi.controller.repository.FileSystemRepository</span></span><br><span class="line"><span class="meta">nifi.content.claim.max.appendable.size</span>=<span class="string">1 MB</span></span><br><span class="line"><span class="meta">nifi.content.repository.directory.default</span>=<span class="string">./content_repository</span></span><br><span class="line"><span class="meta">nifi.content.repository.archive.max.retention.period</span>=<span class="string">7 days</span></span><br><span class="line"><span class="meta">nifi.content.repository.archive.max.usage.percentage</span>=<span class="string">50%</span></span><br><span class="line"><span class="meta">nifi.content.repository.archive.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.content.repository.always.sync</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.content.viewer.url</span>=<span class="string">../nifi-content-viewer/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Provenance Repository Properties</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.implementation</span>=<span class="string">org.apache.nifi.provenance.WriteAheadProvenanceRepository</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Persistent Provenance Repository Properties</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.directory.default</span>=<span class="string">./provenance_repository</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.max.storage.time</span>=<span class="string">30 days</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.max.storage.size</span>=<span class="string">10 GB</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.rollover.time</span>=<span class="string">10 mins</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.rollover.size</span>=<span class="string">100 MB</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.query.threads</span>=<span class="string">2</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.index.threads</span>=<span class="string">2</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.compress.on.rollover</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.always.sync</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># Comma-separated list of fields. Fields that are not indexed will not be searchable. Valid fields are:</span></span><br><span class="line"><span class="comment"># EventType, FlowFileUUID, Filename, TransitURI, ProcessorID, AlternateIdentifierURI, Relationship, Details</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.indexed.fields</span>=<span class="string">EventType, FlowFileUUID, Filename, ProcessorID, Relationship</span></span><br><span class="line"><span class="comment"># FlowFile Attributes that should be indexed and made searchable.  Some examples to consider are filename, uuid, mime.type</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.indexed.attributes</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># Large values for the shard size will result in more Java heap usage when searching the Provenance Repository</span></span><br><span class="line"><span class="comment"># but should provide better performance</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.index.shard.size</span>=<span class="string">500 MB</span></span><br><span class="line"><span class="comment"># Indicates the maximum length that a FlowFile attribute can be when retrieving a Provenance Event from</span></span><br><span class="line"><span class="comment"># the repository. If the length of any attribute exceeds this value, it will be truncated when the event is retrieved.</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.max.attribute.length</span>=<span class="string">65536</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.concurrent.merge.threads</span>=<span class="string">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Volatile Provenance Respository Properties</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.buffer.size</span>=<span class="string">100000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Component and Node Status History Repository</span></span><br><span class="line"><span class="meta">nifi.components.status.repository.implementation</span>=<span class="string">org.apache.nifi.controller.status.history.VolatileComponentStatusRepository</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Volatile Status History Repository Properties</span></span><br><span class="line"><span class="meta">nifi.components.status.repository.buffer.size</span>=<span class="string">1440</span></span><br><span class="line"><span class="meta">nifi.components.status.snapshot.frequency</span>=<span class="string">1 min</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># QuestDB Status History Repository Properties</span></span><br><span class="line"><span class="meta">nifi.status.repository.questdb.persist.node.days</span>=<span class="string">14</span></span><br><span class="line"><span class="meta">nifi.status.repository.questdb.persist.component.days</span>=<span class="string">3</span></span><br><span class="line"><span class="meta">nifi.status.repository.questdb.persist.location</span>=<span class="string">./status_repository</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site to Site properties</span></span><br><span class="line"><span class="meta">nifi.remote.input.host</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.remote.input.secure</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.remote.input.socket.port</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.remote.input.http.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.remote.input.http.transaction.ttl</span>=<span class="string">30 sec</span></span><br><span class="line"><span class="meta">nifi.remote.contents.cache.expiration</span>=<span class="string">30 secs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># web properties #</span></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For security, NiFi will present the UI on 127.0.0.1 and only be accessible through this loopback interface.</span></span><br><span class="line"><span class="comment"># Be aware that changing these properties may affect how your instance can be accessed without any restriction.</span></span><br><span class="line"><span class="comment"># We recommend configuring HTTPS instead. The administrators guide provides instructions on how to do this.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.web.http.host</span>=<span class="string">sleety.local</span></span><br><span class="line"><span class="meta">nifi.web.http.port</span>=<span class="string">18001</span></span><br><span class="line"><span class="meta">nifi.web.http.network.interface.default</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.web.https.host</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># 127.0.0.1</span></span><br><span class="line"><span class="meta">nifi.web.https.port</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># 8443</span></span><br><span class="line"><span class="meta">nifi.web.https.network.interface.default</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.jetty.working.directory</span>=<span class="string">./work/jetty</span></span><br><span class="line"><span class="meta">nifi.web.jetty.threads</span>=<span class="string">200</span></span><br><span class="line"><span class="meta">nifi.web.max.header.size</span>=<span class="string">16 KB</span></span><br><span class="line"><span class="meta">nifi.web.proxy.context.path</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.proxy.host</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.max.content.size</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.max.requests.per.second</span>=<span class="string">30000</span></span><br><span class="line"><span class="meta">nifi.web.max.access.token.requests.per.second</span>=<span class="string">25</span></span><br><span class="line"><span class="meta">nifi.web.request.timeout</span>=<span class="string">60 secs</span></span><br><span class="line"><span class="meta">nifi.web.request.ip.whitelist</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.should.send.server.version</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include or Exclude TLS Cipher Suites for HTTPS</span></span><br><span class="line"><span class="meta">nifi.web.https.ciphersuites.include</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.https.ciphersuites.exclude</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># security properties #</span></span><br><span class="line"><span class="meta">nifi.sensitive.props.key</span>=<span class="string">youchangeitok</span></span><br><span class="line"><span class="meta">nifi.sensitive.props.key.protected</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.sensitive.props.algorithm</span>=<span class="string">NIFI_PBKDF2_AES_GCM_256</span></span><br><span class="line"><span class="meta">nifi.sensitive.props.additional.keys</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.security.autoreload.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.autoreload.interval</span>=<span class="string">10 secs</span></span><br><span class="line"><span class="meta">nifi.security.keystore</span>=<span class="string">./conf/keystore.p12</span></span><br><span class="line"><span class="meta">nifi.security.keystoreType</span>=<span class="string">PKCS12</span></span><br><span class="line"><span class="meta">nifi.security.keystorePasswd</span>=<span class="string">67cee0ed3aba2755de751ff0ac5380fb</span></span><br><span class="line"><span class="meta">nifi.security.keyPasswd</span>=<span class="string">67cee0ed3aba2755de751ff0ac5380fb</span></span><br><span class="line"><span class="meta">nifi.security.truststore</span>=<span class="string">./conf/truststore.p12</span></span><br><span class="line"><span class="meta">nifi.security.truststoreType</span>=<span class="string">PKCS12</span></span><br><span class="line"><span class="meta">nifi.security.truststorePasswd</span>=<span class="string">797877f1ba3bd64380f7f15494ac12ec</span></span><br><span class="line"><span class="meta">nifi.security.user.authorizer</span>=<span class="string">single-user-authorizer</span></span><br><span class="line"><span class="meta">nifi.security.allow.anonymous.authentication</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.login.identity.provider</span>=<span class="string">single-user-provider</span></span><br><span class="line"><span class="meta">nifi.security.user.jws.key.rotation.period</span>=<span class="string">PT1H</span></span><br><span class="line"><span class="meta">nifi.security.ocsp.responder.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.ocsp.responder.certificate</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenId Connect SSO Properties #</span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.discovery.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.connect.timeout</span>=<span class="string">5 secs</span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.read.timeout</span>=<span class="string">5 secs</span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.client.id</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.client.secret</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.preferred.jwsalgorithm</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.additional.scopes</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.claim.identifying.user</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.fallback.claims.identifying.user</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache Knox SSO Properties #</span></span><br><span class="line"><span class="meta">nifi.security.user.knox.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.knox.publicKey</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.knox.cookieName</span>=<span class="string">hadoop-jwt</span></span><br><span class="line"><span class="meta">nifi.security.user.knox.audiences</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SAML Properties #</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.idp.metadata.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.sp.entity.id</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.identity.attribute.name</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.group.attribute.name</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.metadata.signing.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.request.signing.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.want.assertions.signed</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.signature.algorithm</span>=<span class="string">http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.signature.digest.algorithm</span>=<span class="string">http://www.w3.org/2001/04/xmlenc#sha256</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.message.logging.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.authentication.expiration</span>=<span class="string">12 hours</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.single.logout.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.http.client.truststore.strategy</span>=<span class="string">JDK</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.http.client.connect.timeout</span>=<span class="string">30 secs</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.http.client.read.timeout</span>=<span class="string">30 secs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Identity Mapping Properties #</span></span><br><span class="line"><span class="comment"># These properties allow normalizing user identities such that identities coming from different identity providers</span></span><br><span class="line"><span class="comment"># (certificates, LDAP, Kerberos) can be treated the same internally in NiFi. The following example demonstrates normalizing</span></span><br><span class="line"><span class="comment"># DNs from certificates and principals from Kerberos into a common identity string:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.pattern.dn=^CN=(.*?), OU=(.*?), O=(.*?), L=(.*?), ST=(.*?), C=(.*?)$</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.value.dn=$1@$2</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.transform.dn=NONE</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.pattern.kerb=^(.*?)/instance@(.*?)$</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.value.kerb=$1@$2</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.transform.kerb=UPPER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Group Mapping Properties #</span></span><br><span class="line"><span class="comment"># These properties allow normalizing group names coming from external sources like LDAP. The following example</span></span><br><span class="line"><span class="comment"># lowercases any group name.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nifi.security.group.mapping.pattern.anygroup=^(.*)$</span></span><br><span class="line"><span class="comment"># nifi.security.group.mapping.value.anygroup=$1</span></span><br><span class="line"><span class="comment"># nifi.security.group.mapping.transform.anygroup=LOWER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cluster common properties (all nodes must have same values) #</span></span><br><span class="line"><span class="meta">nifi.cluster.protocol.heartbeat.interval</span>=<span class="string">5 sec</span></span><br><span class="line"><span class="meta">nifi.cluster.protocol.heartbeat.missable.max</span>=<span class="string">8</span></span><br><span class="line"><span class="meta">nifi.cluster.protocol.is.secure</span>=<span class="string">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cluster node properties (only configure for cluster nodes) #</span></span><br><span class="line"><span class="meta">nifi.cluster.is.node</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.cluster.node.address</span>=<span class="string">sleety.local</span></span><br><span class="line"><span class="meta">nifi.cluster.node.protocol.port</span>=<span class="string">28001</span></span><br><span class="line"><span class="meta">nifi.cluster.node.protocol.max.threads</span>=<span class="string">50</span></span><br><span class="line"><span class="meta">nifi.cluster.node.event.history.size</span>=<span class="string">25</span></span><br><span class="line"><span class="meta">nifi.cluster.node.connection.timeout</span>=<span class="string">5 sec</span></span><br><span class="line"><span class="meta">nifi.cluster.node.read.timeout</span>=<span class="string">5 sec</span></span><br><span class="line"><span class="meta">nifi.cluster.node.max.concurrent.requests</span>=<span class="string">100</span></span><br><span class="line"><span class="meta">nifi.cluster.firewall.file</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.cluster.flow.election.max.wait.time</span>=<span class="string">1 mins</span></span><br><span class="line"><span class="meta">nifi.cluster.flow.election.max.candidates</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cluster load balancing properties #</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.host</span>=<span class="string">sleety.local</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.port</span>=<span class="string">6342</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.connections.per.node</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.max.thread.count</span>=<span class="string">8</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.comms.timeout</span>=<span class="string">30 sec</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># zookeeper properties, used for cluster management #</span></span><br><span class="line"><span class="meta">nifi.zookeeper.connect.string</span>=<span class="string">sleety.local:12181</span></span><br><span class="line"><span class="meta">nifi.zookeeper.connect.timeout</span>=<span class="string">10 secs</span></span><br><span class="line"><span class="meta">nifi.zookeeper.session.timeout</span>=<span class="string">10 secs</span></span><br><span class="line"><span class="meta">nifi.zookeeper.root.node</span>=<span class="string">/nifi</span></span><br><span class="line"><span class="meta">nifi.zookeeper.client.secure</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.keystore</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.keystoreType</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.keystorePasswd</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.truststore</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.truststoreType</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.truststorePasswd</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.jute.maxbuffer</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Zookeeper properties for the authentication scheme used when creating acls on znodes used for cluster management</span></span><br><span class="line"><span class="comment"># Values supported for nifi.zookeeper.auth.type are "default", which will apply world/anyone rights on znodes</span></span><br><span class="line"><span class="comment"># and "sasl" which will give rights to the sasl/kerberos identity used to authenticate the nifi node</span></span><br><span class="line"><span class="comment"># The identity is determined using the value in nifi.kerberos.service.principal and the removeHostFromPrincipal</span></span><br><span class="line"><span class="comment"># and removeRealmFromPrincipal values (which should align with the kerberos.removeHostFromPrincipal and kerberos.removeRealmFromPrincipal</span></span><br><span class="line"><span class="comment"># values configured on the zookeeper server).</span></span><br><span class="line"><span class="meta">nifi.zookeeper.auth.type</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.kerberos.removeHostFromPrincipal</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.kerberos.removeRealmFromPrincipal</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kerberos #</span></span><br><span class="line"><span class="meta">nifi.kerberos.krb5.file</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kerberos service principal #</span></span><br><span class="line"><span class="meta">nifi.kerberos.service.principal</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.kerberos.service.keytab.location</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kerberos spnego principal #</span></span><br><span class="line"><span class="meta">nifi.kerberos.spnego.principal</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.kerberos.spnego.keytab.location</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.kerberos.spnego.authentication.expiration</span>=<span class="string">12 hours</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># external properties files for variable registry</span></span><br><span class="line"><span class="comment"># supports a comma delimited list of file locations</span></span><br><span class="line"><span class="meta">nifi.variable.registry.properties</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># analytics properties #</span></span><br><span class="line"><span class="meta">nifi.analytics.predict.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.analytics.predict.interval</span>=<span class="string">3 mins</span></span><br><span class="line"><span class="meta">nifi.analytics.query.interval</span>=<span class="string">5 mins</span></span><br><span class="line"><span class="meta">nifi.analytics.connection.model.implementation</span>=<span class="string">org.apache.nifi.controller.status.analytics.models.OrdinaryLeastSquares</span></span><br><span class="line"><span class="meta">nifi.analytics.connection.model.score.name</span>=<span class="string">rSquared</span></span><br><span class="line"><span class="meta">nifi.analytics.connection.model.score.threshold</span>=<span class="string">.90</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># runtime monitoring properties</span></span><br><span class="line"><span class="meta">nifi.monitor.long.running.task.schedule</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.monitor.long.running.task.threshold</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create automatic diagnostics when stopping/restarting NiFi.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable automatic diagnostic at shutdown.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.enabled</span>=<span class="string">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include verbose diagnostic information.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.verbose</span>=<span class="string">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The location of the diagnostics folder.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.directory</span>=<span class="string">./diagnostics</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The maximum number of files permitted in the directory. If the limit is exceeded, the oldest files are deleted.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.max.filecount</span>=<span class="string">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The diagnostics folder's maximum permitted size in bytes. If the limit is exceeded, the oldest files are deleted.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.max.directory.size</span>=<span class="string">10 MB</span></span><br></pre></td></tr></table></figure><h3 id="conf-zookeeper-properties"><a href="#conf-zookeeper-properties" class="headerlink" title="conf/zookeeper.properties"></a>conf/zookeeper.properties</h3><p>端口和servers配置<br><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210340030.png" alt="image-20220329210340030" style="zoom:50%;"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">clientPort</span>=<span class="string">12181</span></span><br><span class="line"><span class="attr">initLimit</span>=<span class="string">10</span></span><br><span class="line"><span class="meta">autopurge.purgeInterval</span>=<span class="string">24</span></span><br><span class="line"><span class="attr">syncLimit</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">tickTime</span>=<span class="string">2000</span></span><br><span class="line"><span class="attr">dataDir</span>=<span class="string">./state/zookeeper</span></span><br><span class="line"><span class="meta">autopurge.snapRetainCount</span>=<span class="string">30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Embedded/distributed ZK TLS connection support can be activated by setting these properties at minimum:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># secureClientPort=2281</span></span><br><span class="line"><span class="comment"># serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Most TLS configurations will set these values as well:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ssl.keyStore.location=/example/path/to/key-store.jks</span></span><br><span class="line"><span class="comment"># ssl.keyStore.password=change this value to the actual value in your installation</span></span><br><span class="line"><span class="comment"># ssl.trustStore.location=/example/path/to/trust-store.jks</span></span><br><span class="line"><span class="comment"># ssl.trustStore.password=change this value to the actual value in your installation</span></span><br><span class="line"><span class="comment"># ssl.hostnameVerification=false</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that many ZK parameters can set as Java system properties, refer to the ZK admin guide for details:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_configuration</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Other common settings:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># client.portUnification=true</span></span><br><span class="line"><span class="comment"># admin.enableServer=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The server string has changed as of 3.5.5 and the client port is now specified at the end of the server string:</span></span><br><span class="line"><span class="comment"># https://zookeeper.apache.org/doc/r3.5.5/zookeeperReconfig.html#sc_reconfig_clientport</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Specifies the servers that are part of this zookeeper ensemble. For</span></span><br><span class="line"><span class="comment"># every NiFi instance running an embedded zookeeper, there needs to be</span></span><br><span class="line"><span class="comment"># a server entry below. Client port is now specified at the end of the string</span></span><br><span class="line"><span class="comment"># after a semi-colon.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For instance:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># server.1=nifi-node1-hostname:2888:3888;2181</span></span><br><span class="line"><span class="comment"># server.2=nifi-node2-hostname:2888:3888;2181</span></span><br><span class="line"><span class="comment"># server.3=nifi-node3-hostname:2888:3888;2181</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The index of the server corresponds to the myid file that gets created</span></span><br><span class="line"><span class="comment"># in the dataDir of each node running an embedded zookeeper. See the</span></span><br><span class="line"><span class="comment"># administration guide for more details.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="meta">server.1</span>=<span class="string">sleety.local:12888:13888;12181</span></span><br></pre></td></tr></table></figure><h3 id="conf-state-management-xml"><a href="#conf-state-management-xml" class="headerlink" title="conf/state-management.xml"></a>conf/state-management.xml</h3><p>配置zk-provider<br><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210545997.png" alt="image-20220329210545997" style="zoom:50%;"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml</span> <span class="string">version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span><br><span class="line"><span class="attr">&lt;!--</span></span><br><span class="line">  <span class="attr">Licensed</span> <span class="string">to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line">  <span class="attr">contributor</span> <span class="string">license agreements.  See the NOTICE file distributed with</span></span><br><span class="line">  <span class="attr">this</span> <span class="string">work for additional information regarding copyright ownership.</span></span><br><span class="line">  <span class="attr">The</span> <span class="string">ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line">  <span class="meta">(the</span> <span class="string">"License"); you may not use this file except in compliance with</span></span><br><span class="line">  <span class="attr">the</span> <span class="string">License.  You may obtain a copy of the License at</span></span><br><span class="line">      <span class="attr">http</span>:<span class="string">//www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line">  <span class="attr">Unless</span> <span class="string">required by applicable law or agreed to in writing, software</span></span><br><span class="line">  <span class="attr">distributed</span> <span class="string">under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line">  <span class="attr">WITHOUT</span> <span class="string">WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line">  <span class="attr">See</span> <span class="string">the License for the specific language governing permissions and</span></span><br><span class="line">  <span class="attr">limitations</span> <span class="string">under the License.</span></span><br><span class="line"><span class="attr">--&gt;</span></span><br><span class="line"><span class="attr">&lt;!--</span></span><br><span class="line">  <span class="attr">This</span> <span class="string">file provides a mechanism for defining and configuring the State Providers</span></span><br><span class="line">  <span class="attr">that</span> <span class="string">should be used for storing state locally and across a NiFi cluster. In order</span></span><br><span class="line">  <span class="attr">to</span> <span class="string">use a specific provider, it must be configured here and its identifier</span></span><br><span class="line">  <span class="attr">must</span> <span class="string">be specified in the nifi.properties file.</span></span><br><span class="line"><span class="attr">--&gt;</span></span><br><span class="line"><span class="attr">&lt;stateManagement&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--</span></span><br><span class="line">        <span class="attr">State</span> <span class="string">Provider that stores state locally in a configurable directory. This Provider requires the following properties:</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Directory</span> <span class="string">- the directory to store components' state in. If the directory being used is a sub-directory of the NiFi installation, it</span></span><br><span class="line">                    <span class="attr">is</span> <span class="string">important that the directory be copied over to the new version when upgrading NiFi.</span></span><br><span class="line">        <span class="attr">Always</span> <span class="string">Sync - If set to true, any change to the repository will be synchronized to the disk, meaning that NiFi will ask the operating system not to cache the information. This is very</span></span><br><span class="line">                <span class="attr">expensive</span> <span class="string">and can significantly reduce NiFi performance. However, if it is false, there could be the potential for data loss if either there is a sudden power loss or the</span></span><br><span class="line">                <span class="attr">operating</span> <span class="string">system crashes. The default value is false.</span></span><br><span class="line">        <span class="attr">Partitions</span> <span class="string">- The number of partitions.</span></span><br><span class="line">        <span class="attr">Checkpoint</span> <span class="string">Interval - The amount of time between checkpoints.</span></span><br><span class="line">     <span class="attr">--&gt;</span></span><br><span class="line">    <span class="attr">&lt;local-provider&gt;</span></span><br><span class="line">        <span class="attr">&lt;id&gt;local-provider&lt;/id&gt;</span></span><br><span class="line">        <span class="attr">&lt;class&gt;org.apache.nifi.controller.state.providers.local.WriteAheadLocalStateProvider&lt;/class&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Directory"&gt;./state/local&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Always Sync"&gt;false&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Partitions"&gt;16&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Checkpoint Interval"&gt;2 mins&lt;/property&gt;</span></span><br><span class="line">    <span class="attr">&lt;/local-provider&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;!--</span></span><br><span class="line">        <span class="attr">State</span> <span class="string">Provider that is used to store state in ZooKeeper. This Provider requires the following properties:</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Root</span> <span class="string">Node - the root node in ZooKeeper where state should be stored. The default is '/nifi', but it is advisable to change this to a different value if not using</span></span><br><span class="line">                   <span class="attr">the</span> <span class="string">embedded ZooKeeper server and if multiple NiFi instances may all be using the same ZooKeeper Server.</span></span><br><span class="line">                   </span><br><span class="line">        <span class="attr">Connect</span> <span class="string">String - A comma-separated list of host:port pairs to connect to ZooKeeper. For example, myhost.mydomain:2181,host2.mydomain:5555,host3:6666</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Session</span> <span class="string">Timeout - Specifies how long this instance of NiFi is allowed to be disconnected from ZooKeeper before creating a new ZooKeeper Session. Default value is "30 seconds"</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Access</span> <span class="string">Control - Specifies which Access Controls will be applied to the ZooKeeper ZNodes that are created by this State Provider. This value must be set to one of:</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Open  : ZNodes will be open to any ZooKeeper client.</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">CreatorOnly  : ZNodes will be accessible only by the creator. The creator will have full access to create children, read, write, delete, and administer the ZNodes.</span></span><br><span class="line">                                             <span class="attr">This</span> <span class="string">option is available only if access to ZooKeeper is secured via Kerberos or if a Username and Password are set.</span></span><br><span class="line">    <span class="attr">--&gt;</span></span><br><span class="line">    <span class="attr">&lt;cluster-provider&gt;</span></span><br><span class="line">        <span class="attr">&lt;id&gt;zk-provider&lt;/id&gt;</span></span><br><span class="line">        <span class="attr">&lt;class&gt;org.apache.nifi.controller.state.providers.zookeeper.ZooKeeperStateProvider&lt;/class&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Connect String"&gt;sleety.local:12181&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Root Node"&gt;/nifi&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Session Timeout"&gt;10 seconds&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Access Control"&gt;Open&lt;/property&gt;</span></span><br><span class="line">    <span class="attr">&lt;/cluster-provider&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;!--</span></span><br><span class="line">        <span class="attr">Cluster</span> <span class="string">State Provider that stores state in Redis. This can be used as an alternative to the ZooKeeper State Provider.</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">This</span> <span class="string">provider requires the following properties:</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Redis</span> <span class="string">Mode - The type of Redis instance:</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Standalone</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Sentinel</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Cluster (currently not supported for state-management due to use of WATCH command which Redis does not support in clustered mode)</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Connection</span> <span class="string">String - The connection string for Redis.</span></span><br><span class="line">                        <span class="meta">-</span> <span class="string">In a standalone instance this value will be of the form hostname:port.</span></span><br><span class="line">                        <span class="meta">-</span> <span class="string">In a sentinel instance this value will be the comma-separated list of sentinels, such as host1:port1,host2:port2,host3:port3.</span></span><br><span class="line">                        <span class="meta">-</span> <span class="string">In a clustered instance this value will be the comma-separated list of cluster masters, such as host1:port,host2:port,host3:port.</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">This</span> <span class="string">provider has the following optional properties:</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Key</span> <span class="string">Prefix - The prefix for each key stored by this state provider. When sharing a single Redis across multiple NiFi instances, setting a unique</span></span><br><span class="line">                        <span class="attr">value</span> <span class="string">for the Key Prefix will make it easier to identify which instances the keys came from (default nifi/components/).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Database</span> <span class="string">Index - The database index to be used by connections created from this connection pool.</span></span><br><span class="line">                        <span class="attr">See</span> <span class="string">the databases property in redis.conf, by default databases 0-15 will be available.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Communication</span> <span class="string">Timeout - The timeout to use when attempting to communicate with Redis.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Cluster</span> <span class="string">Max Redirects - The maximum number of redirects that can be performed when clustered.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Sentinel</span> <span class="string">Master - The name of the sentinel master, require when Mode is set to Sentinel.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Password</span> <span class="string">- The password used to authenticate to the Redis server. See the requirepass property in redis.conf.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Enable</span> <span class="string">TLS - If true, the Redis connection will be configured to use TLS, using the keystore and truststore settings configured in</span></span><br><span class="line">                    <span class="meta">nifi.properties.</span>  <span class="string">This means that a TLS-enabled Redis connection is only possible if the Apache NiFi instance is running in secure mode.</span></span><br><span class="line">                    <span class="attr">If</span> <span class="string">this property is false, an insecure Redis connection will be used even if the Apache NiFi instance is secure (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Max Total - The maximum number of connections that can be allocated by the pool (checked out to clients, or idle awaiting checkout).</span></span><br><span class="line">                        <span class="attr">A</span> <span class="string">negative value indicates that there is no limit.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Max Idle - The maximum number of idle connections that can be held in the pool, or a negative value if there is no limit.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Min Idle - The target for the minimum number of idle connections to maintain in the pool. If the configured value of Min Idle is</span></span><br><span class="line">                    <span class="attr">greater</span> <span class="string">than the configured value for Max Idle, then the value of Max Idle will be used instead.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Block When Exhausted - Whether or not clients should block and wait when trying to obtain a connection from the pool when the pool</span></span><br><span class="line">                    <span class="attr">has</span> <span class="string">no available connections. Setting this to false means an error will occur immediately when a client requests a connection and</span></span><br><span class="line">                    <span class="attr">none</span> <span class="string">are available.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Max Wait Time - The amount of time to wait for an available connection when Block When Exhausted is set to true.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Min Evictable Idle Time - The minimum amount of time an object may sit idle in the pool before it is eligible for eviction.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Time Between Eviction Runs - The amount of time between attempting to evict idle connections from the pool.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Num Tests Per Eviction Run - The number of connections to tests per eviction attempt. A negative value indicates to test all connections.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test On Create - Whether or not connections should be tested upon creation (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test On Borrow - Whether or not connections should be tested upon borrowing from the pool (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test On Return - Whether or not connections should be tested upon returning to the pool (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test While Idle - Whether or not connections should be tested while idle (default true).</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">&lt;cluster-provider&gt;</span></span><br><span class="line">            <span class="attr">&lt;id&gt;redis-provider&lt;/id&gt;</span></span><br><span class="line">            <span class="attr">&lt;class&gt;org.apache.nifi.redis.state.RedisStateProvider&lt;/class&gt;</span></span><br><span class="line">            <span class="meta">&lt;property</span> <span class="string">name="Redis Mode"&gt;Standalone&lt;/property&gt;</span></span><br><span class="line">            <span class="meta">&lt;property</span> <span class="string">name="Connection String"&gt;localhost:6379&lt;/property&gt;</span></span><br><span class="line">        <span class="attr">&lt;/cluster-provider&gt;</span></span><br><span class="line">    <span class="attr">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&lt;/stateManagement&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Nifi集群HTTP模式安装时遇到的一些问题记录集&lt;/p&gt;
&lt;p&gt;官网：&lt;a href=&quot;https://nifi.apache.org/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Apache NiFi&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;集群配置文档：&lt;a href=&quot;https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#clustering&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;NiFi System Administrator’s Guide (apache.org)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
    <category term="dataflow" scheme="https://lianyouli.gitee.io/tags/dataflow/"/>
    
    <category term="nifi" scheme="https://lianyouli.gitee.io/tags/nifi/"/>
    
  </entry>
  
  <entry>
    <title>hive - lateral view使用事例</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-hive-lateralview/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-hive-lateralview/</id>
    <published>2022-02-13T05:18:24.000Z</published>
    <updated>2022-02-13T06:02:45.586Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>lateral view在处理拆分一列多值的情况非常有用，例如array，map等数据拆分。</p></blockquote><a id="more"></a><ol><li><p>创建一个专门用户hive language manual的数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> langmanual;</span><br><span class="line"><span class="keyword">use</span> langmanual;</span><br></pre></td></tr></table></figure></li><li><p>创建一个lateral view专属表： pageads</p></li></ol><ul><li><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+LateralView" target="_blank" rel="noopener">lateral view</a></p></li><li><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-Built-inTable-GeneratingFunctions(UDTF)" target="_blank" rel="noopener">Built-in Table-Generating Functions[UDTF]</a></p></li><li><p>syntax [改进版本]</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lateralView: LATERAL VIEW [outer] udtf(expression) tableAlias AS columnAlias (',' columnAlias)*</span><br><span class="line">fromClause: FROM baseTable (',' lateralView)*</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> pageads;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> pageAds</span><br><span class="line">( pageid <span class="keyword">string</span>, </span><br><span class="line">adid_list <span class="built_in">array</span>&lt;<span class="built_in">int</span>&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ul><ol start="3"><li><p>插入两条数据</p><blockquote><p>array关键字</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds <span class="keyword">values</span> (<span class="string">'front-page'</span>, <span class="built_in">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds <span class="keyword">values</span> (<span class="string">'contact-page'</span>, <span class="built_in">array</span>(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure></li><li><p>查看数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pageads ;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|</span><br><span class="line">------------|---------|</span><br><span class="line">front-page  |[1,2,3]  |</span><br><span class="line">contact-page|[3,4,5]  |</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>使用lateral view 拆分广告id列表</p><blockquote><p>多个值转换成多行</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">select</span> pageid, adid </span><br><span class="line"><span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid|</span><br><span class="line">------------|----|</span><br><span class="line">front-page  |   1|</span><br><span class="line">front-page  |   2|</span><br><span class="line">front-page  |   3|</span><br><span class="line">contact-page|   3|</span><br><span class="line">contact-page|   4|</span><br><span class="line">contact-page|   5|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>lateral view拆分成多个字段：adidx, adid [index，value]。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pageid, adidx, adid <span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> posexplode(adid_list) adTable <span class="keyword">as</span> adidx, adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adidx|adid|</span><br><span class="line">------------|-----|----|</span><br><span class="line">front-page  |    0|   1|</span><br><span class="line">front-page  |    1|   2|</span><br><span class="line">front-page  |    2|   3|</span><br><span class="line">contact-page|    0|   3|</span><br><span class="line">contact-page|    1|   4|</span><br><span class="line">contact-page|    2|   5|</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>插入adid_list为null的记录</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds(pageid) <span class="keyword">values</span> (<span class="string">'link-page'</span>);</span><br></pre></td></tr></table></figure></li><li><p>查看记录</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pageads ;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| pageid       | adid_list |</span><br><span class="line">| ------------ | --------- |</span><br><span class="line">| front-page   | [1,2,3]   |</span><br><span class="line">| contact-page | [3,4,5]   |</span><br><span class="line">| link-page    | NULL      |</span><br></pre></td></tr></table></figure></li><li><p>查看lateral view针对null记录的处理</p><blockquote><p>将会忽略 adid_list为NULL记录</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pageid, adid </span><br><span class="line"><span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* </span><br><span class="line">pageid      |adid|</span><br><span class="line">------------|----|</span><br><span class="line">front-page  |   1|</span><br><span class="line">front-page  |   2|</span><br><span class="line">front-page  |   3|</span><br><span class="line">contact-page|   3| </span><br><span class="line">contact-page|   4|</span><br><span class="line">contact-page|   5|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>查看lateral view outer 对null记录的处理</p><blockquote><p>加上outer关键字将会保留id_list为null的记录</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pageid, adid </span><br><span class="line"><span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* </span><br><span class="line">pageid      |adid|</span><br><span class="line">------------|----|</span><br><span class="line">front-page  |   1|</span><br><span class="line">front-page  |   2|</span><br><span class="line">front-page  |   3|</span><br><span class="line">contact-page|   3|</span><br><span class="line">contact-page|   4|</span><br><span class="line">contact-page|   5|</span><br><span class="line">link-page   |    |</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>lateral view 对group by的处理</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> adid, <span class="keyword">count</span>(adid)</span><br><span class="line"><span class="keyword">from</span> pageads  <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">adid|_c1|</span><br><span class="line">----|---|</span><br><span class="line"> 1|  1|</span><br><span class="line"> 2|  1|</span><br><span class="line"> 3|  2|</span><br><span class="line"> 4|  1|</span><br><span class="line"> 5|  1| </span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>多个多值字段： 新增一个array字段，visit_count</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> pageads  <span class="keyword">add</span> <span class="keyword">columns</span> (visit_count <span class="built_in">array</span>&lt;<span class="built_in">int</span>&gt; <span class="keyword">comment</span> <span class="string">'访问次数'</span>);</span><br></pre></td></tr></table></figure></li><li><p>造数&amp;查看数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds <span class="keyword">values</span> (<span class="string">'footer-page'</span>, <span class="built_in">array</span>(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>), <span class="built_in">array</span>(<span class="number">700</span>, <span class="number">800</span>, <span class="number">900</span>));</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pageads ;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|visit_count  |</span><br><span class="line">------------|---------|-------------|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |</span><br><span class="line">link-page   |NULL     |NULL         |</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>一个lateral view对另外一个字段的处理</p><blockquote><p>另外一字段和常规字段一样，都是不变。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> pageads </span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|visit_count  |adid|</span><br><span class="line">------------|---------|-------------|----|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   1|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   2|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   3|</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   3|</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   4|</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   5|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>多个lateral view</p><blockquote><p>会拆分成多对多情况，即full outer join中，排除lateral view 任何字段为null的记录。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> pageads </span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(visit_count)  vTable <span class="keyword">as</span> vct;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid     |adid_list|visit_count  |adid|vct|</span><br><span class="line">-----------|---------|-------------|----|---|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   7|700|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   7|800|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   7|900|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   8|700|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   8|800|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   8|900|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   9|700|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   9|800|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   9|900|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>多个lateral view outer</p><blockquote><p>会拆分成多对多情况，类似full outer join。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> pageads </span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> <span class="keyword">explode</span>(visit_count)  vTable <span class="keyword">as</span> vct;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|visit_count  |adid|vct|</span><br><span class="line">------------|---------|-------------|----|---|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   1|   |</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   2|   |</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   3|   |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   3|   |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   4|   |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   5|   |</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|700|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|800|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|900|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|700|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|800|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|900|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|700|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|800|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|900|</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;lateral view在处理拆分一列多值的情况非常有用，例如array，map等数据拆分。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="lateral" scheme="https://lianyouli.gitee.io/tags/lateral/"/>
    
    <category term="lateralview" scheme="https://lianyouli.gitee.io/tags/lateralview/"/>
    
    <category term="hive" scheme="https://lianyouli.gitee.io/tags/hive/"/>
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
  </entry>
  
  <entry>
    <title>259号文</title>
    <link href="https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-no259/"/>
    <id>https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-no259/</id>
    <published>2022-01-23T08:49:58.000Z</published>
    <updated>2022-02-13T06:02:41.988Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="http://www.pbc.gov.cn/tiaofasi/144941/3581332/4359567/index.html" target="_blank" rel="noopener">259号文</a>是既21号之后针对终端再次补充，更加严格了，当然此次也针对了条码支付终端相关的要求。足以看出终端的重要性，也侧面反映了现在洗钱、涉黑涉黄等非法行为泛滥。</p><p>259号文是提纲挈领的法规，那么中国支付清算协会关于印发<a href="http://www.pcac.org.cn/eportal/ui?pageId=598041&articleKey=614091&columnId=595027" target="_blank" rel="noopener">《特约商户巡检指引》</a>的通知就针对特约商户明确了巡检的方式、周期、内容和频率等内容。</p></blockquote><a id="more"></a><h1 id="259号文"><a href="#259号文" class="headerlink" title="259号文"></a>259号文</h1><p>支付受理终端业务管理其大多数内容还是延续21号文，其总结起来就是<strong>1：1：1</strong>，即：</p><blockquote><p>一台银行卡受理终端对应一个终端序列号，对应一个特约商户</p></blockquote><p>条码支付受理终端及相关业务要求了 条码的场景和用途。</p><p>例如个人静态收款条码不可以远程非面对面收款，这个也有效扼制了现在微信支付宝之类的跑分等洗钱行为。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.pbc.gov.cn/tiaofasi/144941/3581332/4359567/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;259号文&lt;/a&gt;是既21号之后针对终端再次补充，更加严格了，当然此次也针对了条码支付终端相关的要求。足以看出终端的重要性，也侧面反映了现在洗钱、涉黑涉黄等非法行为泛滥。&lt;/p&gt;
&lt;p&gt;259号文是提纲挈领的法规，那么中国支付清算协会关于印发&lt;a href=&quot;http://www.pcac.org.cn/eportal/ui?pageId=598041&amp;articleKey=614091&amp;columnId=595027&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;《特约商户巡检指引》&lt;/a&gt;的通知就针对特约商户明确了巡检的方式、周期、内容和频率等内容。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/categories/Payment/"/>
    
    <category term="法规" scheme="https://lianyouli.gitee.io/categories/Payment/%E6%B3%95%E8%A7%84/"/>
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/tags/Payment/"/>
    
    <category term="中国人民银行法规" scheme="https://lianyouli.gitee.io/tags/%E4%B8%AD%E5%9B%BD%E4%BA%BA%E6%B0%91%E9%93%B6%E8%A1%8C%E6%B3%95%E8%A7%84/"/>
    
    <category term="终端" scheme="https://lianyouli.gitee.io/tags/%E7%BB%88%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>docker jupyter nignix 400问题</title>
    <link href="https://lianyouli.gitee.io/IT/Issues/it-issue-jupyter-nignix-400/"/>
    <id>https://lianyouli.gitee.io/IT/Issues/it-issue-jupyter-nignix-400/</id>
    <published>2021-09-05T00:32:57.000Z</published>
    <updated>2022-02-13T06:02:39.238Z</updated>
    
    <content type="html"><![CDATA[<h1 id="jupyter-kernel一直连接不上服务器"><a href="#jupyter-kernel一直连接不上服务器" class="headerlink" title="jupyter kernel一直连接不上服务器"></a>jupyter kernel一直连接不上服务器</h1><p>Docker上拉取了hortonworks/sandbox-hdp 和 hortonworks/sandbox-proxy, 在sandbox-hdp上安装了jupyter来写一些pyspark的代码。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>其中sandbox-proxy做了如下配置</p><h3 id="HDP3-sandbox-proxy-conf-d-http-hdp-conf"><a href="#HDP3-sandbox-proxy-conf-d-http-hdp-conf" class="headerlink" title="HDP3/sandbox/proxy/conf.d/http-hdp.conf"></a>HDP3/sandbox/proxy/conf.d/http-hdp.conf</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># jupyter notebook </span><br><span class="line">server &#123;</span><br><span class="line">  listen 9999;</span><br><span class="line">  server_name sandbox-hdp.hortonworks.com;</span><br><span class="line">  location / &#123;</span><br><span class="line">                proxy_pass http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host $host;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HDP3-sandbox-proxy-proxy-deploy-sh"><a href="#HDP3-sandbox-proxy-proxy-deploy-sh" class="headerlink" title="HDP3/sandbox/proxy/proxy-deploy.sh"></a>HDP3/sandbox/proxy/proxy-deploy.sh</h3><p>新增一行-p 9999:9999 \</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">!/usr/bin/env bash</span><br><span class="line">docker rm -f sandbox-proxy 2&gt;/dev/null</span><br><span class="line">docker run --name sandbox-proxy --network=cda \</span><br><span class="line">-v /Users/arthur/Software/Docker/HDP3/assets/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /Users/arthur/Software/Docker/HDP3/sandbox/proxy/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /Users/arthur/Software/Docker/HDP3/sandbox/proxy/conf.stream.d:/etc/nginx/conf.stream.d \</span><br><span class="line">-p 1080:1080 \</span><br><span class="line">-p 9999:9999 \</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="浏览器访问，jupyter后台错误日志"><a href="#浏览器访问，jupyter后台错误日志" class="headerlink" title="浏览器访问，jupyter后台错误日志"></a>浏览器访问，jupyter后台错误日志</h2><p>NotebookApp] 400 GET /api/kernels/</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2<span class="comment"># jupyter-notebook --allow-root</span></span><br><span class="line">[W 23:05:07.281 NotebookApp] Config option `use_redirect_file` not recognized by `NotebookApp`.</span><br><span class="line">[I 23:05:07.462 NotebookApp] Serving notebooks from <span class="built_in">local</span> directory: /root/notebook</span><br><span class="line">[I 23:05:07.462 NotebookApp] The Jupyter Notebook is running at:</span><br><span class="line">[I 23:05:07.462 NotebookApp] http://sandbox-hdp.hortonworks.com:9999/?token=9c46a4fbfa4a432be0275f2381cd24543ba763566c0cc8fe</span><br><span class="line">[I 23:05:07.462 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[W 23:05:07.466 NotebookApp] No web browser found: could not locate runnable browser.</span><br><span class="line">[C 23:05:07.467 NotebookApp] </span><br><span class="line"></span><br><span class="line">    To access the notebook, open this file <span class="keyword">in</span> a browser:</span><br><span class="line">        file:///root/.<span class="built_in">local</span>/share/jupyter/runtime/nbserver-38953-open.html</span><br><span class="line">    Or copy and paste one of these URLs:</span><br><span class="line">        http://sandbox-hdp.hortonworks.com:9999/?token=9c46a4fbfa4a432be0275f2381cd24543ba763566c0cc8fe</span><br><span class="line">[E 23:05:14.835 NotebookApp] Could not open static file <span class="string">''</span></span><br><span class="line">[W 23:05:15.184 NotebookApp] 404 GET /static/components/react/react-dom.production.min.js (172.18.0.2) 14.91ms referer=http://sandbox-hdp.hortonworks.com:9999/notebooks/Untitled1.ipynb?kernel_name=python2</span><br><span class="line">[I 23:05:15.786 NotebookApp] Kernel started: eae1b42e-120e-4d69-9266-c06432677d5a</span><br><span class="line">[I 23:05:16.372 NotebookApp] Adapting to protocol v5.1 <span class="keyword">for</span> kernel eae1b42e-120e-4d69-9266-c06432677d5a</span><br><span class="line">[W 23:05:16.375 NotebookApp] 400 GET /api/kernels/eae1b42e-120e-4d69-9266-c06432677d5a/channels?session_id=0fea190ca5e94abd89500020f29a66fb (172.18.0.2) 521.39ms referer=None</span><br><span class="line">[W 23:05:17.437 NotebookApp] Replacing stale connection: eae1b42e-120e-4d69-9266-c06432677d5a:0fea190ca5e94abd89500020f29a66fb</span><br><span class="line">[W 23:05:18.140 NotebookApp] 404 GET /static/components/react/react-dom.production.min.js (172.18.0.2) 6.56ms referer=http://sandbox-hdp.hortonworks.com:9999/tree?token=9c46a4fbfa4a432be0275f2381cd24543ba763566c0cc8fe</span><br><span class="line">[W 23:05:20.220 NotebookApp] 404 GET /static/components/react/react-dom.production.min.js (172.18.0.2) 4.17ms referer=http://sandbox-hdp.hortonworks.com:9999/notebooks/Untitled1.ipynb</span><br><span class="line">[I 23:05:20.443 NotebookApp] Adapting to protocol v5.1 <span class="keyword">for</span> kernel eae1b42e-120e-4d69-9266-c06432677d5a</span><br><span class="line">[W 23:05:20.444 NotebookApp] 400 GET /api/kernels/eae1b42e-120e-4d69-9266-c06432677d5a/channels?session_id=ed975e0dfee44503a3a2405dac3718cc (172.18.0.2) 3.54ms referer=None</span><br><span class="line">[W 23:05:21.516 NotebookApp] Replacing stale connection: eae1b42e-120e-4d69-9266-c06432677d5a:ed975e0dfee44503a3a2405dac3718cc</span><br><span class="line">[W 23:06:23.550 NotebookApp] Replacing stale connection: eae1b42e-120e-4d69-9266-c06432677d5a:ed975e0dfee44503a3a2405dac3718cc</span><br></pre></td></tr></table></figure><h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><p><a href="https://www.cnblogs.com/ycc1/p/14229534.html" target="_blank" rel="noopener">Virya的博客</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jupyter notebook</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen 9999;</span><br><span class="line">  server_name sandbox-hdp.hortonworks.com;</span><br><span class="line">  location / &#123;</span><br><span class="line">                proxy_pass http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host <span class="variable">$host</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /api/kernels/ &#123;</span><br><span class="line">                proxy_pass            http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host <span class="variable">$host</span>;</span><br><span class="line"></span><br><span class="line">                proxy_http_version    1.1;  <span class="comment"># websocket support</span></span><br><span class="line">                proxy_set_header      Upgrade <span class="string">"websocket"</span>;</span><br><span class="line">                proxy_set_header      Connection <span class="string">"Upgrade"</span>;</span><br><span class="line">                proxy_read_timeout    86400;</span><br><span class="line">        &#125;</span><br><span class="line">  location ~ /terminals/ &#123;</span><br><span class="line">                proxy_pass            http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host <span class="variable">$host</span>;</span><br><span class="line"></span><br><span class="line">                proxy_http_version    1.1;  <span class="comment"># websocket support</span></span><br><span class="line">                proxy_set_header      Upgrade <span class="string">"websocket"</span>;</span><br><span class="line">                proxy_set_header      Connection <span class="string">"Upgrade"</span>;</span><br><span class="line">                proxy_read_timeout    86400;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;jupyter-kernel一直连接不上服务器&quot;&gt;&lt;a href=&quot;#jupyter-kernel一直连接不上服务器&quot; class=&quot;headerlink&quot; title=&quot;jupyter kernel一直连接不上服务器&quot;&gt;&lt;/a&gt;jupyter</summary>
        
      
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    <category term="Issues" scheme="https://lianyouli.gitee.io/categories/IT/Issues/"/>
    
    
    <category term="jupyter" scheme="https://lianyouli.gitee.io/tags/jupyter/"/>
    
    <category term="nginx" scheme="https://lianyouli.gitee.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>TLS 模式</title>
    <link href="https://lianyouli.gitee.io/uncategorized/tls-mode/"/>
    <id>https://lianyouli.gitee.io/uncategorized/tls-mode/</id>
    <published>2021-04-19T13:10:19.000Z</published>
    <updated>2021-07-21T08:13:00.881Z</updated>
    
    <content type="html"><![CDATA[<h1 id="TLS模式"><a href="#TLS模式" class="headerlink" title="TLS模式"></a>TLS模式</h1><p>有三种模式，见下图</p><ol><li><p>客户端直接忽略TLS证书访问服务</p><p>例如使用curl -k -tlsv1 等参数可以忽略证书验证直接访问。即客户端不检查证书的有效性和合法性。即此时，客户端不检查服务端的网址合法性和有效性，同时网络传输也是明文。</p></li><li><p>客户端使用TLS证书访问服务</p><p>此场景是最常见的，即客户端需要检查服务端证书的合法性和有效性，传输也是加密的。</p></li><li><p>双向认证</p><p>此时除了服务端证书需要提供给客户端，同时客户端的证书需要添加到服务端。登录时，可以直接使用证书验证直接登录。另外，例如U盾等也是双向认证的应用</p></li></ol><p><img src="/uncategorized/tls-mode/tls.jpg" alt="tls"></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;TLS模式&quot;&gt;&lt;a href=&quot;#TLS模式&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/tags/IT/"/>
    
  </entry>
  
  <entry>
    <title>云闪付</title>
    <link href="https://lianyouli.gitee.io/Payment/payment-yunshanfu/"/>
    <id>https://lianyouli.gitee.io/Payment/payment-yunshanfu/</id>
    <published>2020-10-28T12:27:51.000Z</published>
    <updated>2021-07-21T08:13:00.881Z</updated>
    
    <content type="html"><![CDATA[<h1 id="云闪付"><a href="#云闪付" class="headerlink" title="云闪付"></a>云闪付</h1><p>没错，就是你想的那个云闪付。千人千面，今天我要从卡组织的角度来看。</p><p>银联大力推广，所以云闪付涉及方方面面。</p><a id="more"></a><h2 id="付的世界"><a href="#付的世界" class="headerlink" title="付的世界"></a>付的世界</h2><h3 id="便民服务"><a href="#便民服务" class="headerlink" title="便民服务"></a>便民服务</h3><p>乘车码、公共缴费、健康码、手机充值等</p><p>国庆期间，我去杭州西湖玩，地铁入口看到提示，可以使用云闪付和支付宝乘坐地铁；本着云闪付也是我支付软件后宫佳丽之一，今天就翻她牌了；众所周知，杭州基本上是支付宝的天下，到深圳是微信的天下，坐过城市交通的深深的体会到地方城市的溺爱。关键她以国家队的形式打破了地方城市的保护；关键操作非常简单而且还打9折优惠，爱了爱了。</p><h3 id="财富管理"><a href="#财富管理" class="headerlink" title="财富管理"></a>财富管理</h3><p>信用卡还款、转账、借款、申请信用卡等</p><p>信用卡还款免手续费！支付宝或者微信还信用卡从免费到收费，广大<strong>打工人</strong>表示马爸爸你变了。</p><h3 id="政务民生"><a href="#政务民生" class="headerlink" title="政务民生"></a>政务民生</h3><p>我的社保、我的医保、税款缴纳、交通罚款等</p><p>税款缴纳竟然可以使用信用卡！这个出乎意料。</p><h3 id="购物娱乐"><a href="#购物娱乐" class="headerlink" title="购物娱乐"></a>购物娱乐</h3><p>商城、数字景区等</p><p>数字景区买门票有优惠的。</p><h3 id="境外服务"><a href="#境外服务" class="headerlink" title="境外服务"></a>境外服务</h3><p>境外海淘、境外退税、权益U赏等</p><p>这个大类里的服务点击时有Error，测试人员的鸡腿没有了吧。</p><h3 id="第三方服务"><a href="#第三方服务" class="headerlink" title="第三方服务"></a>第三方服务</h3><p>租房、猫眼电影、淘车位等</p><h2 id="角色扮演"><a href="#角色扮演" class="headerlink" title="角色扮演"></a>角色扮演</h2><p>云闪付出自银联，银联做为卡组织；单纯从卡组织的角色来看，其云闪付的定位是非常契合的。</p><p>因为卡组织有服务、协调，自律以及监督等功能；这里就只从服务角度来看，就需要集发卡、收单、商户和持卡人于一体，满足各方一部分需求，平衡各方的利益点，以共荣为目的，在一个平台上提供服务。</p><p>所以从战略方向来看，前途一片光明。可是，云闪付却干了收单的事，这个平台就不再是拧成一股绳,搏尽一份力,狠下一条心,共圆一个梦的那个平台了。</p><h2 id="世事造化"><a href="#世事造化" class="headerlink" title="世事造化"></a>世事造化</h2><p>现在支付行业环境再也不是从前了。</p><h4 id="拉新"><a href="#拉新" class="headerlink" title="拉新"></a>拉新</h4><p>以前获取一个新用户的成本非常低的；但是现在获取一个新用户的成本比较高了，你看支付宝为了获取一个为了获取新用户，给老用户的推荐奖是20元的电话费。而且从现在的互联网用户总量来看，市场差不多快饱和了。</p><h4 id="用户量为王"><a href="#用户量为王" class="headerlink" title="用户量为王"></a>用户量为王</h4><p>谁的用户量大，谁就了不得，谁就话语权就大，得用户者得天下；甚至连监管都要考虑三分，有种三国时代的携天子而以令诸侯。</p><h4 id="互联网时代"><a href="#互联网时代" class="headerlink" title="互联网时代"></a>互联网时代</h4><p>而且现在互联网的世界是不再是4321，即龙头老大老二的市场份额占比基本上是70%左右，其它的基本上还能吃饱饭。而现在第三方支付的市场份额的90%多被龙头老大老二占了，所以除了微信支付宝，剩余的就只能叫做其它了；关键是老大老二利用行业领头优势，全面围杀竞争者的反击；最后，互联网的时代是一个变化万千的时代，是一个瞬息万变的时代，是一个与监管相爱相杀的时代；很多时候，行业龙头老大老二为了抢占市场，面子上对监管服服帖帖的，背后依旧干些偷偷摸摸的事，因为惩罚的成本与其利润相比显得微不足道。</p><h4 id="卡基过渡到帐基"><a href="#卡基过渡到帐基" class="headerlink" title="卡基过渡到帐基"></a>卡基过渡到帐基</h4><p>以前基本上是卡基支付，而现在是帐户支付的时代；卡基变成了帐基的基石，上层应用更多围绕着帐户来构建丰富的生态和应用场景。</p><p>所以内因加外因，这也是为什么银联投资和市场占比来看有点不成正比的主要原因。</p><h2 id="异军突起"><a href="#异军突起" class="headerlink" title="异军突起"></a>异军突起</h2><p>国家队的云闪付这几年的大力推广，效果虽然不是那么显著，但是起色还是不错的。如果要突破，本人的愚见还是回归支付本质和卡组织的本质。深耕支付场景，广惠各个实体，互助共荣不称霸。</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;云闪付&quot;&gt;&lt;a href=&quot;#云闪付&quot; class=&quot;headerlink&quot; title=&quot;云闪付&quot;&gt;&lt;/a&gt;云闪付&lt;/h1&gt;&lt;p&gt;没错，就是你想的那个云闪付。千人千面，今天我要从卡组织的角度来看。&lt;/p&gt;
&lt;p&gt;银联大力推广，所以云闪付涉及方方面面。&lt;/p&gt;</summary>
    
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/categories/Payment/"/>
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/tags/Payment/"/>
    
  </entry>
  
  <entry>
    <title>国家发展改革委 中国人民银行关于完善银行卡刷卡手续费定价机制的通知</title>
    <link href="https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-96fees/"/>
    <id>https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-96fees/</id>
    <published>2020-09-09T13:48:46.000Z</published>
    <updated>2021-07-21T08:13:00.893Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p> <a href="http://www.pbc.gov.cn/goutongjiaoliu/113456/113469/3034338/index.html" target="_blank" rel="noopener">国家发展改革委 中国人民银行 关于完善银行卡刷卡手续费定价机制的通知</a> 俗称96费改，是因为从2016年9月6日起实施的。有此宝典，如同如来佛祖的手掌，各种费率都逃不出手掌心。</p></blockquote><a id="more"></a>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt; &lt;a href=&quot;http://www.pbc.gov.cn/goutongjiaoliu/113456/113469/3034338/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;国家发展改革委 中国人民银行 关于完善银行卡刷卡手续费定价机制的通知&lt;/a&gt; 俗称96费改，是因为从2016年9月6日起实施的。有此宝典，如同如来佛祖的手掌，各种费率都逃不出手掌心。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/categories/Payment/"/>
    
    <category term="法规" scheme="https://lianyouli.gitee.io/categories/Payment/%E6%B3%95%E8%A7%84/"/>
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/tags/Payment/"/>
    
    <category term="中国人民银行法规" scheme="https://lianyouli.gitee.io/tags/%E4%B8%AD%E5%9B%BD%E4%BA%BA%E6%B0%91%E9%93%B6%E8%A1%8C%E6%B3%95%E8%A7%84/"/>
    
  </entry>
  
  <entry>
    <title>清算架构</title>
    <link href="https://lianyouli.gitee.io/Payment/payment-clearing-architecture/"/>
    <id>https://lianyouli.gitee.io/Payment/payment-clearing-architecture/</id>
    <published>2020-08-23T14:50:25.000Z</published>
    <updated>2021-07-21T08:13:00.880Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>这里只是我根据央行发布的支付体系运行总体情况报告整理得来的信息，对一些系统或者周边系统还没有深入了解到。</p></blockquote><a id="more"></a><p><img src="/Payment/payment-clearing-architecture/%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F.png" alt="支付系统信息"></p><blockquote><p>CIPS 是人民币国际化的重要部分</p><p>其他清算系统也有美国运通一个位置了，因为美国运通也拿到清算牌照，正式营业了。</p></blockquote><p><img src="/Payment/payment-clearing-architecture/%E6%B8%85%E7%AE%97%E6%9C%BA%E6%9E%84%E6%9E%B6%E6%9E%84.png" alt="&#39;架构&#39;"></p><p>这里这么多清算机构，是不是都懵圈了？ 在开始之前，先铺垫一点基础术语：</p><ul><li><p>实时</p><p>每一笔交易都实时处理，即来一笔交易就处理一笔。</p></li><li><p>批量</p><p>交易累积一段时间做处理。例如，累积一天做处理的叫做99批次；累积半天做处理的叫做13批次[13点]和23批次[23点]；还有每小时累积一次，那全天一共24个批次了。</p></li></ul><p>现在简单概述一下央行的这四个主要的清算系统。</p><h2 id="央行四大支付系统"><a href="#央行四大支付系统" class="headerlink" title="央行四大支付系统"></a>央行四大支付系统</h2><h3 id="大额实时支付系统"><a href="#大额实时支付系统" class="headerlink" title="大额实时支付系统"></a>大额实时支付系统</h3><p>大额是实时处理交易的；</p><p>金融机构都会在央行大额支付系统里开立清算账户，然后其他清算系统基本上会在清算的批次时调用央行大额支付将钱从各个金融机构的清算账户上划付。</p><blockquote><p>另外，不要被名称中的大额给误导了，因为大额支付系统的金额起点为0。也就是说，1毛钱的生意也可以使用大额。</p></blockquote><h3 id="小额批量支付系统"><a href="#小额批量支付系统" class="headerlink" title="小额批量支付系统"></a>小额批量支付系统</h3><p>小额是批量处理交易的；</p><p>主要是定位零售的，其实和美国的ACH [ <a href="https://baike.baidu.com/item/自动清算所系统/6889060?fr=aladdin" target="_blank" rel="noopener">Automated Clearing House</a>]类似，一些什么代发工资，代收水电煤气之类的缴费等等；</p><p>是有金额上限限制的。</p><h3 id="网上支付跨行清算系统"><a href="#网上支付跨行清算系统" class="headerlink" title="网上支付跨行清算系统"></a>网上支付跨行清算系统</h3><p>这个也叫做超级网银</p><p>银行网银就是使用的这个系统。</p><h3 id="境内外币支付系统"><a href="#境内外币支付系统" class="headerlink" title="境内外币支付系统"></a>境内外币支付系统</h3><p>这个满足国内对外币的需求，例如我们兑换美元，可以预约去中国银行兑换。</p><h2 id="清算系统"><a href="#清算系统" class="headerlink" title="清算系统"></a>清算系统</h2><h3 id="人民币跨境支付系统"><a href="#人民币跨境支付系统" class="headerlink" title="人民币跨境支付系统"></a>人民币跨境支付系统</h3><p>这个和境内外币支付系统恰恰相反，其用来国外满足人民币的清算。这个是人民币走出去的关键一步。</p><h3 id="城银清-amp-农信银"><a href="#城银清-amp-农信银" class="headerlink" title="城银清 &amp; 农信银"></a>城银清 &amp; 农信银</h3><p>这两个一个是为城市商业银行做清算的，一个是为农村合作信用社做清算的。</p><h3 id="银行卡跨行支付系统"><a href="#银行卡跨行支付系统" class="headerlink" title="银行卡跨行支付系统"></a>银行卡跨行支付系统</h3><p>这个是银行卡跨行支付的系统，即参与方是多家不同的金融机构，也称之为本代他</p><p>一般银行系统是不能直接处理其它银行的交易的，其中主要原因有两个方面，以A银行和B银行为例</p><ol><li><p>处理交易协议不同</p><p>A银行发行的卡其处理逻辑基本上大体上是按照标准来的，例如ISO8583；但是，还有一些自定义的地方或者各家支持的业务也有所不同，各个银行实现是不同的，所以会导致处理失败。</p></li><li><p>资金积压严重</p><p>及时第一点不是一个障碍，那么A银行发行的卡在B银行取款，那么为什么B银行要把钱给卡持有者呢？那么A就得在B银行开户，在B银行的账户上存钱，其钱叫做头寸。如果有10家机构或者100家机构或者更多呢？正如当时支付宝等支付机构在630‘断直连’之前都是一样的。所以会导致很多资金都在各个金融机构的账户里存着，白白浪费了资金的流动性。</p></li></ol><p>解决上述两个方面的问题，有什么方案呢？现在通用的方案是</p><ul><li><p>同一种通信协议或者规范</p><p>卡组织就是来做这个事情的，卡组织制定统一的规范，同时开发各种支付产品等等；这样大家就使用同一种通信规范，基本上可以跨越不同银行，做交易往来了。</p></li><li><p>在央行统一开立清算账户</p><p>这样央行开立一个清算账户，里面存上钱，供资金划付使用。如果金融机构在账户里存的钱不够，可以同行拆借等等；这样就不用在各个金融机构里开立账户。</p></li></ul><p>好了，银行卡跨行支付系统就是做这个事情的。</p><h3 id="网联清算系统"><a href="#网联清算系统" class="headerlink" title="网联清算系统"></a>网联清算系统</h3><p>这个清算系统有点特殊，因为它的出现，网上有很多马云与银联故事。其实网上支付现在不一定是全部通过它的，其实也可以通过银联等跨行支付系统的；后面再详细讲讲它的业务类型。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;这里只是我根据央行发布的支付体系运行总体情况报告整理得来的信息，对一些系统或者周边系统还没有深入了解到。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/categories/Payment/"/>
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/tags/Payment/"/>
    
  </entry>
  
  <entry>
    <title>非金融机构支付服务管理办法</title>
    <link href="https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-no2-201006/"/>
    <id>https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-no2-201006/</id>
    <published>2020-08-15T14:54:44.000Z</published>
    <updated>2021-07-21T08:13:00.884Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>2010年6月份央行发布了 <a href="http://www.pbc.gov.cn/tiaofasi/144941/144957/2845832/index.html" target="_blank" rel="noopener"> 中国人民银行令〔2010〕第2号（非金融机构支付服务管理办法）</a>（以下简称2号令）开启了第三方支付的合法性，从此第三方支付群雄逐鹿，单支付牌照就一度炒到几亿</p></blockquote><a id="more"></a><p>2号令规定了，支付机构需要取得《支付业务许可证》才是合法的，已经从事支付业务的非金融机构在一年以内完成申请；所以从<strong>已获许可机构（支付机构）</strong>名单里看到的机构的开始生效时间基本都是2011年5月份，包括银联商务，支付宝，财付通等等。下面我们来看看其内容：</p><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>规范非金融机构支付服务行为，防范支付风险。</p><h2 id="非金融机构支付服务种类"><a href="#非金融机构支付服务种类" class="headerlink" title="非金融机构支付服务种类"></a>非金融机构支付服务种类</h2><ul><li><p>网络支付</p><p>互联网支付，移动电话支付，固话支付，数字电视支付等等，例如微信支付宝，电话购物等</p></li><li><p>预付卡的发行与受理</p><p>例如你去理发店，Tony老师总是推荐你办张卡。当然这个卡不是理发店能够发行的，而是需要有预付卡的发行与受理的支付公司给理发店定制的。</p></li><li><p>银行卡收单</p><p>POS终端等收单</p></li><li><p>其他支付服务</p></li></ul><h2 id="义务"><a href="#义务" class="headerlink" title="义务"></a>义务</h2><ul><li>依法接受央行的监督管理</li><li>履行发洗钱</li><li>不得损害国家利益、社会公共利益和客户合法权益</li></ul><h2 id="申请资质"><a href="#申请资质" class="headerlink" title="申请资质"></a>申请资质</h2><p>略</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;2010年6月份央行发布了 &lt;a href=&quot;http://www.pbc.gov.cn/tiaofasi/144941/144957/2845832/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt; 中国人民银行令〔2010〕第2号（非金融机构支付服务管理办法）&lt;/a&gt;（以下简称2号令）开启了第三方支付的合法性，从此第三方支付群雄逐鹿，单支付牌照就一度炒到几亿&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/categories/Payment/"/>
    
    <category term="法规" scheme="https://lianyouli.gitee.io/categories/Payment/%E6%B3%95%E8%A7%84/"/>
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/tags/Payment/"/>
    
    <category term="中国人民银行法规" scheme="https://lianyouli.gitee.io/tags/%E4%B8%AD%E5%9B%BD%E4%BA%BA%E6%B0%91%E9%93%B6%E8%A1%8C%E6%B3%95%E8%A7%84/"/>
    
  </entry>
  
  <entry>
    <title>中国人民银行关于加强支付受理终端及相关业务管理的通知（征求意见稿）</title>
    <link href="https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-terminal-202006/"/>
    <id>https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-terminal-202006/</id>
    <published>2020-08-09T05:13:04.000Z</published>
    <updated>2021-07-21T08:13:00.892Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="http://www.pbc.gov.cn/tiaofasi/144941/144979/3941920/4035719/index.html" target="_blank" rel="noopener">《中国人民银行关于加强支付受理终端及相关业务管理的通知（征求意见稿）》</a> 是既 <a href="/Payment/法规/rules-pboc-no21/index.html">21号文 </a> 之后，又一部关于支付受理终端的法规。</p></blockquote><a id="more"></a><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h3 id="终端问题"><a href="#终端问题" class="headerlink" title="终端问题"></a>终端问题</h3><p>现象</p><ul><li>买卖终端</li><li>移机</li><li>一机多码</li><li>一机多户</li><li>…..</li></ul><p>严重性</p><ul><li>为违法犯罪分子进行资金转移带来便利</li></ul><h3 id="特约商户问题"><a href="#特约商户问题" class="headerlink" title="特约商户问题"></a>特约商户问题</h3><p>现象</p><ul><li>准入不严格</li><li>核实流于形式</li></ul><p>严重性</p><ul><li>虚假商户问题任然突出</li></ul><h3 id="条码支付问题"><a href="#条码支付问题" class="headerlink" title="条码支付问题"></a>条码支付问题</h3><p>现象</p><ul><li>没有健全条码支付终端、收单条码管理机制</li></ul><p>严重性</p><ul><li>导致条码支付业务涉黑灰产的风险加大</li></ul><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><ul><li>规范收单等业务管理</li><li>打击跨境赌博、电信诈骗等违法犯罪活动</li><li>切断黑灰产业资金链</li><li>保障社会公众利益</li></ul><h2 id="整治方向"><a href="#整治方向" class="headerlink" title="整治方向"></a>整治方向</h2><h3 id="支付受理终端管理"><a href="#支付受理终端管理" class="headerlink" title="支付受理终端管理"></a>支付受理终端管理</h3><ul><li><p>银行卡受理终端</p><p><img src="/Payment/%E6%B3%95%E8%A7%84/rules-pboc-terminal-202006/Terminal_202006_Card.png" alt></p><blockquote><p>F -  终端生产厂商  - 深蓝青色<br>A - 收单机构 - 橘色<br>C -  清算机构 - 蓝色<br>五要素： 收单机构代码、特约商户编码、特约商户统一社会信用代码（小微商户为负责人身份证件号码）、特约商户收单结算账户、银行卡受理终端布放地址</p></blockquote></li><li><p>条码支付受理终端</p><ul><li><p>受理终端</p><p>终端序列号与五要素</p></li><li><p>辅助受理终端</p><p>四要素</p></li><li><p>收款条码</p><p>区分个人和特约商户</p></li></ul><blockquote><p>四要素： 收单机构代码、特约商户统一社会信用代码、特约商户收单结算账户和特约商户经营地址</p></blockquote></li><li><p>创新支付受理终端</p><p>至少提前30日向中国人民银行及其分支机构报告</p></li></ul><h3 id="特约商户管理"><a href="#特约商户管理" class="headerlink" title="特约商户管理"></a>特约商户管理</h3><ul><li>特约商户实名制</li><li>明确商户信息核验方式<ul><li>面对面</li><li>同步视频</li></ul></li><li>特约商户巡检要求</li></ul><h3 id="收单业务监测"><a href="#收单业务监测" class="headerlink" title="收单业务监测"></a>收单业务监测</h3><ul><li>交易信息的真实性和完整性</li><li>终端位置监测</li><li>特约商户资金结算监测</li><li>专项监测与信息核对<ul><li>边境地区</li><li>核对交易信息和五要素不一致的</li></ul></li></ul><h3 id="监督管理等相关内容"><a href="#监督管理等相关内容" class="headerlink" title="监督管理等相关内容"></a>监督管理等相关内容</h3><ul><li>相关市场主体报送落实情况和工作计划</li><li>明确对银行、支付机构、清算机构的违反行为相关罚则</li></ul><h2 id="解读"><a href="#解读" class="headerlink" title="解读"></a>解读</h2><p>该条法主要是解决：打击跨境赌博、电信诈骗等违法犯罪活动，切断黑灰产业资金链；相关的跨境赌博新闻可以参考：<a href="http://www.cyberpolice.cn/wfjb/html/zcjd/20200701/4739.shtml" target="_blank" rel="noopener">http://www.cyberpolice.cn/wfjb/html/zcjd/20200701/4739.shtml</a></p><p>现如今的条码支付或者叫二维码大家更熟知，大家的微信或者支付宝的二维码是有付款功能的，所以很多跑分平台（码商）利用大量个人收款条码来化整为零，从而给监管带来很大的难度。大概的操作流程请看下图；其资金的流向从原来原来的客户到支付机构的流向，转化为客户向客户C2C的流向了；</p><p><img src="/Payment/%E6%B3%95%E8%A7%84/rules-pboc-terminal-202006/%E8%B7%91%E5%88%86.png" alt="跑分平台与赌博平台"></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.pbc.gov.cn/tiaofasi/144941/144979/3941920/4035719/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;《中国人民银行关于加强支付受理终端及相关业务管理的通知（征求意见稿）》&lt;/a&gt; 是既 &lt;a href=&quot;/Payment/法规/rules-pboc-no21/index.html&quot;&gt;21号文 &lt;/a&gt; 之后，又一部关于支付受理终端的法规。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/categories/Payment/"/>
    
    <category term="法规" scheme="https://lianyouli.gitee.io/categories/Payment/%E6%B3%95%E8%A7%84/"/>
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/tags/Payment/"/>
    
    <category term="中国人民银行法规" scheme="https://lianyouli.gitee.io/tags/%E4%B8%AD%E5%9B%BD%E4%BA%BA%E6%B0%91%E9%93%B6%E8%A1%8C%E6%B3%95%E8%A7%84/"/>
    
    <category term="终端" scheme="https://lianyouli.gitee.io/tags/%E7%BB%88%E7%AB%AF/"/>
    
  </entry>
  
</feed>
