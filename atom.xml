<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>联友的Blog</title>
  <icon>https://lianyouli.gitee.io/icon.png</icon>
  <subtitle>密涅瓦的猫头鹰在黄昏起飞</subtitle>
  <link href="https://lianyouli.gitee.io/atom.xml" rel="self"/>
  
  <link href="https://lianyouli.gitee.io/"/>
  <updated>2022-05-28T01:33:01.320Z</updated>
  <id>https://lianyouli.gitee.io/</id>
  
  <author>
    <name>李联友</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Flink安装</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-flink-installation/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-flink-installation/</id>
    <published>2022-05-27T11:10:37.000Z</published>
    <updated>2022-05-28T01:33:01.320Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>对于学习一个新的事物时，最好的开始就是把它运行起来；当实操时，才能更深地理解一些新的概念以及其边界。</p><p>flink 1.14.4 standalone 安装， Zookeeper HA 安装</p></blockquote><a id="more"></a><h2 id="Standalone"><a href="#Standalone" class="headerlink" title="Standalone"></a>Standalone</h2><p>如果一台机器，直接启动就可以使用了。</p><p>如果是多台机器，则需要在</p><ul><li><strong>masters</strong> 配置一台job manager 主机名称</li><li><strong>workers</strong>文件里配置所有节点信息</li><li><strong>jobmanager.rpc.address</strong> 配置成<strong>masters</strong>里的机器主机名称。</li><li>服务启动账户在机器之间免密登录</li></ul><h2 id="Zookeeper-HA"><a href="#Zookeeper-HA" class="headerlink" title="Zookeeper HA"></a>Zookeeper HA</h2><p><a href="https://nightlies.apache.org/flink/flink-docs-release-1.15/docs/deployment/ha/zookeeper_ha/" target="_blank" rel="noopener">ZooKeeper HA Services | Apache Flink</a></p><h3 id="flink-shade-hadoop"><a href="#flink-shade-hadoop" class="headerlink" title="flink-shade-hadoop"></a>flink-shade-hadoop</h3><p>根据自己的版本将对应的flink-shaded-hadoop-X-uber下载下来，放到lib目录。 因为HA时，参数high-availability.storageDir 需要存放在分布式文件系统上。</p> <img src="/IT/it-bigdata-flink-installation/image-20220527210655782.png" alt="image-20220527210655782" style="zoom:50%;"><h3 id="flink-conf-xml"><a href="#flink-conf-xml" class="headerlink" title="flink-conf.xml"></a>flink-conf.xml</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line"><span class="comment"># High Availability</span></span><br><span class="line"><span class="comment">#==============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The high-availability mode. Possible options are 'NONE' or 'zookeeper'.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">high-availability:</span> <span class="string">zookeeper</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The path where metadata for master recovery is persisted. While ZooKeeper stores</span></span><br><span class="line"><span class="comment"># the small ground truth for checkpoint and leader election, this location stores</span></span><br><span class="line"><span class="comment"># the larger objects, like persisted dataflow graphs.</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Must be a durable file system that is accessible from all nodes</span></span><br><span class="line"><span class="comment"># (like HDFS, S3, Ceph, nfs, ...) </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">high-availability.storageDir:</span> <span class="string">hdfs:///lab/flink/ha/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The list of ZooKeeper quorum peers that coordinate the high-availability</span></span><br><span class="line"><span class="comment"># setup. This must be a list of the form:</span></span><br><span class="line"><span class="comment"># "host1:clientPort,host2:clientPort,..." (default clientPort: 2181)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">high-availability.zookeeper.quorum:</span> <span class="string">localhost:2181</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The root ZooKeeper node, under which all cluster nodes are placed.</span></span><br><span class="line"><span class="attr">high-availability.zookeeper.path.root:</span> <span class="string">/flink</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Optional, The cluster-id ZooKeeper node, under which all required coordination data for a cluster is placed.</span></span><br><span class="line"><span class="attr">high-availability.cluster-id:</span> <span class="string">/flink_arthur_ns</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ACL options are based on https://zookeeper.apache.org/doc/r3.1.2/zookeeperProgrammers.html#sc_BuiltinACLSchemes</span></span><br><span class="line"><span class="comment"># It can be either "creator" (ZOO_CREATE_ALL_ACL) or "open" (ZOO_OPEN_ACL_UNSAFE)</span></span><br><span class="line"><span class="comment"># The default value is "open" and it can be changed to "creator" if ZK security is enabled</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># high-availability.zookeeper.client.acl: open</span></span><br></pre></td></tr></table></figure><h3 id="zookeeper"><a href="#zookeeper" class="headerlink" title="zookeeper"></a>zookeeper</h3><p>我使用的是独立的单节点的zookeeper。</p><p>不过flink自带了zookeeper，可以通过配置conf/zoo.cfg，然后执行bin/start-zookeeper-quorum.sh 启动</p><h3 id="masters"><a href="#masters" class="headerlink" title="masters"></a>masters</h3><p>根据自己实际情况配置多个master，以实现HA。不过我只配置一个做测试。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">localhost:8081</span><br><span class="line">extra-master-node1:8081</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="workers"><a href="#workers" class="headerlink" title="workers"></a>workers</h3><p>配置不是job manager角色的机器。</p><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  flink bin/start-cluster.sh </span><br><span class="line">Starting HA cluster with 1 masters.</span><br><span class="line">Starting standalonesession daemon on host sleety.local.</span><br><span class="line">Starting taskexecutor daemon on host sleety.local.</span><br></pre></td></tr></table></figure><h3 id="zookeeper-记录"><a href="#zookeeper-记录" class="headerlink" title="zookeeper 记录"></a>zookeeper 记录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 43] ls /</span><br><span class="line">[flink, zookeeper]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 44] ls /flink</span><br><span class="line">[flink_arthur_ns]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 45] ls /flink/flink_arthur_ns</span><br><span class="line">[jobgraphs, leader]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 46] ls /flink/flink_arthur_ns/leader</span><br><span class="line">[dispatcher, resource_manager, rest_server]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 47] ls /flink/flink_arthur_ns/leader/resource_manager</span><br><span class="line">[connection_info, latch]</span><br><span class="line">[zk: localhost:2181(CONNECTED) 48] get /flink/flink_arthur_ns/leader/resource_manager/connection_info</span><br><span class="line">��w=;akka.tcp://flink@localhost:52797/user/rpc/resourcemanager_1srjava.util.UUID����m�/J</span><br><span class="line">                                                                                        leastSigBitsJ</span><br><span class="line">                                                                                                     mostSigBitsxp�kNP�OD�)7Y��H?</span><br><span class="line">[zk: localhost:2181(CONNECTED) 49] get /flink/flink_arthur_ns/leader/rest_server/connection_info </span><br><span class="line">��whttp://localhost:8081srjava.util.UUID����m�/J</span><br><span class="line">                                                leastSigBitsJ</span><br><span class="line">                                                             mostSigBitsxp�</span><br><span class="line">                                                                           �0A�hVp��J�</span><br><span class="line">[zk: localhost:2181(CONNECTED) 50]</span><br></pre></td></tr></table></figure><h3 id="hdfs-ha目录"><a href="#hdfs-ha目录" class="headerlink" title="hdfs ha目录"></a>hdfs ha目录</h3><p><img src="/IT/it-bigdata-flink-installation/image-20220527212122441.png" alt="image-20220527212122441"></p><h2 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h2><p><a href="https://nightlies.apache.org/flink/flink-docs-release-1.15/docs/deployment/resource-providers/yarn/" target="_blank" rel="noopener">YARN | Apache Flink</a></p><h3 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h3><blockquote><p>会读取conf/flink-conf.yml的配置</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HADOOP_CLASSPATH=`hadoop classpath`</span><br><span class="line"><span class="comment"># 以detach模式启动，即客户端关闭掉，也不影响yarn上的application。</span></span><br><span class="line"><span class="comment"># -tm 指定task manager的内存大小</span></span><br><span class="line"><span class="comment"># -jm 指定job  manager的内存大小</span></span><br><span class="line">bin/yarn-session.sh -d  -tm 1024 -jm 1024</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  flink bin/yarn-session.sh -d  -tm 1024 -jm 1024                                         </span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/Users/arthur/opt/apache/flink-1.14.4/lib/log4j-slf4j-impl-2.17.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/Users/arthur/opt/apache/hadoop-3.3.1/share/hadoop/common/lib/slf4j-log4j12-1.7.30.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html<span class="comment">#multiple_bindings for an explanation.</span></span><br><span class="line">SLF4J: Actual binding is of <span class="built_in">type</span> [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2022-05-28 09:16:35,158 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: jobmanager.rpc.address, localhost</span><br><span class="line">2022-05-28 09:16:35,166 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: jobmanager.rpc.port, 6123</span><br><span class="line">2022-05-28 09:16:35,167 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: jobmanager.memory.process.size, 3600m</span><br><span class="line">2022-05-28 09:16:35,167 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: taskmanager.memory.process.size, 4728m</span><br><span class="line">2022-05-28 09:16:35,167 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: taskmanager.numberOfTaskSlots, 4</span><br><span class="line">2022-05-28 09:16:35,167 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: parallelism.default, 1</span><br><span class="line">2022-05-28 09:16:35,167 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: high-availability, zookeeper</span><br><span class="line">2022-05-28 09:16:35,167 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: high-availability.storageDir, hdfs:///lab/flink/ha/</span><br><span class="line">2022-05-28 09:16:35,167 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: high-availability.zookeeper.quorum, localhost:2181</span><br><span class="line">2022-05-28 09:16:35,168 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: high-availability.zookeeper.path.root, /flink</span><br><span class="line">2022-05-28 09:16:35,168 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: high-availability.cluster-id, /flink_arthur_ns</span><br><span class="line">2022-05-28 09:16:35,168 INFO  org.apache.flink.configuration.GlobalConfiguration           [] - Loading configuration property: jobmanager.execution.failover-strategy, region</span><br><span class="line">2022-05-28 09:16:35,205 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                [] - Found Yarn properties file under /var/folders/y7/45pp3_f51f5f0z_mcj851j4h0000gn/T/.yarn-properties-arthur.</span><br><span class="line">2022-05-28 09:16:35,645 WARN  org.apache.hadoop.util.NativeCodeLoader                      [] - Unable to load native-hadoop library <span class="keyword">for</span> your platform... using <span class="built_in">builtin</span>-java classes <span class="built_in">where</span> applicable</span><br><span class="line">2022-05-28 09:16:35,812 INFO  org.apache.flink.runtime.security.modules.HadoopModule       [] - Hadoop user <span class="built_in">set</span> to arthur (auth:SIMPLE)</span><br><span class="line">2022-05-28 09:16:35,846 INFO  org.apache.flink.runtime.security.modules.JaasModule         [] - Jaas file will be created as /var/folders/y7/45pp3_f51f5f0z_mcj851j4h0000gn/T/jaas-11283110048640415560.conf.</span><br><span class="line">2022-05-28 09:16:35,914 WARN  org.apache.flink.yarn.configuration.YarnLogConfigUtil        [] - The configuration directory (<span class="string">'/Users/arthur/opt/apache/flink-1.14.4/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">2022-05-28 09:16:35,998 INFO  org.apache.hadoop.yarn.client.RMProxy                        [] - Connecting to ResourceManager at localhost/127.0.0.1:8050</span><br><span class="line">2022-05-28 09:16:36,292 INFO  org.apache.flink.runtime.util.config.memory.ProcessMemoryUtils [] - The derived from fraction jvm overhead memory (102.400mb (107374184 bytes)) is less than its min value 192.000mb (201326592 bytes), min value will be used instead</span><br><span class="line">2022-05-28 09:16:36,298 INFO  org.apache.flink.runtime.util.config.memory.ProcessMemoryUtils [] - The derived from fraction jvm overhead memory (102.400mb (107374184 bytes)) is less than its min value 192.000mb (201326592 bytes), min value will be used instead</span><br><span class="line">2022-05-28 09:16:36,298 INFO  org.apache.flink.runtime.util.config.memory.ProcessMemoryUtils [] - The derived from fraction network memory (57.600mb (60397978 bytes)) is less than its min value 64.000mb (67108864 bytes), min value will be used instead</span><br><span class="line">2022-05-28 09:16:36,526 INFO  org.apache.hadoop.conf.Configuration                         [] - resource-types.xml not found</span><br><span class="line">2022-05-28 09:16:36,526 INFO  org.apache.hadoop.yarn.util.resource.ResourceUtils           [] - Unable to find <span class="string">'resource-types.xml'</span>.</span><br><span class="line">2022-05-28 09:16:36,595 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - Cluster specification: ClusterSpecification&#123;masterMemoryMB=1024, taskManagerMemoryMB=1024, slotsPerTaskManager=4&#125;</span><br><span class="line">2022-05-28 09:16:39,052 INFO  org.apache.flink.runtime.util.config.memory.ProcessMemoryUtils [] - The derived from fraction jvm overhead memory (102.400mb (107374184 bytes)) is less than its min value 192.000mb (201326592 bytes), min value will be used instead</span><br><span class="line">2022-05-28 09:16:39,066 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - Submitting application master application_1653690191446_0011</span><br><span class="line">2022-05-28 09:16:39,115 INFO  org.apache.hadoop.yarn.client.api.impl.YarnClientImpl        [] - Submitted application application_1653690191446_0011</span><br><span class="line">2022-05-28 09:16:39,115 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - Waiting <span class="keyword">for</span> the cluster to be allocated</span><br><span class="line">2022-05-28 09:16:39,117 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - Deploying cluster, current state ACCEPTED</span><br><span class="line">2022-05-28 09:16:57,652 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - YARN application has been deployed successfully.</span><br><span class="line">2022-05-28 09:16:57,653 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - Found Web Interface localhost:58343 of application <span class="string">'application_1653690191446_0011'</span>.</span><br><span class="line">2022-05-28 09:16:57,949 INFO  org.apache.flink.shaded.curator4.org.apache.curator.utils.Compatibility [] - Running <span class="keyword">in</span> ZooKeeper 3.4.x compatibility mode</span><br><span class="line">2022-05-28 09:16:57,949 INFO  org.apache.flink.shaded.curator4.org.apache.curator.utils.Compatibility [] - Using emulated InjectSessionExpiration</span><br><span class="line">2022-05-28 09:16:57,975 INFO  org.apache.flink.shaded.curator4.org.apache.curator.framework.imps.CuratorFrameworkImpl [] - Starting</span><br><span class="line">2022-05-28 09:16:57,993 INFO  org.apache.flink.shaded.curator4.org.apache.curator.framework.imps.CuratorFrameworkImpl [] - Default schema</span><br><span class="line">2022-05-28 09:16:57,993 WARN  org.apache.flink.shaded.zookeeper3.org.apache.zookeeper.ClientCnxn [] - SASL configuration failed: javax.security.auth.login.LoginException: No JAAS configuration section named <span class="string">'Client'</span> was found <span class="keyword">in</span> specified JAAS configuration file: <span class="string">'/var/folders/y7/45pp3_f51f5f0z_mcj851j4h0000gn/T/jaas-11283110048640415560.conf'</span>. Will <span class="built_in">continue</span> connection to Zookeeper server without SASL authentication, <span class="keyword">if</span> Zookeeper server allows it.</span><br><span class="line">2022-05-28 09:16:57,995 ERROR org.apache.flink.shaded.curator4.org.apache.curator.ConnectionState [] - Authentication failed</span><br><span class="line">2022-05-28 09:16:58,000 INFO  org.apache.flink.shaded.curator4.org.apache.curator.framework.state.ConnectionStateManager [] - State change: CONNECTED</span><br><span class="line">2022-05-28 09:16:58,020 INFO  org.apache.flink.runtime.leaderretrieval.DefaultLeaderRetrievalService [] - Starting DefaultLeaderRetrievalService with ZookeeperLeaderRetrievalDriver&#123;connectionInformationPath=<span class="string">'/leader/rest_server/connection_info'</span>&#125;.</span><br><span class="line">JobManager Web Interface: http://localhost:58343</span><br><span class="line">2022-05-28 09:16:58,055 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                [] - The Flink YARN session cluster has been started <span class="keyword">in</span> detached mode. In order to stop Flink gracefully, use the following <span class="built_in">command</span>:</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"stop"</span> | ./bin/yarn-session.sh -id application_1653690191446_0011</span><br><span class="line">If this should not be possible, <span class="keyword">then</span> you can also <span class="built_in">kill</span> Flink via YARN<span class="string">'s web interface or via:</span></span><br><span class="line"><span class="string">$ yarn application -kill application_1653690191446_0011</span></span><br><span class="line"><span class="string">Note that killing Flink might not clean up all job artifacts and temporary files.</span></span><br></pre></td></tr></table></figure><p><img src="/IT/it-bigdata-flink-installation/image-20220528092326670.png" alt="image-20220528092326670"></p><h3 id="停Flink"><a href="#停Flink" class="headerlink" title="停Flink"></a>停Flink</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 优雅的方式</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"stop"</span> | ./bin/yarn-session.sh -id &lt;application id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴力的方式</span></span><br><span class="line"><span class="comment"># 可能不会清理job artifacts和temporary files</span></span><br><span class="line">yarn application -<span class="built_in">kill</span> &lt;application id&gt;</span><br></pre></td></tr></table></figure><h3 id="提交任务"><a href="#提交任务" class="headerlink" title="提交任务"></a>提交任务</h3><blockquote><p>yarn-session模式</p></blockquote><h4 id="命令行方式"><a href="#命令行方式" class="headerlink" title="命令行方式"></a>命令行方式</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flink ./bin/flink run -t yarn-session \        </span><br><span class="line"> -Dyarn.application.id=application_1653690191446_0011 \</span><br><span class="line"> ./examples/streaming/TopSpeedWindowing.jar</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  flink ./bin/flink run -t yarn-session \        </span><br><span class="line">  -Dyarn.application.id=application_1653690191446_0011 \</span><br><span class="line">  ./examples/streaming/TopSpeedWindowing.jar</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/Users/arthur/opt/apache/flink-1.14.4/lib/log4j-slf4j-impl-2.17.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/Users/arthur/opt/apache/hadoop-3.3.1/share/hadoop/common/lib/slf4j-log4j12-1.7.30.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html<span class="comment">#multiple_bindings for an explanation.</span></span><br><span class="line">SLF4J: Actual binding is of <span class="built_in">type</span> [org.apache.logging.slf4j.Log4jLoggerFactory]</span><br><span class="line">2022-05-28 09:22:56,925 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                [] - Found Yarn properties file under /var/folders/y7/45pp3_f51f5f0z_mcj851j4h0000gn/T/.yarn-properties-arthur.</span><br><span class="line">2022-05-28 09:22:56,925 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                [] - Found Yarn properties file under /var/folders/y7/45pp3_f51f5f0z_mcj851j4h0000gn/T/.yarn-properties-arthur.</span><br><span class="line">Executing TopSpeedWindowing example with default input data <span class="built_in">set</span>.</span><br><span class="line">Use --input to specify file input.</span><br><span class="line">Printing result to stdout. Use --output to specify output path.</span><br><span class="line">WARNING: An illegal reflective access operation has occurred</span><br><span class="line">WARNING: Illegal reflective access by org.apache.flink.api.java.ClosureCleaner (file:/Users/arthur/opt/apache/flink-1.14.4/lib/flink-dist_2.12-1.14.4.jar) to field java.lang.String.value</span><br><span class="line">WARNING: Please consider reporting this to the maintainers of org.apache.flink.api.java.ClosureCleaner</span><br><span class="line">WARNING: Use --illegal-access=warn to <span class="built_in">enable</span> warnings of further illegal reflective access operations</span><br><span class="line">WARNING: All illegal access operations will be denied <span class="keyword">in</span> a future release</span><br><span class="line">2022-05-28 09:22:57,344 WARN  org.apache.flink.yarn.configuration.YarnLogConfigUtil        [] - The configuration directory (<span class="string">'/Users/arthur/opt/apache/flink-1.14.4/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">2022-05-28 09:22:57,400 INFO  org.apache.hadoop.yarn.client.RMProxy                        [] - Connecting to ResourceManager at localhost/127.0.0.1:8050</span><br><span class="line">2022-05-28 09:22:57,512 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - No path <span class="keyword">for</span> the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2022-05-28 09:22:57,592 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - Found Web Interface localhost:58343 of application <span class="string">'application_1653690191446_0011'</span>.</span><br><span class="line">Job has been submitted with JobID 23d36df8aeabea35eb1ec08e8788bc5b</span><br></pre></td></tr></table></figure><h4 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h4><p><img src="/IT/it-bigdata-flink-installation/image-20220528092940808.png" alt="image-20220528092940808"></p><p><img src="/IT/it-bigdata-flink-installation/image-20220528093009336.png" alt="image-20220528093009336"></p><p><img src="/IT/it-bigdata-flink-installation/image-20220528092526928.png" alt="image-20220528092526928"></p><h3 id="查看任务"><a href="#查看任务" class="headerlink" title="查看任务"></a>查看任务</h3><h4 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flink bin/flink list -a -Dyarn.application.id=&lt;application id&gt; -t yarn-session</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  flink bin/flink list -a -Dyarn.application.id=application_1653690191446_0011 -t yarn-session</span><br><span class="line">2022-05-28 09:31:29,869 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                [] - Found Yarn properties file under /var/folders/y7/45pp3_f51f5f0z_mcj851j4h0000gn/T/.yarn-properties-arthur.</span><br><span class="line">2022-05-28 09:31:29,869 INFO  org.apache.flink.yarn.cli.FlinkYarnSessionCli                [] - Found Yarn properties file under /var/folders/y7/45pp3_f51f5f0z_mcj851j4h0000gn/T/.yarn-properties-arthur.</span><br><span class="line">2022-05-28 09:31:30,026 WARN  org.apache.flink.yarn.configuration.YarnLogConfigUtil        [] - The configuration directory (<span class="string">'/Users/arthur/opt/apache/flink-1.14.4/conf'</span>) already contains a LOG4J config file.If you want to use logback, <span class="keyword">then</span> please delete or rename the <span class="built_in">log</span> configuration file.</span><br><span class="line">2022-05-28 09:31:30,090 INFO  org.apache.hadoop.yarn.client.RMProxy                        [] - Connecting to ResourceManager at localhost/127.0.0.1:8050</span><br><span class="line">2022-05-28 09:31:30,200 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - No path <span class="keyword">for</span> the flink jar passed. Using the location of class org.apache.flink.yarn.YarnClusterDescriptor to locate the jar</span><br><span class="line">2022-05-28 09:31:30,281 INFO  org.apache.flink.yarn.YarnClusterDescriptor                  [] - Found Web Interface localhost:58343 of application <span class="string">'application_1653690191446_0011'</span>.</span><br><span class="line">Waiting <span class="keyword">for</span> response...</span><br><span class="line">------------------ Running/Restarting Jobs -------------------</span><br><span class="line">28.05.2022 09:22:58 : 23d36df8aeabea35eb1ec08e8788bc5b : CarTopSpeedWindowingExample (RUNNING)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">No scheduled <span class="built_in">jobs</span>.</span><br></pre></td></tr></table></figure><h4 id="页面-1"><a href="#页面-1" class="headerlink" title="页面"></a>页面</h4><p><img src="/IT/it-bigdata-flink-installation/image-20220528092824803.png" alt="image-20220528092824803"></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul><li><p>java.lang.NoSuchMethod<strong>Error</strong>: org.apache.commons.cli.Option.builder</p><blockquote><p>flink-arthur-standalonesession-0-sleety.local.out:Exception in thread “main” java.lang.NoSuchMethod<strong>Error</strong>: org.apache.commons.cli.Option.builder(Ljava/lang/String;)Lorg/apache/commons/cli/Option$Builder;</p></blockquote><p>原因</p><blockquote><p>lib目录里缺少 commons-cli-<version>.jar </version></p></blockquote></li></ul><p>  解决方案</p><blockquote><p>将最新版本的commons-cli-1.4.jar放到了lib目录</p></blockquote><p>​    </p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;对于学习一个新的事物时，最好的开始就是把它运行起来；当实操时，才能更深地理解一些新的概念以及其边界。&lt;/p&gt;
&lt;p&gt;flink 1.14.4 standalone 安装， Zookeeper HA 安装&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
    <category term="streaming" scheme="https://lianyouli.gitee.io/tags/streaming/"/>
    
    <category term="flink" scheme="https://lianyouli.gitee.io/tags/flink/"/>
    
  </entry>
  
  <entry>
    <title>hive查询和监控设置</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-hive-simple-query/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-hive-simple-query/</id>
    <published>2022-05-08T00:46:55.000Z</published>
    <updated>2022-05-08T09:10:44.774Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>hive查询设置，包括统计信息等以及和prometheus集成</p></blockquote><a id="more"></a><h2 id="统计信息"><a href="#统计信息" class="headerlink" title="统计信息"></a>统计信息</h2> <img src="/IT/it-bigdata-hive-simple-query/image-20220508091900565.png" alt="image-20220508091900565" style="zoom: 33%;"><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span> (<span class="keyword">id</span> <span class="keyword">string</span>);</span><br></pre></td></tr></table></figure><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> <span class="keyword">values</span> (<span class="string">'hello'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> <span class="keyword">values</span> (<span class="string">'hello'</span>);</span><br></pre></td></tr></table></figure><h3 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| test.id  |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| hello    |</span><br><span class="line">| hello    |</span><br><span class="line">+<span class="comment">----------+</span></span><br></pre></td></tr></table></figure><h3 id="查看统计行数"><a href="#查看统计行数" class="headerlink" title="查看统计行数"></a>查看统计行数</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 2    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 2    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">describe</span> formatted <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure><p><img src="/IT/it-bigdata-hive-simple-query/image-20220508085646467.png" alt="image-20220508085646467"></p><h3 id="手动上传文件到-user-hive-warehouse-test"><a href="#手动上传文件到-user-hive-warehouse-test" class="headerlink" title="手动上传文件到/user/hive/warehouse/test"></a>手动上传文件到/user/hive/warehouse/test</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  hive3 cat from_manual_upload </span><br><span class="line">y</span><br></pre></td></tr></table></figure><p><img src="/IT/it-bigdata-hive-simple-query/image-20220508085844122.png" alt="image-20220508085844122"></p><h3 id="查看数据-1"><a href="#查看数据-1" class="headerlink" title="查看数据"></a>查看数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| test.id  |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| hello    |</span><br><span class="line">| hello    |</span><br><span class="line">| y        |</span><br><span class="line">+<span class="comment">----------+</span></span><br></pre></td></tr></table></figure><h3 id="查看统计行数-1"><a href="#查看统计行数-1" class="headerlink" title="查看统计行数"></a>查看统计行数</h3><blockquote><p>注意，数据条数依旧是2</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 2    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 2    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">describe</span> formatted <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure><p><img src="/IT/it-bigdata-hive-simple-query/image-20220508085646467.png" alt="image-20220508085646467"></p><h3 id="hive-compute-query-using-stats参数"><a href="#hive-compute-query-using-stats参数" class="headerlink" title="hive.compute.query.using.stats参数"></a>hive.compute.query.using.stats参数</h3><blockquote><p>set hive.compute.query.using.stats=true;  – 默认值，使用统计信息</p><p>这里需要将其设置为false，就会通过计算引擎重新计算</p><p>不过metastore 里的统计信息依旧没有更新</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.compute.query.using.stats=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 3    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 3    |</span><br><span class="line">+<span class="comment">------+</span></span><br></pre></td></tr></table></figure><h3 id="停止收集统计信息"><a href="#停止收集统计信息" class="headerlink" title="停止收集统计信息"></a>停止收集统计信息</h3><p>在大数据量时，在写完数据，做收集统计信息这个过程有点耗时，所以有些场景需要将收集统计信息停止掉，后面重新收集统计信息</p><blockquote><p>set hive.stats.autogather=false;<br>set hive.stats.column.autogather=false;</p></blockquote><h3 id="重新收集统计信息"><a href="#重新收集统计信息" class="headerlink" title="重新收集统计信息"></a>重新收集统计信息</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ANALYZE</span> <span class="keyword">TABLE</span> [db_name.]tablename [<span class="keyword">PARTITION</span>(partcol1[=val1], partcol2[=val2], ...)]  <span class="comment">-- (<span class="doctag">Note:</span> Fully support qualified table name since Hive 1.2.0, see HIVE-10007.)</span></span><br><span class="line">  <span class="keyword">COMPUTE</span> <span class="keyword">STATISTICS</span> </span><br><span class="line">  [<span class="keyword">FOR</span> <span class="keyword">COLUMNS</span>]          <span class="comment">-- (<span class="doctag">Note:</span> Hive 0.10.0 and later.)</span></span><br><span class="line">  [<span class="keyword">CACHE</span> METADATA]       <span class="comment">-- (<span class="doctag">Note:</span> Hive 2.1.0 and later.)</span></span><br><span class="line">  [NOSCAN];</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">analyze</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">compute</span> <span class="keyword">statistics</span> <span class="keyword">for</span> <span class="keyword">columns</span>;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 3    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">id</span>) <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| _c0  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 3    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">describe</span> formatted <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure><blockquote><p>注意，此时numFiles &amp; numRows等信息都依旧修正了。</p></blockquote><p><img src="/IT/it-bigdata-hive-simple-query/image-20220508091532354.png" alt="image-20220508091532354"></p><h3 id="Hive-Metastore-表"><a href="#Hive-Metastore-表" class="headerlink" title="Hive Metastore 表"></a>Hive Metastore 表</h3><p>统计信息存储在 <strong>TABLE_PARAMS</strong></p><p>例如：</p><p><img src="/IT/it-bigdata-hive-simple-query/image-20220508110523658.png" alt="image-20220508110523658"></p><h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><p>hive 默认在10002端口上开启了JMX JVM相关的监控。</p><h3 id="hive-metastore"><a href="#hive-metastore" class="headerlink" title="hive metastore"></a>hive metastore</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.metrics.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Enable metrics on the HiveServer2.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="hive-server2"><a href="#hive-server2" class="headerlink" title="hive server2"></a>hive server2</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.metrics.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Enable metrics on the metastore.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以上两个设置，在重启服务之后，就可以通过jmx访问到相关的监控指标了。</p><h3 id="prometheus"><a href="#prometheus" class="headerlink" title="prometheus"></a>prometheus</h3><h4 id="jmx-exporter"><a href="#jmx-exporter" class="headerlink" title="jmx_exporter"></a>jmx_exporter</h4><ul><li><a href="https://github.com/prometheus/jmx_exporter?msclkid=ed1735b3ce9d11ec9d58a39101eb14ab" target="_blank" rel="noopener">https://github.com/prometheus/jmx_exporter?msclkid=ed1735b3ce9d11ec9d58a39101eb14ab</a></li><li><a href="https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.16.1/jmx_prometheus_javaagent-0.16.1.jar" target="_blank" rel="noopener">https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.16.1/jmx_prometheus_javaagent-0.16.1.jar</a></li></ul><h4 id="监控服务配置文件"><a href="#监控服务配置文件" class="headerlink" title="监控服务配置文件"></a>监控服务配置文件</h4><ul><li>hive_server2.yml</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">startDelaySeconds:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">ssl:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">lowercaseOutputName:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">lowercaseOutputLabelNames:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li><p>hive_metastore.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">startDelaySeconds:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">ssl:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">lowercaseOutputName:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">lowercaseOutputLabelNames:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li></ul><p>例如我这里存放路径如下：</p> <img src="/IT/it-bigdata-hive-simple-query/image-20220508154107035.png" alt="image-20220508154107035" style="zoom: 50%;"><h4 id="hive-env-sh"><a href="#hive-env-sh" class="headerlink" title="hive-env.sh"></a>hive-env.sh</h4><ul><li><p>创建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HIVE_HOME</span>/conf</span><br><span class="line">cp hive-env.sh.template hive-env.sh</span><br></pre></td></tr></table></figure></li><li><p>配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$SERVICE</span>"</span> = <span class="string">"hiveserver2"</span> ] ; <span class="keyword">then</span></span><br><span class="line">HADOOP_CLIENT_OPTS=<span class="string">"<span class="variable">$HADOOP_CLIENT_OPTS</span> -javaagent:/Users/arthur/opt/monitor/prometheus/jmx_prometheus_javaagent-0.16.1.jar=9094:/Users/arthur/opt/monitor/prometheus/hive_server2.yml"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$SERVICE</span>"</span> = <span class="string">"metastore"</span> ] ; <span class="keyword">then</span></span><br><span class="line">HADOOP_CLIENT_OPTS=<span class="string">"<span class="variable">$HADOOP_CLIENT_OPTS</span> -javaagent:/Users/arthur/opt/monitor/prometheus/jmx_prometheus_javaagent-0.16.1.jar=9093:/Users/arthur/opt/monitor/prometheus/hive_metastore.yml"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></li><li><p>整个文件内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment"># or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment"># distributed with this work for additional information</span></span><br><span class="line"><span class="comment"># regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment"># to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment"># "License"); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment"># with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set Hive and Hadoop environment variables here. These variables can be used</span></span><br><span class="line"><span class="comment"># to control the execution of Hive. It should be used by admins to configure</span></span><br><span class="line"><span class="comment"># the Hive installation (so that users do not have to set environment variables</span></span><br><span class="line"><span class="comment"># or set command line parameters to get correct behavior).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The hive service being invoked (CLI etc.) is available via the environment</span></span><br><span class="line"><span class="comment"># variable SERVICE</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hive Client memory usage can be an issue if a large number of clients</span></span><br><span class="line"><span class="comment"># are running at the same time. The flags below have been useful in </span></span><br><span class="line"><span class="comment"># reducing memory usage:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># if [ "$SERVICE" = "cli" ]; then</span></span><br><span class="line"><span class="comment">#   if [ -z "$DEBUG" ]; then</span></span><br><span class="line"><span class="comment">#     export HADOOP_OPTS="$HADOOP_OPTS -XX:NewRatio=12 -Xms10m -XX:MaxHeapFreeRatio=40 -XX:MinHeapFreeRatio=15 -XX:+UseParNewGC -XX:-UseGCOverheadLimit"</span></span><br><span class="line"><span class="comment">#   else</span></span><br><span class="line"><span class="comment">#     export HADOOP_OPTS="$HADOOP_OPTS -XX:NewRatio=12 -Xms10m -XX:MaxHeapFreeRatio=40 -XX:MinHeapFreeRatio=15 -XX:-UseGCOverheadLimit"</span></span><br><span class="line"><span class="comment">#   fi</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$SERVICE</span>"</span> = <span class="string">"hiveserver2"</span> ] ; <span class="keyword">then</span></span><br><span class="line">        HADOOP_CLIENT_OPTS=<span class="string">"<span class="variable">$HADOOP_CLIENT_OPTS</span> -javaagent:/Users/arthur/opt/monitor/prometheus/jmx_prometheus_javaagent-0.16.1.jar=9094:/Users/arthur/opt/monitor/prometheus/hive_server2.yml"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$SERVICE</span>"</span> = <span class="string">"metastore"</span> ] ; <span class="keyword">then</span></span><br><span class="line">        HADOOP_CLIENT_OPTS=<span class="string">"<span class="variable">$HADOOP_CLIENT_OPTS</span> -javaagent:/Users/arthur/opt/monitor/prometheus/jmx_prometheus_javaagent-0.16.1.jar=9093:/Users/arthur/opt/monitor/prometheus/hive_metastore.yml"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The heap size of the jvm stared by hive shell script can be controlled via:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># export HADOOP_HEAPSIZE=1024</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Larger heap size may be required when running queries over large number of files or partitions. </span></span><br><span class="line"><span class="comment"># By default hive shell scripts use a heap size of 256 (MB).  Larger heap size would also be </span></span><br><span class="line"><span class="comment"># appropriate for hive server.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set HADOOP_HOME to point to a specific hadoop install directory</span></span><br><span class="line"><span class="comment"># HADOOP_HOME=$&#123;bin&#125;/../../hadoop</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Hive Configuration Directory can be controlled by:</span></span><br><span class="line"><span class="comment"># export HIVE_CONF_DIR=</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Folder containing extra libraries required for hive compilation/execution can be controlled by:</span></span><br><span class="line"><span class="comment"># export HIVE_AUX_JARS_PATH=</span></span><br></pre></td></tr></table></figure><h4 id="prometheus-yml"><a href="#prometheus-yml" class="headerlink" title="prometheus.yml"></a>prometheus.yml</h4><p>我的prometheus使用的是brew安装的，所以此文件在：/usr/local/etc/prometheus.yml</p><p>需要将开始配置的hiveserver2 和 metastore配置进来，即配置文件中的 hs2 和 hms。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">"prometheus"</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">["localhost:9090"]</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">"nifi"</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">["localhost:9092"]</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">"hs2"</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">["localhost:9094"]</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">"hms"</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span> <span class="string">["localhost:9093"]</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">"nodes"</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">localhost:9100</span></span><br></pre></td></tr></table></figure></li><li><p>重启</p><ul><li>hive metastore</li><li>hive server2</li><li>prometheus</li></ul></li><li><p>效果</p><ul><li><p><a href="http://localhost:9093/metrics" target="_blank" rel="noopener">http://localhost:9093/metrics</a></p></li><li><p><a href="http://localhost:9094/metrics" target="_blank" rel="noopener">http://localhost:9094/metrics</a></p></li><li><p><a href="http://localhost:9090" target="_blank" rel="noopener">http://localhost:9090</a></p><img src="/IT/it-bigdata-hive-simple-query/image-20220508155048646.png" alt="image-20220508155048646" style="zoom:50%;"></li><li><p>grafana<br>做了一个demo</p><p><img src="/IT/it-bigdata-hive-simple-query/image-20220508155247721.png" alt="image-20220508155247721"></p></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;hive查询设置，包括统计信息等以及和prometheus集成&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="hive" scheme="https://lianyouli.gitee.io/tags/hive/"/>
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
    <category term="query" scheme="https://lianyouli.gitee.io/tags/query/"/>
    
    <category term="dml" scheme="https://lianyouli.gitee.io/tags/dml/"/>
    
  </entry>
  
  <entry>
    <title>hive3 安装</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-hive-installation/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-hive-installation/</id>
    <published>2022-05-07T13:54:14.000Z</published>
    <updated>2022-05-08T14:03:20.724Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>hive3安装过程和一些安装问题处理</p></blockquote><a id="more"></a><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>MacOS Monterey</li><li>Oracle JDK 1.8.0_181</li><li>Hadoop-3.3.1</li><li>Hive 3.1.3</li><li>MySQL 8.0.28 </li></ul><h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p><a href="https://cwiki.apache.org/confluence/display/Hive//LanguageManual" target="_blank" rel="noopener">LanguageManual - Apache Hive - Apache Software Foundation</a></p><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p><a href="https://dlcdn.apache.org/hive/hive-3.1.3/apache-hive-3.1.3-bin.tar.gz" target="_blank" rel="noopener">https://dlcdn.apache.org/hive/hive-3.1.3/apache-hive-3.1.3-bin.tar.gz</a></p><h2 id="安装-amp-配置"><a href="#安装-amp-配置" class="headerlink" title="安装 &amp; 配置"></a>安装 &amp; 配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-hive-3.1.3-bin.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我做了一个软链接</span></span><br><span class="line">ln -s apache-hive-3.1.3-bin hive3</span><br></pre></td></tr></table></figure><h3 id="创建MySQL账户-amp-DB"><a href="#创建MySQL账户-amp-DB" class="headerlink" title="创建MySQL账户 &amp; DB"></a>创建MySQL账户 &amp; DB</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="string">`hive313`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span class="comment">/*!80016 DEFAULT ENCRYPTION='N' */</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> hive <span class="keyword">identified</span> <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">'Awesome@123'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> hive313.* <span class="keyword">to</span> hive;</span><br></pre></td></tr></table></figure><h3 id="hive-site-xml"><a href="#hive-site-xml" class="headerlink" title="hive-site.xml"></a>hive-site.xml</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> hive3/conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建hive的配置文件</span></span><br><span class="line">cp hive-default.xml.template hive-site.xml</span><br></pre></td></tr></table></figure><h4 id="db"><a href="#db" class="headerlink" title="db"></a>db</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.db.type<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    Expects one of [derby, oracle, mysql, mssql, postgres].</span><br><span class="line">    Type of database used by the metastore. Information schema <span class="symbol">&amp;amp;</span> JDBCStorageHandler depend on it.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/hive313?useSSL=false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    JDBC connect string for a JDBC metastore.</span><br><span class="line">    To use SSL to encrypt/authenticate the connection, provide database-specific SSL flag in the connection URL.</span><br><span class="line">    For example, jdbc:postgresql://myhost/db?ssl=true for postgres database.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>Awesome@123<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="hive-metastore"><a href="#hive-metastore" class="headerlink" title="hive metastore"></a>hive metastore</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.uris<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>thrift://localhost:9083<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Thrift URI for the remote metastore. Used by metastore client to connect to remote metastore.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="hive-server2"><a href="#hive-server2" class="headerlink" title="hive server2"></a>hive server2</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Bind host on which to run the HiveServer2 Thrift service.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.transport.mode<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>binary<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    Expects one of [binary, http].</span><br><span class="line">    Transport mode of HiveServer2.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Port number of HiveServer2 Thrift interface when hive.server2.transport.mode is 'binary'.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="hdfs目录"><a href="#hdfs目录" class="headerlink" title="hdfs目录"></a>hdfs目录</h4><blockquote><p>这样设置，将内表和外表都统一在/user/hive/warehouse目录下。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/warehouse/managed<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>location of default database for the warehouse<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.external.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/warehouse/external<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Default location for external tables created in the warehouse. If not set or null, then the normal warehouse location will be used as the default location.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>默认配置文件中有大量的${system:java.io.tmpdir} 和 ${system:user.name}，在我的电脑上有点问题，所以我全部将这些变量替换成了我自己的设置</p><p>${system:java.io.tmpdir}  ==&gt; /Users/arthur/opt/apache/hive3/logs</p><p>${system:user.name} ==&gt; arthur</p><h4 id="监控设置"><a href="#监控设置" class="headerlink" title="监控设置"></a>监控设置</h4><p>如果要开启hive metastore &amp; hive server2的指标监控，请参考<a href="it-bigdata-hive-simple-query.md">hive查询和监控设置</a></p><h3 id="日志配置文件"><a href="#日志配置文件" class="headerlink" title="日志配置文件"></a>日志配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HIVE_HOME</span>/conf</span><br><span class="line">cp hive-log4j2.properties.template hive-log4j2.properties</span><br><span class="line"><span class="comment"># 同变量部分，修改property.hive.log.dir。</span></span><br></pre></td></tr></table></figure><p>Beeline 客户端日志配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp beeline-log4j2.properties.template beeline-log4j2.properties</span><br></pre></td></tr></table></figure><h2 id="初始化schema"><a href="#初始化schema" class="headerlink" title="初始化schema"></a>初始化schema</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/schematool -dbType mysql -initSchema</span><br></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><h3 id="metastore"><a href="#metastore" class="headerlink" title="metastore"></a>metastore</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/hive --service metastore  &amp;</span><br></pre></td></tr></table></figure><h3 id="Hive-server2"><a href="#Hive-server2" class="headerlink" title="Hive server2"></a>Hive server2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin&#x2F;hive --service hiveserver2  &amp;</span><br></pre></td></tr></table></figure><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><h3 id="beeline"><a href="#beeline" class="headerlink" title="beeline"></a>beeline</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/beeline -u jdbc:hive2://localhost:10000 -n <span class="string">"arthur"</span> -p <span class="string">""</span></span><br></pre></td></tr></table></figure><h3 id="dbeaver"><a href="#dbeaver" class="headerlink" title="dbeaver"></a>dbeaver</h3><p>我这个社区22.0.0版本的有点不太友好，特别是在insert into这种语句时，会有问题，同时sql支持有点差。</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul><li><p>hive.txn.xlock.iow注释问题</p><blockquote><p> 删除 &amp;#8;</p><p>下面是的配置是正确的</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.txn.xlock.iow<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    Ensures commands with OVERWRITE (such as INSERT OVERWRITE) acquire Exclusive locks for transactional tables.  This ensures that inserts (w/o overwrite) running concurrently</span><br><span class="line">    are not hidden by the INSERT OVERWRITE.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>cannot recognize input near ‘SHOW’ ‘INDEX’ ‘ON’ in ddl statement</p><blockquote><p>在执行select语句时，hive后台日志报错，具体的错误日志如下，</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &gt;-- a. 后台日志报错</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dumy;</span><br><span class="line"><span class="comment">-- b. 后台无报错</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> default.dumy;</span><br><span class="line"><span class="comment">-- c. 后台无报错</span></span><br><span class="line"><span class="keyword">use</span> <span class="keyword">default</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dumy;</span><br></pre></td></tr></table></figure></blockquote><p>原因</p><blockquote><p>经过测试，导致此问题的原因有可能是没有指定default数据库。</p></blockquote></li></ul><pre><code>报错日志<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">022</span>-<span class="number">05</span>-<span class="number">07</span>T21:<span class="number">52</span>:<span class="number">18</span>,<span class="number">858</span>  WARN [HiveServer2-Handler-Pool: Thread-<span class="number">56</span>] thrift.ThriftCLIService: Error executing statement: </span><br><span class="line">org.apache.hive.service.cli.HiveSQLException: Error <span class="keyword">while</span> compiling statement: FAILED: ParseException line <span class="number">1</span>:<span class="number">5</span> cannot recognize input near <span class="string">'SHOW'</span> <span class="string">'INDEX'</span> <span class="string">'ON'</span> in ddl statement</span><br><span class="line">at org.apache.hive.service.cli.operation.Operation.toSQLException(Operation.java:<span class="number">335</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:<span class="number">199</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.operation.SQLOperation.runInternal(SQLOperation.java:<span class="number">260</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.operation.Operation.run(Operation.java:<span class="number">247</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementInternal(HiveSessionImpl.java:<span class="number">541</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.session.HiveSessionImpl.executeStatementAsync(HiveSessionImpl.java:<span class="number">527</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:<span class="number">78</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.session.HiveSessionProxy.access$<span class="number">000</span>(HiveSessionProxy.java:<span class="number">36</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.session.HiveSessionProxy$<span class="number">1</span>.run(HiveSessionProxy.java:<span class="number">63</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at java.security.AccessController.doPrivileged(Native Method) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at javax.security.auth.Subject.doAs(Subject.java:<span class="number">422</span>) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:<span class="number">1878</span>) ~[hadoop-common-<span class="number">3.3</span><span class="number">.1</span>.jar:?]</span><br><span class="line">at org.apache.hive.service.cli.session.HiveSessionProxy.invoke(HiveSessionProxy.java:<span class="number">59</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at com.sun.proxy.$Proxy37.executeStatementAsync(Unknown Source) ~[?:?]</span><br><span class="line">at org.apache.hive.service.cli.CLIService.executeStatementAsync(CLIService.java:<span class="number">312</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.thrift.ThriftCLIService.ExecuteStatement(ThriftCLIService.java:<span class="number">562</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:<span class="number">1557</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.rpc.thrift.TCLIService$Processor$ExecuteStatement.getResult(TCLIService.java:<span class="number">1542</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:<span class="number">39</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:<span class="number">39</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.auth.TSetIpAddressProcessor.process(TSetIpAddressProcessor.java:<span class="number">56</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:<span class="number">286</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:<span class="number">1149</span>) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:<span class="number">624</span>) ~[?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">at java.lang.Thread.run(Thread.java:<span class="number">748</span>) [?:<span class="number">1.8</span><span class="number">.0_181</span>]</span><br><span class="line">Caused by: org.apache.hadoop.hive.ql.parse.ParseException: line <span class="number">1</span>:<span class="number">5</span> cannot recognize input near <span class="string">'SHOW'</span> <span class="string">'INDEX'</span> <span class="string">'ON'</span> in ddl statement</span><br><span class="line">at org.apache.hadoop.hive.ql.parse.ParseDriver.parse(ParseDriver.java:<span class="number">223</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hadoop.hive.ql.parse.ParseUtils.parse(ParseUtils.java:<span class="number">74</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hadoop.hive.ql.parse.ParseUtils.parse(ParseUtils.java:<span class="number">67</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.compile(Driver.java:<span class="number">616</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:<span class="number">1826</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:<span class="number">1773</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:<span class="number">1768</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hadoop.hive.ql.reexec.ReExecDriver.compileAndRespond(ReExecDriver.java:<span class="number">126</span>) ~[hive-exec-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">at org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:<span class="number">197</span>) ~[hive-service-<span class="number">3.1</span><span class="number">.3</span>.jar:<span class="number">3.1</span><span class="number">.3</span>]</span><br><span class="line">... <span class="number">27</span> more</span><br></pre></td></tr></table></figure></code></pre><ul><li><p>Count(*) 不报错 ，而count(x) 时报错</p><blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- a. 不报错</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> dumy;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">+------+</span></span><br><span class="line"><span class="comment">| _c0  |</span></span><br><span class="line"><span class="comment">+------+</span></span><br><span class="line"><span class="comment">| 1    |</span></span><br><span class="line"><span class="comment">+------+</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- b. 报错, 报错信息如下</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> dumy;</span><br></pre></td></tr></table></figure></blockquote><p>报错日志</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Error: Error <span class="keyword">while</span> processing statement: FAILED: Execution Error, <span class="keyword">return</span> code <span class="number">1</span> from org.apache.hadoop.hive.ql.exec.mr.MapRedTask. Permission denied: user=anonymous, access=EXECUTE, inode=<span class="string">"/tmp/hadoop-yarn"</span>:arthur:supergroup:drwx------</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:<span class="number">504</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkTraverse(FSPermissionChecker.java:<span class="number">420</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:<span class="number">323</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermissionWithContext(FSPermissionChecker.java:<span class="number">360</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:<span class="number">240</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkTraverse(FSPermissionChecker.java:<span class="number">711</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkTraverse(FSDirectory.java:<span class="number">1888</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkTraverse(FSDirectory.java:<span class="number">1906</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSDirectory.resolvePath(FSDirectory.java:<span class="number">727</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSDirStatAndListingOp.getFileInfo(FSDirStatAndListingOp.java:<span class="number">112</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getFileInfo(FSNamesystem.java:<span class="number">3355</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getFileInfo(NameNodeRpcServer.java:<span class="number">1219</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolServerSideTranslatorPB.getFileInfo(ClientNamenodeProtocolServerSideTranslatorPB.java:<span class="number">1042</span>)</span><br><span class="line">at org.apache.hadoop.hdfs.protocol.proto.ClientNamenodeProtocolProtos$ClientNamenodeProtocol$<span class="number">2</span>.callBlockingMethod(ClientNamenodeProtocolProtos.java)</span><br><span class="line">at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:<span class="number">600</span>)</span><br><span class="line">at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:<span class="number">568</span>)</span><br><span class="line">at org.apache.hadoop.ipc.ProtobufRpcEngine2$Server$ProtoBufRpcInvoker.call(ProtobufRpcEngine2.java:<span class="number">552</span>)</span><br><span class="line">at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:<span class="number">1093</span>)</span><br><span class="line">at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:<span class="number">1035</span>)</span><br><span class="line">at org.apache.hadoop.ipc.Server$RpcCall.run(Server.java:<span class="number">963</span>)</span><br><span class="line">at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">at javax.security.auth.Subject.doAs(Subject.java:<span class="number">422</span>)</span><br><span class="line">at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:<span class="number">1878</span>)</span><br><span class="line">at org.apache.hadoop.ipc.Server$Handler.run(Server.java:<span class="number">2966</span>) (state=<span class="number">08</span>S01,code=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>原因</p><blockquote><p>不过为啥会一样的原因是因为hive在执行一些统计信息时，是不会真的去执行，而是直接从元数据库里返回。所以count(*)就是直接返回。而有些操作则会调用执行引擎执行任务。</p></blockquote><p>解决报错问题</p><ol><li><p>tmp及其子目录赋予权限。 这种不建议</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -chmod -R 777 /tmp</span><br></pre></td></tr></table></figure></li><li><p>beeline 登录参数配置好用户名</p><p>   默认登录的用户为</p>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- bin/beeline -u jdbc:hive2://localhost:10000</span></span><br><span class="line">0: jdbc:hive2://localhost:10000&gt; select current_user();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">+------------+</span></span><br><span class="line"><span class="comment">|    _c0     |</span></span><br><span class="line"><span class="comment">+------------+</span></span><br><span class="line"><span class="comment">| anonymous  |</span></span><br><span class="line"><span class="comment">+------------+</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>   加上用户信息</p>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- bin/beeline -u jdbc:hive2://localhost:10000 -n arthur -p ""</span></span><br><span class="line">0: jdbc:hive2://localhost:10000&gt; select current_user();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">+------------+</span></span><br><span class="line"><span class="comment">|    _c0     |</span></span><br><span class="line"><span class="comment">+------------+</span></span><br><span class="line"><span class="comment">| arthur     |</span></span><br><span class="line"><span class="comment">+------------+</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li></ol></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;hive3安装过程和一些安装问题处理&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="hive" scheme="https://lianyouli.gitee.io/tags/hive/"/>
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
  </entry>
  
  <entry>
    <title>初探trino</title>
    <link href="https://lianyouli.gitee.io/uncategorized/it-bigdata-distributed-sql-query-engine-trino/"/>
    <id>https://lianyouli.gitee.io/uncategorized/it-bigdata-distributed-sql-query-engine-trino/</id>
    <published>2022-05-02T07:23:46.000Z</published>
    <updated>2022-05-02T09:02:53.197Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>大家对trino没有怎么听说过，我也是在做flink时，有人flink贡献者提到 OLAP 场景下 Flink 与 Trino 确实还存在差距，所以尝试去了解了一下，其与presto SQL是一样的，当然，trino与presto SQL的故事不仅仅如此，请参考<a href="https://trino.io/blog/2020/12/27/announcing-trino.html" target="_blank" rel="noopener">Trino | We’re rebranding PrestoSQL as Trino</a>。</p></blockquote><a id="more"></a><h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><ul><li><a href="https://trino.io/" target="_blank" rel="noopener">trino.io</a></li><li><a href="https://github.com/trinodb/trino" target="_blank" rel="noopener">github</a></li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="下载-amp-安装"><a href="#下载-amp-安装" class="headerlink" title="下载&amp;安装"></a>下载&amp;安装</h3><p><a href="https://trino.io/download.html" target="_blank" rel="noopener">Trino | Get started with Trino</a></p><ul><li><p>Server Package</p><ol><li><p>解压</p><img src="/uncategorized/it-bigdata-distributed-sql-query-engine-trino/image-20220502153434768.png" alt="image-20220502153434768" style="zoom:50%;"></li><li><p>创建data数据目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir data</span><br></pre></td></tr></table></figure></li><li><p>创建etc配置目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir etc</span><br></pre></td></tr></table></figure></li></ol><p>其目录结构如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  trino-server-379 tree -L 1</span><br><span class="line">.</span><br><span class="line">├── NOTICE</span><br><span class="line">├── README.txt</span><br><span class="line">├── bin</span><br><span class="line">├── data</span><br><span class="line">├── etc</span><br><span class="line">├── lib</span><br><span class="line">├── plugin</span><br><span class="line">└── var</span><br></pre></td></tr></table></figure></li><li><p>Command line client</p><p>trino-cli-379-executable.jar</p><p>将此文件下载之后，放到Server Package解压之后的bin目录，然后软链接此文件为trino</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  bin ln -s trino-cli-379-executable.jar trino</span><br><span class="line">(base) ➜  bin ls -l</span><br><span class="line">total 20592</span><br><span class="line">-rwxr-xr-x  1 arthur  staff      1450  4 29 09:36 launcher</span><br><span class="line">-rw-r--r--  1 arthur  staff        65  4 29 09:36 launcher.properties</span><br><span class="line">-rwxr-xr-x  1 arthur  staff     14608  4 29 09:36 launcher.py</span><br><span class="line">drwxr-xr-x  5 arthur  staff       160  4 29 09:36 procname</span><br><span class="line">lrwxr-xr-x  1 arthur  staff        28  5  2 12:39 trino -&gt; trino-cli-379-executable.jar</span><br><span class="line">-rwxr--r--@ 1 arthur  staff  10238827  5  2 03:28 trino-cli-379-executable.jar</span><br></pre></td></tr></table></figure></li></ul><h2 id="trino配置"><a href="#trino配置" class="headerlink" title="trino配置"></a>trino配置</h2><p>示例配置，放到了gitee上<a href="https://gitee.com/lianyouli/trino-quickstart-etc" target="_blank" rel="noopener">trino-quickstart-etc: trino入门配置</a></p><p>配置文档，请参考 <a href="https://trino.io/docs/current/installation/deployment.html" target="_blank" rel="noopener">Deploying Trino — Trino 379 Documentation</a></p><h3 id="node-properties"><a href="#node-properties" class="headerlink" title="node.properties"></a>node.properties</h3><blockquote><p>environment: 你随意，dev/sit/uat/prod等都可以</p><p>id: 节点的唯一标识，同一个集群里不能重名就好</p><p>data-dir:  请配置成你自己的数据目录，请参考步骤安装中的创建的数据目录</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">node.environment</span>=<span class="string">development</span></span><br><span class="line"><span class="meta">node.id</span>=<span class="string">ffff-ffff-ffff</span></span><br><span class="line"><span class="meta">node.data-dir</span>=<span class="string">/Users/arthur/opt/Software/trino/trino-server-379/data</span></span><br></pre></td></tr></table></figure><h3 id="jvm-config"><a href="#jvm-config" class="headerlink" title="jvm.config"></a>jvm.config</h3><blockquote><p>官网示例配置，不过我将内存配置从16G –&gt; 4G。</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">-server</span></span><br><span class="line"><span class="attr">-Xmx4G</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">-UseBiasedLocking</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">+UseG1GC</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">G1HeapRegionSize=32M</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">+ExplicitGCInvokesConcurrent</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">+ExitOnOutOfMemoryError</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">+HeapDumpOnOutOfMemoryError</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">-OmitStackTraceInFastThrow</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">ReservedCodeCacheSize=512M</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">PerMethodRecompilationCutoff=10000</span></span><br><span class="line"><span class="meta">-XX</span>:<span class="string">PerBytecodeRecompilationCutoff=10000</span></span><br><span class="line"><span class="meta">-Djdk.attach.allowAttachSelf</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">-Djdk.nio.maxCachedBufferSize</span>=<span class="string">2000000</span></span><br></pre></td></tr></table></figure><h3 id="config-properties"><a href="#config-properties" class="headerlink" title="config.properties"></a>config.properties</h3><p>trino是类似MPP的架构，要运行起来需要两个角色： Coordinator 和 Worker</p><ul><li><p><strong>Coordinator</strong><br>接收客户发起的查询请求和管理查询的执行；</p><p>设置参数coordinator为true，官方建议使用专用的一台服务器来做Coordinator</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">coordinator</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>如果想设置Coordinator节点也做为worker，可以设置下面参数node-scheduler.include-coordinator为true</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">node-scheduler.include-coordinator</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p><strong>Worker</strong></p><p>运行任务的节点。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">coordinator</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>单机配置需要设置coordinator=true和node-scheduler.include-coordinator=true</p><p>http.port根据实际情况设置即可</p></blockquote><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">coordinator</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">node-scheduler.include-coordinator</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">http-server.http.port</span>=<span class="string">7080</span></span><br><span class="line"><span class="meta">query.max-memory</span>=<span class="string">50GB</span></span><br><span class="line"><span class="meta">query.max-memory-per-node</span>=<span class="string">1GB</span></span><br><span class="line"><span class="meta">discovery.uri</span>=<span class="string">http://localhost:7080</span></span><br></pre></td></tr></table></figure><h3 id="log-properties"><a href="#log-properties" class="headerlink" title="log.properties"></a>log.properties</h3><p>日志级别设置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">io.trino</span>=<span class="string">INFO</span></span><br></pre></td></tr></table></figure><h2 id="Catalog配置"><a href="#Catalog配置" class="headerlink" title="Catalog配置"></a>Catalog配置</h2><p>trino是通过各种connector去访问各种类型的数据源，而这些connector的配置是通过catalog去管理的。</p><p>即通过在catalog里配置数据源的连接信息，用户名，密码等信息，将各种数据源连通起来。</p><h3 id="层级"><a href="#层级" class="headerlink" title="层级"></a>层级</h3><blockquote><p>catalog &gt; schema &gt; table</p></blockquote><ul><li><p>catalog</p><p>catalog名称与catalog目录的各个properties的配置文件名称同名</p></li><li><p>schema</p><p>如果没有的话，可能是default或者可以手动配置，例如kafka。</p><p>有可能是数据库名称，例如mysql。</p></li><li><p>table</p><p>可能是table名称，例如mysql</p><p>也可能是其它的，例如kafka的topic名称。</p></li></ul><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><blockquote><p> etc &gt; catalog</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  etc git:(master) ✗ tree -L 2</span><br><span class="line">.</span><br><span class="line">├── README.MD</span><br><span class="line">├── catalog</span><br><span class="line">│   ├── jmx.properties</span><br><span class="line">│   ├── kafka_flink_sensor_iot.properties</span><br><span class="line">│   ├── mysql_tests.properties</span><br><span class="line">│   └── tpch.properties</span><br><span class="line">├── config.properties</span><br><span class="line">├── jvm.config</span><br><span class="line">├── kafka</span><br><span class="line">│   └── lab-flink-sensor-iot.json</span><br><span class="line">├── log.properties</span><br><span class="line">└── node.properties</span><br><span class="line"></span><br><span class="line">2 directories, 10 files</span><br></pre></td></tr></table></figure><h3 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h3><h4 id="jmx"><a href="#jmx" class="headerlink" title="jmx"></a>jmx</h4><p><a href="https://trino.io/docs/current/connector/jmx.html" target="_blank" rel="noopener">JMX connector — Trino 379 Documentation</a></p><p><strong>jmx.properties</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">connector.name</span>=<span class="string">jmx</span></span><br></pre></td></tr></table></figure><h4 id="tpch"><a href="#tpch" class="headerlink" title="tpch"></a>tpch</h4><p><a href="https://trino.io/docs/current/connector/tpch.html" target="_blank" rel="noopener">TPCH connector — Trino 379 Documentation</a></p><p><strong>tpch.properties</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">connector.name</span>=<span class="string">jmx</span></span><br></pre></td></tr></table></figure><h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p><a href="https://trino.io/docs/current/connector/mysql.html" target="_blank" rel="noopener">MySQL connector — Trino 379 Documentation</a></p><p><strong>mysql_tests.properties</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">connector.name</span>=<span class="string">mysql</span></span><br><span class="line"><span class="meta">connection-url</span>=<span class="string">jdbc:mysql://localhost:3306</span></span><br><span class="line"><span class="meta">connection-user</span>=<span class="string">nifi</span></span><br><span class="line"><span class="meta">connection-password</span>=<span class="string">Awesome@123</span></span><br></pre></td></tr></table></figure><h4 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h4><p><a href="https://trino.io/docs/current/connector/kafka.html" target="_blank" rel="noopener">Kafka connector — Trino 379 Documentation</a></p><p><strong>kafka_flink_sensor_iot.properties</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">connector.name</span>=<span class="string">kafka</span></span><br><span class="line"><span class="meta">kafka.table-names</span>=<span class="string">lab-flink-sensor-iot</span></span><br><span class="line"><span class="meta">kafka.nodes</span>=<span class="string">localhost:9092</span></span><br><span class="line"><span class="meta">kafka.hide-internal-columns</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure><h3 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h3><p><strong>Decoder</strong>是将数据从原始数据格式解析成我们方便读取的格式。</p><p>为什么需要呢decoder呢，请看下图，kafka的消息是csv格式的，所以我们在查看或者查询时都不方便。</p><p><img src="/uncategorized/it-bigdata-distributed-sql-query-engine-trino/image-20220502163335198.png" alt="image-20220502163335198"></p><p>下图是配置了Decoder之后效果，可以看到，_message里的数据展平成独立字段了。</p><p><img src="/uncategorized/it-bigdata-distributed-sql-query-engine-trino/image-20220502163452543.png" alt="image-20220502163452543"></p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><ul><li><p>路径</p><p>以kafka配置为例，其目录结构</p><blockquote><p>etc &gt; kafka </p></blockquote></li><li><p>文件名称随意</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  etc git:(master) ✗ tree -L 2</span><br><span class="line">.</span><br><span class="line">....</span><br><span class="line">├── kafka</span><br><span class="line">│   └── lab-flink-sensor-iot.json</span><br><span class="line">....</span><br></pre></td></tr></table></figure><ul><li><p>文件内容</p><blockquote><p>需要与你的数据匹配上</p><p>tableName: 表名</p><p>schemaName: schema名称，kafka默认是default</p><p>topicName: kafka的topic名称</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"tableName"</span>: <span class="string">"lab-flink-sensor-iot"</span>,</span><br><span class="line">    <span class="attr">"schemaName"</span>: <span class="string">"default"</span>,</span><br><span class="line">    <span class="attr">"topicName"</span>: <span class="string">"lab-flink-sensor-iot"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: &#123;</span><br><span class="line">      <span class="attr">"dataFormat"</span>: <span class="string">"csv"</span>,</span><br><span class="line">      <span class="attr">"fields"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"id"</span>,</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"VARCHAR(10)"</span>,</span><br><span class="line">          <span class="attr">"mapping"</span>: <span class="string">"0"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"timestamp"</span>,</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"BIGINT"</span>,</span><br><span class="line">          <span class="attr">"mapping"</span>: <span class="string">"1"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"temperature"</span>,</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"DOUBLE"</span>,</span><br><span class="line">          <span class="attr">"mapping"</span>: <span class="string">"2"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h3><p><strong>Encoder</strong>是将方便我们读取的数据序列化成方便机器存储的格式。同Decoder，配置也是共享的。</p><h2 id="trino客户端"><a href="#trino客户端" class="headerlink" title="trino客户端"></a>trino客户端</h2><h3 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  trino-server-379 bin/trino --<span class="built_in">help</span></span><br><span class="line">Trino <span class="built_in">command</span> line interface</span><br><span class="line"></span><br><span class="line">USAGE:</span><br><span class="line"></span><br><span class="line">trino [-h] [--debug] [--<span class="built_in">disable</span>-compression] [--external-authentication] [--ignore-errors] [--insecure]</span><br><span class="line">      [--krb5-disable-remote-service-hostname-canonicalization] [--password] [--[no-]progress]</span><br><span class="line">      [--use-system-truststore] [--version] [--access-token=&lt;token&gt;] [--catalog=&lt;catalog&gt;] [--client-info=&lt;info&gt;]</span><br><span class="line">      [--client-request-timeout=&lt;timeout&gt;] [--client-tags=&lt;tags&gt;] [--editing-mode=&lt;editing-mode&gt;] [--execute=&lt;execute&gt;]</span><br><span class="line">      [-f=&lt;file&gt;] [--http-proxy=&lt;proxy&gt;] [--keystore-password=&lt;password&gt;] [--keystore-path=&lt;path&gt;]</span><br><span class="line">      [--keystore-type=&lt;<span class="built_in">type</span>&gt;] [--krb5-config-path=&lt;path&gt;] [--krb5-credential-cache-path=&lt;path&gt;]</span><br><span class="line">      [--krb5-keytab-path=&lt;path&gt;] [--krb5-principal=&lt;principal&gt;] [--krb5-remote-service-name=&lt;name&gt;]</span><br><span class="line">      [--krb5-service-principal-pattern=&lt;pattern&gt;] [--network-logging=&lt;level&gt;] [--output-format=&lt;format&gt;]</span><br><span class="line">      [--schema=&lt;schema&gt;] [--server=&lt;server&gt;] [--session-user=&lt;user&gt;] [--socks-proxy=&lt;proxy&gt;] [--<span class="built_in">source</span>=&lt;<span class="built_in">source</span>&gt;]</span><br><span class="line">      [--timezone=&lt;timezone&gt;] [--trace-token=&lt;token&gt;] [--truststore-password=&lt;password&gt;] [--truststore-path=&lt;path&gt;]</span><br><span class="line">      [--truststore-type=&lt;<span class="built_in">type</span>&gt;] [--user=&lt;user&gt;]</span><br><span class="line">      [--external-authentication-redirect-handler=&lt;externalAuthenticationRedirectHandler&gt;]...</span><br><span class="line">      [--extra-credential=&lt;credential&gt;]... [--resource-estimate=&lt;estimate&gt;]... [--session=&lt;session&gt;]...</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">      --access-token=&lt;token&gt; Access token</span><br><span class="line">      --catalog=&lt;catalog&gt;    Default catalog</span><br><span class="line">      --client-info=&lt;info&gt;   Extra information about client making query</span><br><span class="line">      --client-request-timeout=&lt;timeout&gt;</span><br><span class="line">                             Client request timeout (default: 2m)</span><br><span class="line">      --client-tags=&lt;tags&gt;   Client tags</span><br><span class="line">      --debug                Enable debug information</span><br><span class="line">      --<span class="built_in">disable</span>-compression  Disable compression of query results</span><br><span class="line">      --editing-mode=&lt;editing-mode&gt;</span><br><span class="line">                             Editing mode [EMACS, VI] (default: EMACS)</span><br><span class="line">      --execute=&lt;execute&gt;    Execute specified statements and <span class="built_in">exit</span></span><br><span class="line">      --external-authentication</span><br><span class="line">                             Enable external authentication</span><br><span class="line">      --external-authentication-redirect-handler=&lt;externalAuthenticationRedirectHandler&gt;</span><br><span class="line">                             External authentication redirect handlers: DESKTOP_OPEN, SYSTEM_OPEN, PRINT, OPEN, ALL</span><br><span class="line">                               (default: ALL)</span><br><span class="line">      --extra-credential=&lt;credential&gt;</span><br><span class="line">                             Extra credentials (property can be used multiple <span class="built_in">times</span>; format is key=value)</span><br><span class="line">  -f, --file=&lt;file&gt;          Execute statements from file and <span class="built_in">exit</span></span><br><span class="line">  -h, --<span class="built_in">help</span>                 Show this <span class="built_in">help</span> message and <span class="built_in">exit</span></span><br><span class="line">      --http-proxy=&lt;proxy&gt;   HTTP proxy to use <span class="keyword">for</span> server connections</span><br><span class="line">      --ignore-errors        Continue processing <span class="keyword">in</span> batch mode when an error occurs (default is to <span class="built_in">exit</span> immediately)</span><br><span class="line">      --insecure             Skip validation of HTTP server certificates (should only be used <span class="keyword">for</span> debugging)</span><br><span class="line">      --keystore-password=&lt;password&gt;</span><br><span class="line">                             Keystore password</span><br><span class="line">      --keystore-path=&lt;path&gt; Keystore path</span><br><span class="line">      --keystore-type=&lt;<span class="built_in">type</span>&gt; Keystore <span class="built_in">type</span></span><br><span class="line">      --krb5-config-path=&lt;path&gt;</span><br><span class="line">                             Kerberos config file path (default: /etc/krb5.conf)</span><br><span class="line">      --krb5-credential-cache-path=&lt;path&gt;</span><br><span class="line">                             Kerberos credential cache path</span><br><span class="line">      --krb5-disable-remote-service-hostname-canonicalization</span><br><span class="line">                             Disable service hostname canonicalization using the DNS reverse lookup</span><br><span class="line">      --krb5-keytab-path=&lt;path&gt;</span><br><span class="line">                             Kerberos key table path (default: /etc/krb5.keytab)</span><br><span class="line">      --krb5-principal=&lt;principal&gt;</span><br><span class="line">                             Kerberos principal to be used</span><br><span class="line">      --krb5-remote-service-name=&lt;name&gt;</span><br><span class="line">                             Remote peer<span class="string">'s kerberos service name</span></span><br><span class="line"><span class="string">      --krb5-service-principal-pattern=&lt;pattern&gt;</span></span><br><span class="line"><span class="string">                             Remote kerberos service principal pattern (default: $&#123;SERVICE&#125;@$&#123;HOST&#125;)</span></span><br><span class="line"><span class="string">      --network-logging=&lt;level&gt;</span></span><br><span class="line"><span class="string">                             Network logging level [NONE, BASIC, HEADERS, BODY] (default: NONE)</span></span><br><span class="line"><span class="string">      --output-format=&lt;format&gt;</span></span><br><span class="line"><span class="string">                             Output format for batch mode [ALIGNED, VERTICAL, TSV, TSV_HEADER, CSV, CSV_HEADER,</span></span><br><span class="line"><span class="string">                               CSV_UNQUOTED, CSV_HEADER_UNQUOTED, JSON, NULL] (default: CSV)</span></span><br><span class="line"><span class="string">      --password             Prompt for password</span></span><br><span class="line"><span class="string">      --[no-]progress        Show query progress</span></span><br><span class="line"><span class="string">      --resource-estimate=&lt;estimate&gt;</span></span><br><span class="line"><span class="string">                             Resource estimate (property can be used multiple times; format is key=value)</span></span><br><span class="line"><span class="string">      --schema=&lt;schema&gt;      Default schema</span></span><br><span class="line"><span class="string">      --server=&lt;server&gt;      Trino server location (default: localhost:8080)</span></span><br><span class="line"><span class="string">      --session=&lt;session&gt;    Session property (property can be used multiple times; format is key=value; use '</span>SHOW</span><br><span class="line">                               SESSION<span class="string">' to see available properties)</span></span><br><span class="line"><span class="string">      --session-user=&lt;user&gt;  Username to impersonate</span></span><br><span class="line"><span class="string">      --socks-proxy=&lt;proxy&gt;  SOCKS proxy to use for server connections</span></span><br><span class="line"><span class="string">      --source=&lt;source&gt;      Name of source making query (default: trino-cli)</span></span><br><span class="line"><span class="string">      --timezone=&lt;timezone&gt;  Session time zone (default: Asia/Shanghai)</span></span><br><span class="line"><span class="string">      --trace-token=&lt;token&gt;  Trace token</span></span><br><span class="line"><span class="string">      --truststore-password=&lt;password&gt;</span></span><br><span class="line"><span class="string">                             Truststore password</span></span><br><span class="line"><span class="string">      --truststore-path=&lt;path&gt;</span></span><br><span class="line"><span class="string">                             Truststore path</span></span><br><span class="line"><span class="string">      --truststore-type=&lt;type&gt;</span></span><br><span class="line"><span class="string">                             Truststore type</span></span><br><span class="line"><span class="string">      --use-system-truststore</span></span><br><span class="line"><span class="string">                             Use default system (OS) truststore</span></span><br><span class="line"><span class="string">      --user=&lt;user&gt;          Username (default: arthur)</span></span><br><span class="line"><span class="string">      --version              Print version information and exit</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/trino --server localhost:7080</span><br></pre></td></tr></table></figure><h3 id="查询元数据"><a href="#查询元数据" class="headerlink" title="查询元数据"></a>查询元数据</h3><ul><li><p>查询catalogs</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">trino&gt; show catalogs;</span><br><span class="line">        Catalog         </span><br><span class="line"><span class="comment">------------------------</span></span><br><span class="line"> jmx                    </span><br><span class="line"> kafka_flink_sensor_iot </span><br><span class="line"> mysql_tests            </span><br><span class="line"> system                 </span><br><span class="line"> tpch                   </span><br><span class="line">(5 rows)</span><br><span class="line"></span><br><span class="line">Query 20220502_084453_00010_g7j4t, FINISHED, 1 node</span><br><span class="line">Splits: 7 total, 7 done (100.00%)</span><br><span class="line">0.04 [0 rows, 0B] [0 rows/s, 0B/s]</span><br></pre></td></tr></table></figure></li><li><p>查询schemas</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">trino&gt; show schemas from mysql_tests;</span><br><span class="line">       Schema       </span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line"> datasets           </span><br><span class="line"> hive3              </span><br><span class="line"> hive3statsstore    </span><br><span class="line"> information_schema </span><br><span class="line"> performance_schema </span><br><span class="line"> tests              </span><br><span class="line">(6 rows)</span><br><span class="line"></span><br><span class="line">Query 20220502_084534_00011_g7j4t, FINISHED, 1 node</span><br><span class="line">Splits: 7 total, 7 done (100.00%)</span><br><span class="line">0.05 [6 rows, 99B] [122 rows/s, 1.97KB/s]</span><br><span class="line"></span><br><span class="line">trino&gt; show schemas from kafka_flink_sensor_iot;</span><br><span class="line">       Schema       </span><br><span class="line"><span class="comment">--------------------</span></span><br><span class="line"> default            </span><br><span class="line"> information_schema </span><br><span class="line">(2 rows)</span><br><span class="line"></span><br><span class="line">Query 20220502_084548_00012_g7j4t, FINISHED, 1 node</span><br><span class="line">Splits: 7 total, 7 done (100.00%)</span><br><span class="line">0.03 [2 rows, 35B] [71 rows/s, 1.22KB/s]</span><br></pre></td></tr></table></figure></li><li><p>查询tables</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">trino&gt; show tables from mysql_tests.tests;</span><br><span class="line">  Table   </span><br><span class="line"><span class="comment">----------</span></span><br><span class="line"> nifi_lab </span><br><span class="line"> sensor   </span><br><span class="line"> sensor2  </span><br><span class="line">(3 rows)</span><br><span class="line"></span><br><span class="line">Query 20220502_084652_00014_g7j4t, FINISHED, 1 node</span><br><span class="line">Splits: 7 total, 7 done (100.00%)</span><br><span class="line">0.11 [3 rows, 66B] [27 rows/s, 600B/s]</span><br><span class="line"></span><br><span class="line">trino&gt; show tables from kafka_flink_sensor_iot.default;</span><br><span class="line">        Table         </span><br><span class="line"><span class="comment">----------------------</span></span><br><span class="line"> lab-flink-sensor-iot </span><br><span class="line">(1 row)</span><br><span class="line"></span><br><span class="line">Query 20220502_084636_00013_g7j4t, FINISHED, 1 node</span><br><span class="line">Splits: 7 total, 7 done (100.00%)</span><br><span class="line">0.07 [1 rows, 37B] [15 rows/s, 569B/s]</span><br></pre></td></tr></table></figure></li><li><p>查询表结构</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">trino&gt; desc mysql_tests.tests.sensor;</span><br><span class="line">   Column    |      Type      | Extra | <span class="keyword">Comment</span> </span><br><span class="line"><span class="comment">-------------+----------------+-------+---------</span></span><br><span class="line"> <span class="keyword">id</span>          | <span class="built_in">varchar</span>(<span class="number">10</span>)    |       |         </span><br><span class="line"> ts          | <span class="built_in">bigint</span>         |       |         </span><br><span class="line"> temperature | <span class="built_in">decimal</span>(<span class="number">18</span>,<span class="number">12</span>) |       |         </span><br><span class="line">(<span class="number">3</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> <span class="number">20220502</span>_084733_00015_g7j4t, FINISHED, <span class="number">1</span> node</span><br><span class="line">Splits: <span class="number">7</span> total, <span class="number">7</span> done (<span class="number">100.00</span>%)</span><br><span class="line"><span class="number">0.19</span> [<span class="number">3</span> <span class="keyword">rows</span>, <span class="number">176</span>B] [<span class="number">15</span> <span class="keyword">rows</span>/s, <span class="number">907</span>B/s]</span><br><span class="line"></span><br><span class="line">trino&gt; <span class="keyword">desc</span> kafka_flink_sensor_iot.default.<span class="string">"lab-flink-sensor-iot"</span>;</span><br><span class="line">      Column       |              Type              | Extra |                   <span class="keyword">Comment</span>                   </span><br><span class="line"><span class="comment">-------------------+--------------------------------+-------+---------------------------------------------</span></span><br><span class="line"> <span class="keyword">id</span>                | <span class="built_in">varchar</span>(<span class="number">10</span>)                    |       |                                             </span><br><span class="line"> <span class="built_in">timestamp</span>         | <span class="built_in">bigint</span>                         |       |                                             </span><br><span class="line"> temperature       | <span class="keyword">double</span>                         |       |                                             </span><br><span class="line"> _partition_id     | <span class="built_in">bigint</span>                         |       | <span class="keyword">Partition</span> <span class="keyword">Id</span>                                </span><br><span class="line"> _partition_offset | <span class="built_in">bigint</span>                         |       | <span class="keyword">Offset</span> <span class="keyword">for</span> the message <span class="keyword">within</span> the <span class="keyword">partition</span> </span><br><span class="line"> _message_corrupt  | <span class="built_in">boolean</span>                        |       | Message <span class="keyword">data</span> <span class="keyword">is</span> corrupt                     </span><br><span class="line"> _message          | <span class="built_in">varchar</span>                        |       | Message <span class="built_in">text</span>                                </span><br><span class="line"> _headers          | <span class="keyword">map</span>(<span class="built_in">varchar</span>, <span class="built_in">array</span>(varbinary)) |       | Headers <span class="keyword">of</span> the message <span class="keyword">as</span> <span class="keyword">map</span>               </span><br><span class="line"> _message_length   | <span class="built_in">bigint</span>                         |       | Total <span class="built_in">number</span> <span class="keyword">of</span> message <span class="keyword">bytes</span>               </span><br><span class="line"> _key_corrupt      | <span class="built_in">boolean</span>                        |       | <span class="keyword">Key</span> <span class="keyword">data</span> <span class="keyword">is</span> corrupt                         </span><br><span class="line"> _key              | <span class="built_in">varchar</span>                        |       | <span class="keyword">Key</span> <span class="built_in">text</span>                                    </span><br><span class="line"> _key_length       | <span class="built_in">bigint</span>                         |       | Total <span class="built_in">number</span> <span class="keyword">of</span> <span class="keyword">key</span> <span class="keyword">bytes</span>                   </span><br><span class="line"> _timestamp        | <span class="built_in">timestamp</span>(<span class="number">3</span>)                   |       | Message <span class="built_in">timestamp</span>                           </span><br><span class="line">(<span class="number">13</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> <span class="number">20220502</span>_084818_00016_g7j4t, FINISHED, <span class="number">1</span> node</span><br><span class="line">Splits: <span class="number">7</span> total, <span class="number">7</span> done (<span class="number">100.00</span>%)</span><br><span class="line"><span class="number">0.09</span> [<span class="number">13</span> <span class="keyword">rows</span>, <span class="number">1.24</span>KB] [<span class="number">146</span> <span class="keyword">rows</span>/s, <span class="number">13.9</span>KB/s]</span><br></pre></td></tr></table></figure></li><li><p>Use schema</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">trino&gt; use kafka_flink_sensor_iot.default;</span><br><span class="line"><span class="keyword">USE</span></span><br><span class="line">trino:<span class="keyword">default</span>&gt; <span class="keyword">use</span> mysql_tests.tests;</span><br><span class="line"><span class="keyword">USE</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><ol><li><p>查询mysql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">trino:tests&gt; select * from  mysql_tests.tests.sensor limit 5;</span><br><span class="line">    id    |      ts       |   temperature    </span><br><span class="line"><span class="comment">----------+---------------+------------------</span></span><br><span class="line"> sensor_1 | 1650585135196 | 102.768561119156 </span><br><span class="line"> sensor_2 | 1650585135196 |  34.569160670600 </span><br><span class="line"> sensor_3 | 1650585135196 |  37.874465883075 </span><br><span class="line"> sensor_4 | 1650585135196 |  18.399362581982 </span><br><span class="line"> sensor_5 | 1650585135196 |  38.842860145725 </span><br><span class="line">(5 rows)</span><br><span class="line"></span><br><span class="line">Query 20220502_085154_00023_g7j4t, FINISHED, 1 node</span><br><span class="line">Splits: 5 total, 5 done (100.00%)</span><br><span class="line">0.49 [5 rows, 0B] [10 rows/s, 0B/s]</span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>查询kafka</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">trino:tests&gt; select * from kafka_flink_sensor_iot.default."lab-flink-sensor-iot" limit 5;</span><br><span class="line">    id    |   timestamp   |    temperature     | _partition_id | _partition_offset | _message_corrupt |                &gt;</span><br><span class="line"><span class="comment">----------+---------------+--------------------+---------------+-------------------+------------------+----------------&gt;</span></span><br><span class="line"> sensor_5 | 1650585131665 | 37.792825657543474 |             0 |                 0 | false            | sensor_5,165058&gt;</span><br><span class="line"> sensor_1 | 1650585133183 |  99.28945242318458 |             0 |                 1 | false            | sensor_1,165058&gt;</span><br><span class="line"> sensor_1 | 1650595135196 |              -15.0 |             0 |                 2 | false            | sensor_1,165059&gt;</span><br><span class="line"> sensor_3 | 1650585134190 | 36.959661044177736 |             0 |                 3 | false            | sensor_3,165058&gt;</span><br><span class="line"> sensor_1 | 1650585134693 | 100.58058605543529 |             0 |                 4 | false            | sensor_1,165058&gt;</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>联合查询mysql&amp;kafka</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trino:tests&gt; select * from mysql_tests.tests.sensor a inner join kafka_flink_sensor_iot.default."lab-flink-sensor-iot" b on a.id = b.id ;</span><br></pre></td></tr></table></figure><p><img src="/uncategorized/it-bigdata-distributed-sql-query-engine-trino/image-20220502165441735.png" alt="image-20220502165441735"></p></li></ol><h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><p><img src="/uncategorized/it-bigdata-distributed-sql-query-engine-trino/image-20220502165706165.png" alt="image-20220502165706165"></p><blockquote><p>使用tpch的数据可以看到统计变化，数据量小时，基本上没有变化。</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;大家对trino没有怎么听说过，我也是在做flink时，有人flink贡献者提到 OLAP 场景下 Flink 与 Trino 确实还存在差距，所以尝试去了解了一下，其与presto SQL是一样的，当然，trino与presto SQL的故事不仅仅如此，请参考&lt;a href=&quot;https://trino.io/blog/2020/12/27/announcing-trino.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Trino | We’re rebranding PrestoSQL as Trino&lt;/a&gt;。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>flink 1.14.4使用flink mysql cdc connector 2.2时报guava18、guava30和blink冲突问题</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-flink-cdc-guava18-blink-conflicts/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-flink-cdc-guava18-blink-conflicts/</id>
    <published>2022-05-01T09:59:11.000Z</published>
    <updated>2022-05-01T10:51:05.088Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>使用flink mysql cdc 来采集mysql bin日志文件时，发现其使用guava18与flink的flink streaming依赖guava30冲突。<a href="https://github.com/ververica/flink-cdc-connectors/issues/1010" target="_blank" rel="noopener">Compatibility problem with Flink 1.14.* · Issue #1010 · ververica/flink-cdc-connectors (github.com)</a></p></blockquote><a id="more"></a><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><ul><li>Flink 与 blink合并了，现在没有blink了。</li><li>Flink-MySQL-CDC-Connector  2.2.x官方提示支持1.14.x和1.13.x，其实是只支持1.13.x。 具体请参考： <a href="https://ververica.github.io/flink-cdc-connectors/release-2.2/content/about.html#supported-connectors" target="_blank" rel="noopener">FLINK CDC</a></li></ul><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>MacOS Monterey</li><li>Oracle JDK 11.0.12 (x86_64) </li><li>Scala 2.12.4</li><li>Flink 1.14.4</li><li>MySQL 8.0.28 </li></ul><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ul><li>pom.xml删除blink依赖</li><li>将代码中的guava18替换成guava30</li></ul><blockquote><p>有些地方我做了暴力处理，例如把所有测试代码都删除了，还有一些maven插件也删除了。如果有朋友处理好了，也请告诉我学习学习。</p></blockquote><p>下图是在我自己的repository里修改的地方，供参考。</p><p><img src="/IT/it-bigdata-flink-cdc-guava18-blink-conflicts/%E7%BD%91%E9%A1%B5%E6%8D%95%E8%8E%B7_1-5-2022_175624_gitee.com.jpeg" alt="网页捕获_1-5-2022_175624_gitee.com"></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><blockquote><p> 不能添加mysql-connector-java依赖，因为flink-connector-mysql-cdc中已经包含了mysql driver，否则会报错</p><p>com.mysql.cj.CharsetMapping.getJavaEncodingForMysqlCharset(Ljava/lang/String;)Ljava/lang/String</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;8.0.28&lt;/version&gt;</span></span><br><span class="line"><span class="comment"> &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ververica<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-mysql-cdc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.ververica/flink-connector-debezium --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ververica<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-debezium<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-shaded-guava --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-shaded-guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>30.1.1-jre-14.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="scala代码"><a href="#scala代码" class="headerlink" title="scala代码"></a>scala代码</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> local.sleety.flink.quickstart.sensor</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ververica.cdc.connectors.mysql.source.<span class="type">MySqlSource</span></span><br><span class="line"><span class="keyword">import</span> com.ververica.cdc.debezium.<span class="type">StringDebeziumDeserializationSchema</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.eventtime.<span class="type">WatermarkStrategy</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">Properties</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SensorMySQLCDCDB</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> debeziumProperties = <span class="keyword">new</span> <span class="type">Properties</span>()</span><br><span class="line">    debeziumProperties.put(<span class="string">"snapshot.locking.mode"</span>, <span class="string">"none"</span>)</span><br><span class="line">    <span class="keyword">val</span> mysqlSource = <span class="type">MySqlSource</span>.builder[<span class="type">String</span>]()</span><br><span class="line">      .debeziumProperties(debeziumProperties)</span><br><span class="line">      .hostname(<span class="string">"localhost"</span>)</span><br><span class="line">      .port(<span class="number">3306</span>)</span><br><span class="line">      .databaseList(<span class="string">"tests"</span>)</span><br><span class="line">      <span class="comment">// tableList is a mandatory option</span></span><br><span class="line">      .tableList(<span class="string">"tests.sensor"</span>, <span class="string">"tests.sensor2"</span>)</span><br><span class="line">      <span class="comment">// it doesn't support the regex</span></span><br><span class="line">      <span class="comment">//      .tableList("tests.sensor*")</span></span><br><span class="line">      .username(<span class="string">"nifi"</span>)</span><br><span class="line">      .password(<span class="string">"secret"</span>)</span><br><span class="line">      .deserializer(<span class="keyword">new</span> <span class="type">StringDebeziumDeserializationSchema</span>())</span><br><span class="line">      .build()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> env = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line">    env.enableCheckpointing(<span class="number">3000</span>)</span><br><span class="line">    env.fromSource(mysqlSource,</span><br><span class="line">      <span class="type">WatermarkStrategy</span>.noWatermarks(),</span><br><span class="line">      <span class="string">"MySQL CDC Source"</span>)</span><br><span class="line">      .setParallelism(<span class="number">1</span>)</span><br><span class="line">      .print(<span class="string">"MySQLCDC DB"</span>).setParallelism(<span class="number">1</span>)</span><br><span class="line">    env.execute()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">--  flink lab sensor </span></span><br><span class="line"><span class="comment">--------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- tests.sensor definition</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sensor`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`ts`</span> <span class="built_in">bigint</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`temperature`</span> <span class="built_in">decimal</span>(<span class="number">18</span>,<span class="number">12</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- tests.sensor2 definition</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sensor2`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`ts`</span> <span class="built_in">bigint</span> <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`temperature`</span> <span class="built_in">decimal</span>(<span class="number">21</span>,<span class="number">15</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">3</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure><h3 id="输出示例"><a href="#输出示例" class="headerlink" title="输出示例"></a>输出示例</h3><h4 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into sensor2(name, ts, temperature) values ('sensor_2', 1650585135196, 26.842860145725);</span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MySQLCDC DB&gt; SourceRecord&#123;sourcePartition=&#123;server=mysql_binlog_source&#125;, sourceOffset=&#123;transaction_id=null, ts_sec=1651401623, file=binlog.000014, pos=5872, row=1, server_id=1, event=2&#125;&#125; ConnectRecord&#123;topic='mysql_binlog_source.tests.sensor2', kafkaPartition=null, key=Struct&#123;id=1&#125;, keySchema=Schema&#123;mysql_binlog_source.tests.sensor2.Key:STRUCT&#125;, </span><br><span class="line">value=Struct&#123;</span><br><span class="line">after=Struct&#123;id=1,name=sensor_2,ts=1650585135196,temperature=26.842860145725000&#125;,</span><br><span class="line">source=Struct&#123;version=1.5.4.Final,connector=mysql,name=mysql_binlog_source,ts_ms=1651401623000,db=tests,table=sensor2,server_id=1,file=binlog.000014,pos=6014,row=0&#125;,</span><br><span class="line">op=c,</span><br><span class="line">ts_ms=1651401623109&#125;, </span><br><span class="line">valueSchema=Schema&#123;mysql_binlog_source.tests.sensor2.Envelope:STRUCT&#125;, timestamp=null, headers=ConnectHeaders(headers=)&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into sensor2(name, ts, temperature) values ('sensor_1', 1650585135196, 46.842020145725);</span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MySQLCDC DB&gt; SourceRecord&#123;sourcePartition=&#123;server=mysql_binlog_source&#125;, sourceOffset=&#123;transaction_id=null, ts_sec=1651401631, file=binlog.000014, pos=6191, row=1, server_id=1, event=2&#125;&#125; ConnectRecord&#123;topic='mysql_binlog_source.tests.sensor2', kafkaPartition=null, key=Struct&#123;id=2&#125;, keySchema=Schema&#123;mysql_binlog_source.tests.sensor2.Key:STRUCT&#125;, </span><br><span class="line">value=Struct&#123;</span><br><span class="line">after=Struct&#123;id=2,name=sensor_1,ts=1650585135196,temperature=46.842020145725000&#125;,</span><br><span class="line">source=Struct&#123;version=1.5.4.Final,connector=mysql,name=mysql_binlog_source,ts_ms=1651401631000,db=tests,table=sensor2,server_id=1,file=binlog.000014,pos=6333,row=0&#125;,</span><br><span class="line">op=c,</span><br><span class="line">ts_ms=1651401631597&#125;, </span><br><span class="line">valueSchema=Schema&#123;mysql_binlog_source.tests.sensor2.Envelope:STRUCT&#125;, timestamp=null, headers=ConnectHeaders(headers=)&#125;</span><br></pre></td></tr></table></figure><h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update sensor2 set temperature=50.2342234232 where name = 'sensor_1';</span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">Rows matched: 1 Changed: 1 Warnings: 0</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MySQLCDC DB&gt; SourceRecord&#123;sourcePartition=&#123;server=mysql_binlog_source&#125;, sourceOffset=&#123;transaction_id=null, ts_sec=1651401638, file=binlog.000014, pos=6510, row=1, server_id=1, event=2&#125;&#125; ConnectRecord&#123;topic='mysql_binlog_source.tests.sensor2', kafkaPartition=null, key=Struct&#123;id=2&#125;, keySchema=Schema&#123;mysql_binlog_source.tests.sensor2.Key:STRUCT&#125;, </span><br><span class="line">value=Struct&#123;</span><br><span class="line">before=Struct&#123;id=2,name=sensor_1,ts=1650585135196,temperature=46.842020145725000&#125;,</span><br><span class="line">after=Struct&#123;id=2,name=sensor_1,ts=1650585135196,temperature=50.234223423200000&#125;,</span><br><span class="line">source=Struct&#123;version=1.5.4.Final,connector=mysql,name=mysql_binlog_source,ts_ms=1651401638000,db=tests,table=sensor2,server_id=1,file=binlog.000014,pos=6661,row=0&#125;,</span><br><span class="line">op=u,</span><br><span class="line">ts_ms=1651401638156&#125;, </span><br><span class="line">valueSchema=Schema&#123;mysql_binlog_source.tests.sensor2.Envelope:STRUCT&#125;, timestamp=null, headers=ConnectHeaders(headers=)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from sensor2 where name = 'sensor_1';</span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MySQLCDC DB&gt; SourceRecord&#123;sourcePartition=&#123;server=mysql_binlog_source&#125;, sourceOffset=&#123;transaction_id=null, ts_sec=1651401643, file=binlog.000014, pos=6871, row=1, server_id=1, event=2&#125;&#125; ConnectRecord&#123;topic='mysql_binlog_source.tests.sensor2', kafkaPartition=null, key=Struct&#123;id=2&#125;, keySchema=Schema&#123;mysql_binlog_source.tests.sensor2.Key:STRUCT&#125;, </span><br><span class="line">value=Struct&#123;</span><br><span class="line">before=Struct&#123;id=2,name=sensor_1,ts=1650585135196,temperature=50.234223423200000&#125;,</span><br><span class="line">source=Struct&#123;version=1.5.4.Final,connector=mysql,name=mysql_binlog_source,ts_ms=1651401643000,db=tests,table=sensor2,server_id=1,file=binlog.000014,pos=7013,row=0&#125;,</span><br><span class="line">op=d,</span><br><span class="line">ts_ms=1651401643147&#125;, v</span><br><span class="line">alueSchema=Schema&#123;mysql_binlog_source.tests.sensor2.Envelope:STRUCT&#125;, timestamp=null, headers=ConnectHeaders(headers=)&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;使用flink mysql cdc 来采集mysql bin日志文件时，发现其使用guava18与flink的flink streaming依赖guava30冲突。&lt;a href=&quot;https://github.com/ververica/flink-cdc-connectors/issues/1010&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Compatibility problem with Flink 1.14.* · Issue #1010 · ververica/flink-cdc-connectors (github.com)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
    <category term="streaming" scheme="https://lianyouli.gitee.io/tags/streaming/"/>
    
    <category term="cdc" scheme="https://lianyouli.gitee.io/tags/cdc/"/>
    
    <category term="flink" scheme="https://lianyouli.gitee.io/tags/flink/"/>
    
  </entry>
  
  <entry>
    <title>Nifi Mysql CDC</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-nifi-mysql-cdc/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-nifi-mysql-cdc/</id>
    <published>2022-04-03T02:33:18.000Z</published>
    <updated>2022-04-25T01:23:44.447Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Nifi 采集Mysql的binlog示例</p></blockquote><a id="more"></a><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li><p>MySQL 8.0.28</p></li><li><p>Nifi 1.15.3</p></li></ul><h2 id="检查MySQL-binlog开启情况"><a href="#检查MySQL-binlog开启情况" class="headerlink" title="检查MySQL binlog开启情况"></a>检查MySQL binlog开启情况</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like '%log_bin%';</span><br></pre></td></tr></table></figure> <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403104549750.png" alt="image-20220403104549750" style="zoom:50%;"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 我这里的global transaction id 模式是关闭的</span></span><br><span class="line">show variables like '%gtid%';</span><br></pre></td></tr></table></figure> <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403104650480.png" alt="image-20220403104650480" style="zoom:50%;"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like 'server_id';</span><br></pre></td></tr></table></figure> <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403105008677.png" alt="image-20220403105008677" style="zoom:50%;"><h2 id="创建MySQL用户和数据库"><a href="#创建MySQL用户和数据库" class="headerlink" title="创建MySQL用户和数据库"></a>创建MySQL用户和数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> nifi@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">'SecretPasswd'</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> tests;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">select</span>, <span class="keyword">show</span> <span class="keyword">databases</span>  <span class="keyword">ON</span> *.* <span class="keyword">to</span> nifi@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> tests.* <span class="keyword">to</span> nifi@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">REPLICATION</span> <span class="keyword">SLAVE</span> <span class="keyword">ON</span> *.* <span class="keyword">to</span> nifi@<span class="string">'%'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">to</span> nifi@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure><h2 id="配置DistributedMapCacheServer-amp-Client"><a href="#配置DistributedMapCacheServer-amp-Client" class="headerlink" title="配置DistributedMapCacheServer&amp;Client"></a>配置DistributedMapCacheServer&amp;Client</h2><ul><li><p>DistributedMapCacheServer</p><blockquote><p>global menu  –&gt; Controller Settings –&gt; REPORTING TASK CONTROLLER SERVICES</p></blockquote> <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403110758271.png" alt="image-20220403110758271" style="zoom:50%;"><p><img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403111957998.png" alt="image-20220403111957998"></p><blockquote><p>这里选择最简单的DistributedMapCacheServer。</p></blockquote> <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403112736423.png" alt="image-20220403112736423" style="zoom:30%;"></li></ul>  <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403113013282.png" alt="image-20220403113013282" style="zoom:30%;"><ul><li><p>DistributedMapCacheClient</p><blockquote><p>可以采用这种方式创建，也可以在CaptureChangeMySQL组件里选择创建一个服务。</p></blockquote> <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403165001672.png" alt="image-20220403165001672" style="zoom:50%;"> <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403165038376.png" alt="image-20220403165038376" style="zoom:50%;"><img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403164622602.png" alt="image-20220403164622602" style="zoom:30%;"></li></ul><h2 id="创建和配置CaptureChangeMySQL"><a href="#创建和配置CaptureChangeMySQL" class="headerlink" title="创建和配置CaptureChangeMySQL"></a>创建和配置CaptureChangeMySQL</h2><ul><li><p>整个流 <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403161544824.png" alt="image-20220403161544824"></p></li><li><p>CaptureChangeMySQL</p><p><img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403113226934.png" alt="image-20220403113226934" style="zoom:50%;">   <img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403113606962.png" alt="image-20220403113606962" style="zoom:50%;"><img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403113827340.png" alt="image-20220403113827340" style="zoom:50%;"></p></li><li><p>RouteOnAttribute</p><p>根据SQL类型，新建了下面的4种类型 ，以及默认的unmatched类型，上图中设置了Include Begin/Commit Events将会路由到unmatched分支。<br><img src="/IT/it-bigdata-nifi-mysql-cdc/image-20220403161727165.png" alt="image-20220403161727165"></p></li></ul><h2 id="捕获的数据"><a href="#捕获的数据" class="headerlink" title="捕获的数据"></a>捕获的数据</h2><ul><li>SQL Statements</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> tests;</span><br><span class="line"><span class="comment">-- 建议在cmd上执行</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> tests.nifi_lab;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> tests.nifi_lab ( <span class="keyword">id</span> <span class="built_in">int</span>, </span><br><span class="line"><span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">10</span>), </span><br><span class="line">createtime <span class="built_in">timestamp</span> <span class="keyword">default</span> <span class="keyword">current_timestamp</span>  , </span><br><span class="line">updatetime <span class="built_in">timestamp</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span>  <span class="keyword">current_timestamp</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以在数据库客户端执行，例如dbeaver。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, <span class="keyword">name</span>, createtime, updatetime</span><br><span class="line"><span class="keyword">FROM</span> tests.nifi_lab;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tests.nifi_lab (<span class="keyword">id</span>, <span class="keyword">name</span>) <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">'Arthur'</span>);</span><br><span class="line"><span class="comment">-- name &amp; updatetime will be changed</span></span><br><span class="line"><span class="keyword">update</span> tests.nifi_lab <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'Amy'</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tests.nifi_lab <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><ul><li><p>Include DDL Events: true</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"ddl"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648912744000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000001"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">1893</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"tests"</span>,</span><br><span class="line">    <span class="attr">"table_name"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"table_id"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"query"</span>: <span class="string">"DROP TABLE IF EXISTS `nifi_lab` /* generated by server */"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"ddl"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648974582000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000001"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">6045</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"tests"</span>,</span><br><span class="line">    <span class="attr">"table_name"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"table_id"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"query"</span>: <span class="string">"create table tests.nifi_lab ( id int,  name varchar(10),  createtime timestamp default CURRENT_TIMESTAMP,  updatetime timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE  CURRENT_TIMESTAMP   )"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>Include Begin/Commit Event: true</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"commit"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648912762000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000001"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">2782</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"tests"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"begin"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648973319000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000001"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">4885</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"tests"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>Insert</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"insert"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648912762000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000001"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">2727</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"tests"</span>,</span><br><span class="line">    <span class="attr">"table_name"</span>: <span class="string">"nifi_lab"</span>,</span><br><span class="line">    <span class="attr">"table_id"</span>: <span class="number">103</span>,</span><br><span class="line">    <span class="attr">"columns"</span>:</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"id"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"name"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">12</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"Arthur"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"createtime"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">93</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"2022-04-02 23:19:22.0"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"updatetime"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">93</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"2022-04-02 23:19:22.0"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>update</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- name &amp; updatetime will be changed</span></span><br><span class="line"><span class="keyword">update</span> tests.nifi_lab <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'Amy'</span> <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p>没有做修改的字段的值，依旧在update里。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"update"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648957879000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000002"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">837</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"tests"</span>,</span><br><span class="line">    <span class="attr">"table_name"</span>: <span class="string">"nifi_lab"</span>,</span><br><span class="line">    <span class="attr">"table_id"</span>: <span class="number">82</span>,</span><br><span class="line">    <span class="attr">"columns"</span>:</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"id"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"last_value"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"name"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">12</span>,</span><br><span class="line">            <span class="attr">"last_value"</span>: <span class="string">"Arthur"</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"Amy"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"createtime"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">93</span>,</span><br><span class="line">            <span class="attr">"last_value"</span>: <span class="string">"2022-04-02 23:19:22.0"</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"2022-04-02 23:19:22.0"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"updatetime"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">93</span>,</span><br><span class="line">            <span class="attr">"last_value"</span>: <span class="string">"2022-04-02 23:19:22.0"</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"2022-04-03 11:51:19.0"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>delete</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tests.nifi_lab <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"delete"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648973324000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000001"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">5671</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"tests"</span>,</span><br><span class="line">    <span class="attr">"table_name"</span>: <span class="string">"nifi_lab"</span>,</span><br><span class="line">    <span class="attr">"table_id"</span>: <span class="number">104</span>,</span><br><span class="line">    <span class="attr">"columns"</span>:</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"id"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"name"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">12</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"Amy"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"createtime"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">93</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"2022-04-03 16:08:39.0"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"updatetime"</span>,</span><br><span class="line">            <span class="attr">"column_type"</span>: <span class="number">93</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="string">"2022-04-03 16:08:42.0"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>没有设置<strong>Distributed Map Cache Client</strong>时</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"delete"</span>,</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="number">1648960096000</span>,</span><br><span class="line">    <span class="attr">"binlog_filename"</span>: <span class="string">"binlog.000002"</span>,</span><br><span class="line">    <span class="attr">"binlog_position"</span>: <span class="number">2084</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"table_name"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"table_id"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"columns"</span>:</span><br><span class="line">    [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="literal">null</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="literal">null</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">4</span>,</span><br><span class="line">            <span class="attr">"value"</span>: <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="问题集"><a href="#问题集" class="headerlink" title="问题集"></a>问题集</h2><ul><li><p>如果没有配置<strong>Distributed Map Cache Client</strong>会提示warning</p><blockquote><p>可以忽略，不过输出结果没有字段名称和类型。所以建议设置。</p></blockquote></li><li><p>MySQL8账户密码类型不能使用默认的</p><blockquote><p>创建MySQL账户时需要指定mysql_native_password</p></blockquote></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Nifi 采集Mysql的binlog示例&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
    <category term="dataflow" scheme="https://lianyouli.gitee.io/tags/dataflow/"/>
    
    <category term="nifi" scheme="https://lianyouli.gitee.io/tags/nifi/"/>
    
  </entry>
  
  <entry>
    <title>Nifi集群安装</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-dataflow-nifi-cluster-installation/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-dataflow-nifi-cluster-installation/</id>
    <published>2022-03-29T10:02:06.000Z</published>
    <updated>2022-03-29T13:20:14.949Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Nifi集群HTTP模式安装时遇到的一些问题记录集</p><p>官网：<a href="https://nifi.apache.org/index.html" target="_blank" rel="noopener">Apache NiFi</a></p><p>集群配置文档：<a href="https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#clustering" target="_blank" rel="noopener">NiFi System Administrator’s Guide (apache.org)</a></p></blockquote><a id="more"></a><h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><p><strong>nifi-1.5.3</strong></p><p><strong>Mac</strong></p><p><strong>JDK1.8</strong></p><p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329211103224.png" alt="image-20220329211103224"></p><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210938014.png" alt="image-20220329210938014" style="zoom:50%;"><p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329211029825.png" alt="image-20220329211029825"></p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="bin-nifi-env-sh"><a href="#bin-nifi-env-sh" class="headerlink" title="bin/nifi-env.sh"></a>bin/nifi-env.sh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/Library/Java/JavaVirtualMachines/openjdk-8.jdk/Contents/Home</span><br></pre></td></tr></table></figure><h3 id="conf-nifi-properties"><a href="#conf-nifi-properties" class="headerlink" title="conf/nifi.properties"></a>conf/nifi.properties</h3><ol><li><p>Site to Site properties<br>这里关闭了secure配置</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329182918332.png" alt="image-20220329182918332" style="zoom:50%;"></li><li><p>Web properties</p><p>这里http与https只能配置一个，因为我配置的是http，所以https注释了。</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329182857162.png" alt="image-20220329182857162" style="zoom:50%;"></li><li><p>security properties<br><strong>nifi.sensitive.props.key</strong>长度有要求，12位长度以上。</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329182529892.png" alt="image-20220329182529892" style="zoom:50%;"></li><li><p>cluster common properties</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329205623271.png" alt="image-20220329205623271" style="zoom:50%;"></li><li><p>cluster node properties</p><p><strong>nifi.cluster.flow.election.max.wait.time</strong>和<strong>nifi.cluster.flow.election.max.candidates</strong>可以根据实际情况来设置，因为我这里只有一个节点。端口也按自己的情况设置。</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329205726775.png" alt="image-20220329205726775" style="zoom:50%;"></li><li><p>cluster load balancing properties</p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329205954078.png" alt="image-20220329205954078" style="zoom:50%;"></li><li><p>zookeeper properties, used for cluster management </p><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210057852.png" alt="image-20220329205954078" style="zoom:50%;"></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment"># contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment"># this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment"># (the "License"); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment"># the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"># distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"># See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"># limitations under the License.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Core Properties #</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.file</span>=<span class="string">./conf/flow.xml.gz</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.dir</span>=<span class="string">./conf/archive/</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.max.time</span>=<span class="string">30 days</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.max.storage</span>=<span class="string">500 MB</span></span><br><span class="line"><span class="meta">nifi.flow.configuration.archive.max.count</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.flowcontroller.autoResumeState</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.flowcontroller.graceful.shutdown.period</span>=<span class="string">10 sec</span></span><br><span class="line"><span class="meta">nifi.flowservice.writedelay.interval</span>=<span class="string">500 ms</span></span><br><span class="line"><span class="meta">nifi.administrative.yield.duration</span>=<span class="string">30 sec</span></span><br><span class="line"><span class="comment"># If a component has no work to do (is "bored"), how long should we wait before checking again for work?</span></span><br><span class="line"><span class="meta">nifi.bored.yield.duration</span>=<span class="string">10 millis</span></span><br><span class="line"><span class="meta">nifi.queue.backpressure.count</span>=<span class="string">10000</span></span><br><span class="line"><span class="meta">nifi.queue.backpressure.size</span>=<span class="string">1 GB</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.authorizer.configuration.file</span>=<span class="string">./conf/authorizers.xml</span></span><br><span class="line"><span class="meta">nifi.login.identity.provider.configuration.file</span>=<span class="string">./conf/login-identity-providers.xml</span></span><br><span class="line"><span class="meta">nifi.templates.directory</span>=<span class="string">./conf/templates</span></span><br><span class="line"><span class="meta">nifi.ui.banner.text</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.ui.autorefresh.interval</span>=<span class="string">30 sec</span></span><br><span class="line"><span class="meta">nifi.nar.library.directory</span>=<span class="string">./lib</span></span><br><span class="line"><span class="meta">nifi.nar.library.autoload.directory</span>=<span class="string">./extensions</span></span><br><span class="line"><span class="meta">nifi.nar.working.directory</span>=<span class="string">./work/nar/</span></span><br><span class="line"><span class="meta">nifi.documentation.working.directory</span>=<span class="string">./work/docs/components</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################</span></span><br><span class="line"><span class="comment"># State Management #</span></span><br><span class="line"><span class="comment">####################</span></span><br><span class="line"><span class="meta">nifi.state.management.configuration.file</span>=<span class="string">./conf/state-management.xml</span></span><br><span class="line"><span class="comment"># The ID of the local state provider</span></span><br><span class="line"><span class="meta">nifi.state.management.provider.local</span>=<span class="string">local-provider</span></span><br><span class="line"><span class="comment"># The ID of the cluster-wide state provider. This will be ignored if NiFi is not clustered but must be populated if running in a cluster.</span></span><br><span class="line"><span class="meta">nifi.state.management.provider.cluster</span>=<span class="string">zk-provider</span></span><br><span class="line"><span class="comment"># Specifies whether or not this instance of NiFi should run an embedded ZooKeeper server</span></span><br><span class="line"><span class="meta">nifi.state.management.embedded.zookeeper.start</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"># Properties file that provides the ZooKeeper properties to use if &lt;nifi.state.management.embedded.zookeeper.start&gt; is set to true</span></span><br><span class="line"><span class="meta">nifi.state.management.embedded.zookeeper.properties</span>=<span class="string">./conf/zookeeper.properties</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># H2 Settings</span></span><br><span class="line"><span class="meta">nifi.database.directory</span>=<span class="string">./database_repository</span></span><br><span class="line"><span class="meta">nifi.h2.url.append</span>=<span class="string">;LOCK_TIMEOUT=25000;WRITE_DELAY=0;AUTO_SERVER=FALSE</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Repository Encryption properties override individual repository implementation properties</span></span><br><span class="line"><span class="meta">nifi.repository.encryption.protocol.version</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.id</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.provider</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.provider.keystore.location</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.repository.encryption.key.provider.keystore.password</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FlowFile Repository</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.implementation</span>=<span class="string">org.apache.nifi.controller.repository.WriteAheadFlowFileRepository</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.wal.implementation</span>=<span class="string">org.apache.nifi.wali.SequentialAccessWriteAheadLog</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.directory</span>=<span class="string">./flowfile_repository</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.checkpoint.interval</span>=<span class="string">20 secs</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.always.sync</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.flowfile.repository.retain.orphaned.flowfiles</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.swap.manager.implementation</span>=<span class="string">org.apache.nifi.controller.FileSystemSwapManager</span></span><br><span class="line"><span class="meta">nifi.queue.swap.threshold</span>=<span class="string">20000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Content Repository</span></span><br><span class="line"><span class="meta">nifi.content.repository.implementation</span>=<span class="string">org.apache.nifi.controller.repository.FileSystemRepository</span></span><br><span class="line"><span class="meta">nifi.content.claim.max.appendable.size</span>=<span class="string">1 MB</span></span><br><span class="line"><span class="meta">nifi.content.repository.directory.default</span>=<span class="string">./content_repository</span></span><br><span class="line"><span class="meta">nifi.content.repository.archive.max.retention.period</span>=<span class="string">7 days</span></span><br><span class="line"><span class="meta">nifi.content.repository.archive.max.usage.percentage</span>=<span class="string">50%</span></span><br><span class="line"><span class="meta">nifi.content.repository.archive.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.content.repository.always.sync</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.content.viewer.url</span>=<span class="string">../nifi-content-viewer/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Provenance Repository Properties</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.implementation</span>=<span class="string">org.apache.nifi.provenance.WriteAheadProvenanceRepository</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Persistent Provenance Repository Properties</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.directory.default</span>=<span class="string">./provenance_repository</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.max.storage.time</span>=<span class="string">30 days</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.max.storage.size</span>=<span class="string">10 GB</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.rollover.time</span>=<span class="string">10 mins</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.rollover.size</span>=<span class="string">100 MB</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.query.threads</span>=<span class="string">2</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.index.threads</span>=<span class="string">2</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.compress.on.rollover</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.always.sync</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># Comma-separated list of fields. Fields that are not indexed will not be searchable. Valid fields are:</span></span><br><span class="line"><span class="comment"># EventType, FlowFileUUID, Filename, TransitURI, ProcessorID, AlternateIdentifierURI, Relationship, Details</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.indexed.fields</span>=<span class="string">EventType, FlowFileUUID, Filename, ProcessorID, Relationship</span></span><br><span class="line"><span class="comment"># FlowFile Attributes that should be indexed and made searchable.  Some examples to consider are filename, uuid, mime.type</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.indexed.attributes</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># Large values for the shard size will result in more Java heap usage when searching the Provenance Repository</span></span><br><span class="line"><span class="comment"># but should provide better performance</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.index.shard.size</span>=<span class="string">500 MB</span></span><br><span class="line"><span class="comment"># Indicates the maximum length that a FlowFile attribute can be when retrieving a Provenance Event from</span></span><br><span class="line"><span class="comment"># the repository. If the length of any attribute exceeds this value, it will be truncated when the event is retrieved.</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.max.attribute.length</span>=<span class="string">65536</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.concurrent.merge.threads</span>=<span class="string">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Volatile Provenance Respository Properties</span></span><br><span class="line"><span class="meta">nifi.provenance.repository.buffer.size</span>=<span class="string">100000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Component and Node Status History Repository</span></span><br><span class="line"><span class="meta">nifi.components.status.repository.implementation</span>=<span class="string">org.apache.nifi.controller.status.history.VolatileComponentStatusRepository</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Volatile Status History Repository Properties</span></span><br><span class="line"><span class="meta">nifi.components.status.repository.buffer.size</span>=<span class="string">1440</span></span><br><span class="line"><span class="meta">nifi.components.status.snapshot.frequency</span>=<span class="string">1 min</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># QuestDB Status History Repository Properties</span></span><br><span class="line"><span class="meta">nifi.status.repository.questdb.persist.node.days</span>=<span class="string">14</span></span><br><span class="line"><span class="meta">nifi.status.repository.questdb.persist.component.days</span>=<span class="string">3</span></span><br><span class="line"><span class="meta">nifi.status.repository.questdb.persist.location</span>=<span class="string">./status_repository</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site to Site properties</span></span><br><span class="line"><span class="meta">nifi.remote.input.host</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.remote.input.secure</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.remote.input.socket.port</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.remote.input.http.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.remote.input.http.transaction.ttl</span>=<span class="string">30 sec</span></span><br><span class="line"><span class="meta">nifi.remote.contents.cache.expiration</span>=<span class="string">30 secs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># web properties #</span></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># For security, NiFi will present the UI on 127.0.0.1 and only be accessible through this loopback interface.</span></span><br><span class="line"><span class="comment"># Be aware that changing these properties may affect how your instance can be accessed without any restriction.</span></span><br><span class="line"><span class="comment"># We recommend configuring HTTPS instead. The administrators guide provides instructions on how to do this.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.web.http.host</span>=<span class="string">sleety.local</span></span><br><span class="line"><span class="meta">nifi.web.http.port</span>=<span class="string">18001</span></span><br><span class="line"><span class="meta">nifi.web.http.network.interface.default</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#############################################</span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.web.https.host</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># 127.0.0.1</span></span><br><span class="line"><span class="meta">nifi.web.https.port</span>=<span class="string"></span></span><br><span class="line"><span class="comment"># 8443</span></span><br><span class="line"><span class="meta">nifi.web.https.network.interface.default</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.jetty.working.directory</span>=<span class="string">./work/jetty</span></span><br><span class="line"><span class="meta">nifi.web.jetty.threads</span>=<span class="string">200</span></span><br><span class="line"><span class="meta">nifi.web.max.header.size</span>=<span class="string">16 KB</span></span><br><span class="line"><span class="meta">nifi.web.proxy.context.path</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.proxy.host</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.max.content.size</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.max.requests.per.second</span>=<span class="string">30000</span></span><br><span class="line"><span class="meta">nifi.web.max.access.token.requests.per.second</span>=<span class="string">25</span></span><br><span class="line"><span class="meta">nifi.web.request.timeout</span>=<span class="string">60 secs</span></span><br><span class="line"><span class="meta">nifi.web.request.ip.whitelist</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.should.send.server.version</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include or Exclude TLS Cipher Suites for HTTPS</span></span><br><span class="line"><span class="meta">nifi.web.https.ciphersuites.include</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.web.https.ciphersuites.exclude</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># security properties #</span></span><br><span class="line"><span class="meta">nifi.sensitive.props.key</span>=<span class="string">youchangeitok</span></span><br><span class="line"><span class="meta">nifi.sensitive.props.key.protected</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.sensitive.props.algorithm</span>=<span class="string">NIFI_PBKDF2_AES_GCM_256</span></span><br><span class="line"><span class="meta">nifi.sensitive.props.additional.keys</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">nifi.security.autoreload.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.autoreload.interval</span>=<span class="string">10 secs</span></span><br><span class="line"><span class="meta">nifi.security.keystore</span>=<span class="string">./conf/keystore.p12</span></span><br><span class="line"><span class="meta">nifi.security.keystoreType</span>=<span class="string">PKCS12</span></span><br><span class="line"><span class="meta">nifi.security.keystorePasswd</span>=<span class="string">67cee0ed3aba2755de751ff0ac5380fb</span></span><br><span class="line"><span class="meta">nifi.security.keyPasswd</span>=<span class="string">67cee0ed3aba2755de751ff0ac5380fb</span></span><br><span class="line"><span class="meta">nifi.security.truststore</span>=<span class="string">./conf/truststore.p12</span></span><br><span class="line"><span class="meta">nifi.security.truststoreType</span>=<span class="string">PKCS12</span></span><br><span class="line"><span class="meta">nifi.security.truststorePasswd</span>=<span class="string">797877f1ba3bd64380f7f15494ac12ec</span></span><br><span class="line"><span class="meta">nifi.security.user.authorizer</span>=<span class="string">single-user-authorizer</span></span><br><span class="line"><span class="meta">nifi.security.allow.anonymous.authentication</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.login.identity.provider</span>=<span class="string">single-user-provider</span></span><br><span class="line"><span class="meta">nifi.security.user.jws.key.rotation.period</span>=<span class="string">PT1H</span></span><br><span class="line"><span class="meta">nifi.security.ocsp.responder.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.ocsp.responder.certificate</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenId Connect SSO Properties #</span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.discovery.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.connect.timeout</span>=<span class="string">5 secs</span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.read.timeout</span>=<span class="string">5 secs</span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.client.id</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.client.secret</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.preferred.jwsalgorithm</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.additional.scopes</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.claim.identifying.user</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.oidc.fallback.claims.identifying.user</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apache Knox SSO Properties #</span></span><br><span class="line"><span class="meta">nifi.security.user.knox.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.knox.publicKey</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.knox.cookieName</span>=<span class="string">hadoop-jwt</span></span><br><span class="line"><span class="meta">nifi.security.user.knox.audiences</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SAML Properties #</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.idp.metadata.url</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.sp.entity.id</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.identity.attribute.name</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.group.attribute.name</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.security.user.saml.metadata.signing.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.request.signing.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.want.assertions.signed</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.signature.algorithm</span>=<span class="string">http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.signature.digest.algorithm</span>=<span class="string">http://www.w3.org/2001/04/xmlenc#sha256</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.message.logging.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.authentication.expiration</span>=<span class="string">12 hours</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.single.logout.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.http.client.truststore.strategy</span>=<span class="string">JDK</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.http.client.connect.timeout</span>=<span class="string">30 secs</span></span><br><span class="line"><span class="meta">nifi.security.user.saml.http.client.read.timeout</span>=<span class="string">30 secs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Identity Mapping Properties #</span></span><br><span class="line"><span class="comment"># These properties allow normalizing user identities such that identities coming from different identity providers</span></span><br><span class="line"><span class="comment"># (certificates, LDAP, Kerberos) can be treated the same internally in NiFi. The following example demonstrates normalizing</span></span><br><span class="line"><span class="comment"># DNs from certificates and principals from Kerberos into a common identity string:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.pattern.dn=^CN=(.*?), OU=(.*?), O=(.*?), L=(.*?), ST=(.*?), C=(.*?)$</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.value.dn=$1@$2</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.transform.dn=NONE</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.pattern.kerb=^(.*?)/instance@(.*?)$</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.value.kerb=$1@$2</span></span><br><span class="line"><span class="comment"># nifi.security.identity.mapping.transform.kerb=UPPER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Group Mapping Properties #</span></span><br><span class="line"><span class="comment"># These properties allow normalizing group names coming from external sources like LDAP. The following example</span></span><br><span class="line"><span class="comment"># lowercases any group name.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nifi.security.group.mapping.pattern.anygroup=^(.*)$</span></span><br><span class="line"><span class="comment"># nifi.security.group.mapping.value.anygroup=$1</span></span><br><span class="line"><span class="comment"># nifi.security.group.mapping.transform.anygroup=LOWER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cluster common properties (all nodes must have same values) #</span></span><br><span class="line"><span class="meta">nifi.cluster.protocol.heartbeat.interval</span>=<span class="string">5 sec</span></span><br><span class="line"><span class="meta">nifi.cluster.protocol.heartbeat.missable.max</span>=<span class="string">8</span></span><br><span class="line"><span class="meta">nifi.cluster.protocol.is.secure</span>=<span class="string">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cluster node properties (only configure for cluster nodes) #</span></span><br><span class="line"><span class="meta">nifi.cluster.is.node</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">nifi.cluster.node.address</span>=<span class="string">sleety.local</span></span><br><span class="line"><span class="meta">nifi.cluster.node.protocol.port</span>=<span class="string">28001</span></span><br><span class="line"><span class="meta">nifi.cluster.node.protocol.max.threads</span>=<span class="string">50</span></span><br><span class="line"><span class="meta">nifi.cluster.node.event.history.size</span>=<span class="string">25</span></span><br><span class="line"><span class="meta">nifi.cluster.node.connection.timeout</span>=<span class="string">5 sec</span></span><br><span class="line"><span class="meta">nifi.cluster.node.read.timeout</span>=<span class="string">5 sec</span></span><br><span class="line"><span class="meta">nifi.cluster.node.max.concurrent.requests</span>=<span class="string">100</span></span><br><span class="line"><span class="meta">nifi.cluster.firewall.file</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.cluster.flow.election.max.wait.time</span>=<span class="string">1 mins</span></span><br><span class="line"><span class="meta">nifi.cluster.flow.election.max.candidates</span>=<span class="string">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cluster load balancing properties #</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.host</span>=<span class="string">sleety.local</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.port</span>=<span class="string">6342</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.connections.per.node</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.max.thread.count</span>=<span class="string">8</span></span><br><span class="line"><span class="meta">nifi.cluster.load.balance.comms.timeout</span>=<span class="string">30 sec</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># zookeeper properties, used for cluster management #</span></span><br><span class="line"><span class="meta">nifi.zookeeper.connect.string</span>=<span class="string">sleety.local:12181</span></span><br><span class="line"><span class="meta">nifi.zookeeper.connect.timeout</span>=<span class="string">10 secs</span></span><br><span class="line"><span class="meta">nifi.zookeeper.session.timeout</span>=<span class="string">10 secs</span></span><br><span class="line"><span class="meta">nifi.zookeeper.root.node</span>=<span class="string">/nifi</span></span><br><span class="line"><span class="meta">nifi.zookeeper.client.secure</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.keystore</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.keystoreType</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.keystorePasswd</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.truststore</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.truststoreType</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.security.truststorePasswd</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.jute.maxbuffer</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Zookeeper properties for the authentication scheme used when creating acls on znodes used for cluster management</span></span><br><span class="line"><span class="comment"># Values supported for nifi.zookeeper.auth.type are "default", which will apply world/anyone rights on znodes</span></span><br><span class="line"><span class="comment"># and "sasl" which will give rights to the sasl/kerberos identity used to authenticate the nifi node</span></span><br><span class="line"><span class="comment"># The identity is determined using the value in nifi.kerberos.service.principal and the removeHostFromPrincipal</span></span><br><span class="line"><span class="comment"># and removeRealmFromPrincipal values (which should align with the kerberos.removeHostFromPrincipal and kerberos.removeRealmFromPrincipal</span></span><br><span class="line"><span class="comment"># values configured on the zookeeper server).</span></span><br><span class="line"><span class="meta">nifi.zookeeper.auth.type</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.kerberos.removeHostFromPrincipal</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.zookeeper.kerberos.removeRealmFromPrincipal</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kerberos #</span></span><br><span class="line"><span class="meta">nifi.kerberos.krb5.file</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kerberos service principal #</span></span><br><span class="line"><span class="meta">nifi.kerberos.service.principal</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.kerberos.service.keytab.location</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kerberos spnego principal #</span></span><br><span class="line"><span class="meta">nifi.kerberos.spnego.principal</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.kerberos.spnego.keytab.location</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.kerberos.spnego.authentication.expiration</span>=<span class="string">12 hours</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># external properties files for variable registry</span></span><br><span class="line"><span class="comment"># supports a comma delimited list of file locations</span></span><br><span class="line"><span class="meta">nifi.variable.registry.properties</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># analytics properties #</span></span><br><span class="line"><span class="meta">nifi.analytics.predict.enabled</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">nifi.analytics.predict.interval</span>=<span class="string">3 mins</span></span><br><span class="line"><span class="meta">nifi.analytics.query.interval</span>=<span class="string">5 mins</span></span><br><span class="line"><span class="meta">nifi.analytics.connection.model.implementation</span>=<span class="string">org.apache.nifi.controller.status.analytics.models.OrdinaryLeastSquares</span></span><br><span class="line"><span class="meta">nifi.analytics.connection.model.score.name</span>=<span class="string">rSquared</span></span><br><span class="line"><span class="meta">nifi.analytics.connection.model.score.threshold</span>=<span class="string">.90</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># runtime monitoring properties</span></span><br><span class="line"><span class="meta">nifi.monitor.long.running.task.schedule</span>=<span class="string"></span></span><br><span class="line"><span class="meta">nifi.monitor.long.running.task.threshold</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create automatic diagnostics when stopping/restarting NiFi.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable automatic diagnostic at shutdown.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.enabled</span>=<span class="string">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include verbose diagnostic information.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.verbose</span>=<span class="string">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The location of the diagnostics folder.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.directory</span>=<span class="string">./diagnostics</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The maximum number of files permitted in the directory. If the limit is exceeded, the oldest files are deleted.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.max.filecount</span>=<span class="string">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The diagnostics folder's maximum permitted size in bytes. If the limit is exceeded, the oldest files are deleted.</span></span><br><span class="line"><span class="meta">nifi.diagnostics.on.shutdown.max.directory.size</span>=<span class="string">10 MB</span></span><br></pre></td></tr></table></figure><h3 id="conf-zookeeper-properties"><a href="#conf-zookeeper-properties" class="headerlink" title="conf/zookeeper.properties"></a>conf/zookeeper.properties</h3><p>端口和servers配置<br><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210340030.png" alt="image-20220329210340030" style="zoom:50%;"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">clientPort</span>=<span class="string">12181</span></span><br><span class="line"><span class="attr">initLimit</span>=<span class="string">10</span></span><br><span class="line"><span class="meta">autopurge.purgeInterval</span>=<span class="string">24</span></span><br><span class="line"><span class="attr">syncLimit</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">tickTime</span>=<span class="string">2000</span></span><br><span class="line"><span class="attr">dataDir</span>=<span class="string">./state/zookeeper</span></span><br><span class="line"><span class="meta">autopurge.snapRetainCount</span>=<span class="string">30</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Embedded/distributed ZK TLS connection support can be activated by setting these properties at minimum:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># secureClientPort=2281</span></span><br><span class="line"><span class="comment"># serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Most TLS configurations will set these values as well:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ssl.keyStore.location=/example/path/to/key-store.jks</span></span><br><span class="line"><span class="comment"># ssl.keyStore.password=change this value to the actual value in your installation</span></span><br><span class="line"><span class="comment"># ssl.trustStore.location=/example/path/to/trust-store.jks</span></span><br><span class="line"><span class="comment"># ssl.trustStore.password=change this value to the actual value in your installation</span></span><br><span class="line"><span class="comment"># ssl.hostnameVerification=false</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Note that many ZK parameters can set as Java system properties, refer to the ZK admin guide for details:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_configuration</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Other common settings:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># client.portUnification=true</span></span><br><span class="line"><span class="comment"># admin.enableServer=false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The server string has changed as of 3.5.5 and the client port is now specified at the end of the server string:</span></span><br><span class="line"><span class="comment"># https://zookeeper.apache.org/doc/r3.5.5/zookeeperReconfig.html#sc_reconfig_clientport</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Specifies the servers that are part of this zookeeper ensemble. For</span></span><br><span class="line"><span class="comment"># every NiFi instance running an embedded zookeeper, there needs to be</span></span><br><span class="line"><span class="comment"># a server entry below. Client port is now specified at the end of the string</span></span><br><span class="line"><span class="comment"># after a semi-colon.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For instance:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># server.1=nifi-node1-hostname:2888:3888;2181</span></span><br><span class="line"><span class="comment"># server.2=nifi-node2-hostname:2888:3888;2181</span></span><br><span class="line"><span class="comment"># server.3=nifi-node3-hostname:2888:3888;2181</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The index of the server corresponds to the myid file that gets created</span></span><br><span class="line"><span class="comment"># in the dataDir of each node running an embedded zookeeper. See the</span></span><br><span class="line"><span class="comment"># administration guide for more details.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="meta">server.1</span>=<span class="string">sleety.local:12888:13888;12181</span></span><br></pre></td></tr></table></figure><h3 id="conf-state-management-xml"><a href="#conf-state-management-xml" class="headerlink" title="conf/state-management.xml"></a>conf/state-management.xml</h3><p>配置zk-provider<br><img src="/IT/it-bigdata-dataflow-nifi-cluster-installation/image-20220329210545997.png" alt="image-20220329210545997" style="zoom:50%;"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml</span> <span class="string">version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span><br><span class="line"><span class="attr">&lt;!--</span></span><br><span class="line">  <span class="attr">Licensed</span> <span class="string">to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line">  <span class="attr">contributor</span> <span class="string">license agreements.  See the NOTICE file distributed with</span></span><br><span class="line">  <span class="attr">this</span> <span class="string">work for additional information regarding copyright ownership.</span></span><br><span class="line">  <span class="attr">The</span> <span class="string">ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line">  <span class="meta">(the</span> <span class="string">"License"); you may not use this file except in compliance with</span></span><br><span class="line">  <span class="attr">the</span> <span class="string">License.  You may obtain a copy of the License at</span></span><br><span class="line">      <span class="attr">http</span>:<span class="string">//www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line">  <span class="attr">Unless</span> <span class="string">required by applicable law or agreed to in writing, software</span></span><br><span class="line">  <span class="attr">distributed</span> <span class="string">under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line">  <span class="attr">WITHOUT</span> <span class="string">WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line">  <span class="attr">See</span> <span class="string">the License for the specific language governing permissions and</span></span><br><span class="line">  <span class="attr">limitations</span> <span class="string">under the License.</span></span><br><span class="line"><span class="attr">--&gt;</span></span><br><span class="line"><span class="attr">&lt;!--</span></span><br><span class="line">  <span class="attr">This</span> <span class="string">file provides a mechanism for defining and configuring the State Providers</span></span><br><span class="line">  <span class="attr">that</span> <span class="string">should be used for storing state locally and across a NiFi cluster. In order</span></span><br><span class="line">  <span class="attr">to</span> <span class="string">use a specific provider, it must be configured here and its identifier</span></span><br><span class="line">  <span class="attr">must</span> <span class="string">be specified in the nifi.properties file.</span></span><br><span class="line"><span class="attr">--&gt;</span></span><br><span class="line"><span class="attr">&lt;stateManagement&gt;</span></span><br><span class="line">    <span class="attr">&lt;!--</span></span><br><span class="line">        <span class="attr">State</span> <span class="string">Provider that stores state locally in a configurable directory. This Provider requires the following properties:</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Directory</span> <span class="string">- the directory to store components' state in. If the directory being used is a sub-directory of the NiFi installation, it</span></span><br><span class="line">                    <span class="attr">is</span> <span class="string">important that the directory be copied over to the new version when upgrading NiFi.</span></span><br><span class="line">        <span class="attr">Always</span> <span class="string">Sync - If set to true, any change to the repository will be synchronized to the disk, meaning that NiFi will ask the operating system not to cache the information. This is very</span></span><br><span class="line">                <span class="attr">expensive</span> <span class="string">and can significantly reduce NiFi performance. However, if it is false, there could be the potential for data loss if either there is a sudden power loss or the</span></span><br><span class="line">                <span class="attr">operating</span> <span class="string">system crashes. The default value is false.</span></span><br><span class="line">        <span class="attr">Partitions</span> <span class="string">- The number of partitions.</span></span><br><span class="line">        <span class="attr">Checkpoint</span> <span class="string">Interval - The amount of time between checkpoints.</span></span><br><span class="line">     <span class="attr">--&gt;</span></span><br><span class="line">    <span class="attr">&lt;local-provider&gt;</span></span><br><span class="line">        <span class="attr">&lt;id&gt;local-provider&lt;/id&gt;</span></span><br><span class="line">        <span class="attr">&lt;class&gt;org.apache.nifi.controller.state.providers.local.WriteAheadLocalStateProvider&lt;/class&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Directory"&gt;./state/local&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Always Sync"&gt;false&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Partitions"&gt;16&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Checkpoint Interval"&gt;2 mins&lt;/property&gt;</span></span><br><span class="line">    <span class="attr">&lt;/local-provider&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;!--</span></span><br><span class="line">        <span class="attr">State</span> <span class="string">Provider that is used to store state in ZooKeeper. This Provider requires the following properties:</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Root</span> <span class="string">Node - the root node in ZooKeeper where state should be stored. The default is '/nifi', but it is advisable to change this to a different value if not using</span></span><br><span class="line">                   <span class="attr">the</span> <span class="string">embedded ZooKeeper server and if multiple NiFi instances may all be using the same ZooKeeper Server.</span></span><br><span class="line">                   </span><br><span class="line">        <span class="attr">Connect</span> <span class="string">String - A comma-separated list of host:port pairs to connect to ZooKeeper. For example, myhost.mydomain:2181,host2.mydomain:5555,host3:6666</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Session</span> <span class="string">Timeout - Specifies how long this instance of NiFi is allowed to be disconnected from ZooKeeper before creating a new ZooKeeper Session. Default value is "30 seconds"</span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">Access</span> <span class="string">Control - Specifies which Access Controls will be applied to the ZooKeeper ZNodes that are created by this State Provider. This value must be set to one of:</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Open  : ZNodes will be open to any ZooKeeper client.</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">CreatorOnly  : ZNodes will be accessible only by the creator. The creator will have full access to create children, read, write, delete, and administer the ZNodes.</span></span><br><span class="line">                                             <span class="attr">This</span> <span class="string">option is available only if access to ZooKeeper is secured via Kerberos or if a Username and Password are set.</span></span><br><span class="line">    <span class="attr">--&gt;</span></span><br><span class="line">    <span class="attr">&lt;cluster-provider&gt;</span></span><br><span class="line">        <span class="attr">&lt;id&gt;zk-provider&lt;/id&gt;</span></span><br><span class="line">        <span class="attr">&lt;class&gt;org.apache.nifi.controller.state.providers.zookeeper.ZooKeeperStateProvider&lt;/class&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Connect String"&gt;sleety.local:12181&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Root Node"&gt;/nifi&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Session Timeout"&gt;10 seconds&lt;/property&gt;</span></span><br><span class="line">        <span class="meta">&lt;property</span> <span class="string">name="Access Control"&gt;Open&lt;/property&gt;</span></span><br><span class="line">    <span class="attr">&lt;/cluster-provider&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">&lt;!--</span></span><br><span class="line">        <span class="attr">Cluster</span> <span class="string">State Provider that stores state in Redis. This can be used as an alternative to the ZooKeeper State Provider.</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">This</span> <span class="string">provider requires the following properties:</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Redis</span> <span class="string">Mode - The type of Redis instance:</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Standalone</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Sentinel</span></span><br><span class="line">                            <span class="meta">-</span> <span class="string">Cluster (currently not supported for state-management due to use of WATCH command which Redis does not support in clustered mode)</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Connection</span> <span class="string">String - The connection string for Redis.</span></span><br><span class="line">                        <span class="meta">-</span> <span class="string">In a standalone instance this value will be of the form hostname:port.</span></span><br><span class="line">                        <span class="meta">-</span> <span class="string">In a sentinel instance this value will be the comma-separated list of sentinels, such as host1:port1,host2:port2,host3:port3.</span></span><br><span class="line">                        <span class="meta">-</span> <span class="string">In a clustered instance this value will be the comma-separated list of cluster masters, such as host1:port,host2:port,host3:port.</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">This</span> <span class="string">provider has the following optional properties:</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Key</span> <span class="string">Prefix - The prefix for each key stored by this state provider. When sharing a single Redis across multiple NiFi instances, setting a unique</span></span><br><span class="line">                        <span class="attr">value</span> <span class="string">for the Key Prefix will make it easier to identify which instances the keys came from (default nifi/components/).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Database</span> <span class="string">Index - The database index to be used by connections created from this connection pool.</span></span><br><span class="line">                        <span class="attr">See</span> <span class="string">the databases property in redis.conf, by default databases 0-15 will be available.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Communication</span> <span class="string">Timeout - The timeout to use when attempting to communicate with Redis.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Cluster</span> <span class="string">Max Redirects - The maximum number of redirects that can be performed when clustered.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Sentinel</span> <span class="string">Master - The name of the sentinel master, require when Mode is set to Sentinel.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Password</span> <span class="string">- The password used to authenticate to the Redis server. See the requirepass property in redis.conf.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Enable</span> <span class="string">TLS - If true, the Redis connection will be configured to use TLS, using the keystore and truststore settings configured in</span></span><br><span class="line">                    <span class="meta">nifi.properties.</span>  <span class="string">This means that a TLS-enabled Redis connection is only possible if the Apache NiFi instance is running in secure mode.</span></span><br><span class="line">                    <span class="attr">If</span> <span class="string">this property is false, an insecure Redis connection will be used even if the Apache NiFi instance is secure (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Max Total - The maximum number of connections that can be allocated by the pool (checked out to clients, or idle awaiting checkout).</span></span><br><span class="line">                        <span class="attr">A</span> <span class="string">negative value indicates that there is no limit.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Max Idle - The maximum number of idle connections that can be held in the pool, or a negative value if there is no limit.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Min Idle - The target for the minimum number of idle connections to maintain in the pool. If the configured value of Min Idle is</span></span><br><span class="line">                    <span class="attr">greater</span> <span class="string">than the configured value for Max Idle, then the value of Max Idle will be used instead.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Block When Exhausted - Whether or not clients should block and wait when trying to obtain a connection from the pool when the pool</span></span><br><span class="line">                    <span class="attr">has</span> <span class="string">no available connections. Setting this to false means an error will occur immediately when a client requests a connection and</span></span><br><span class="line">                    <span class="attr">none</span> <span class="string">are available.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Max Wait Time - The amount of time to wait for an available connection when Block When Exhausted is set to true.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Min Evictable Idle Time - The minimum amount of time an object may sit idle in the pool before it is eligible for eviction.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Time Between Eviction Runs - The amount of time between attempting to evict idle connections from the pool.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Num Tests Per Eviction Run - The number of connections to tests per eviction attempt. A negative value indicates to test all connections.</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test On Create - Whether or not connections should be tested upon creation (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test On Borrow - Whether or not connections should be tested upon borrowing from the pool (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test On Return - Whether or not connections should be tested upon returning to the pool (default false).</span></span><br><span class="line"></span><br><span class="line">            <span class="attr">Pool</span> <span class="string">- Test While Idle - Whether or not connections should be tested while idle (default true).</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">&lt;cluster-provider&gt;</span></span><br><span class="line">            <span class="attr">&lt;id&gt;redis-provider&lt;/id&gt;</span></span><br><span class="line">            <span class="attr">&lt;class&gt;org.apache.nifi.redis.state.RedisStateProvider&lt;/class&gt;</span></span><br><span class="line">            <span class="meta">&lt;property</span> <span class="string">name="Redis Mode"&gt;Standalone&lt;/property&gt;</span></span><br><span class="line">            <span class="meta">&lt;property</span> <span class="string">name="Connection String"&gt;localhost:6379&lt;/property&gt;</span></span><br><span class="line">        <span class="attr">&lt;/cluster-provider&gt;</span></span><br><span class="line">    <span class="attr">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&lt;/stateManagement&gt;</span></span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul><li>ERROR [main] o.a.nifi.properties.NiFiPropertiesLoader Clustered Configuration Found: Shared Sensitive Properties Key [nifi.sensitive.props.key] required for cluster nodes</li></ul><blockquote><p>设置<strong>nifi.sensitive.props.key</strong></p></blockquote><ul><li>nested exception is org.apache.nifi.encrypt.EncryptionException: Key Password length less than required [12]</li></ul><blockquote><p><strong>nifi.sensitive.props.key</strong>长度需要12位以上</p></blockquote><ul><li>ERROR [main] org.apache.nifi.web.server.JettyServer NiFi only supports one mode of HTTP or HTTPS operation, not both simultaneously. Check the nifi.properties file and ensure that either the HTTP hostname and port or the HTTPS hostname and port are empty</li></ul><blockquote><p><strong>nifi.web.http.host/port</strong>与<strong>nifi.web.https.host/port</strong>二选一</p></blockquote><ul><li>ERROR [main] org.apache.nifi.NiFi Failure to launch NiFi org.xerial.snappy.SnappyError: [FAILED_TO_LOAD_NATIVE_LIBRARY] Unable to make protected final java.lang.Class java.lang.ClassLoader.defineClass(java.lang.String,byte[],int,int,java.security.ProtectionDomain) throws java.lang.ClassFormatError accessible: module java.base does not “opens java.lang” to unnamed module @729feae8</li></ul><blockquote><p>java版本问题，设置为nifi所支持的jdk版本</p></blockquote><ul><li>nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name ‘flowController’: FactoryBean threw exception on object creation; nested exception is java.lang.IllegalStateException: Unable to initialize Flow because NiFi was configured to start an Embedded Zookeeper server but failed to do so</li></ul><blockquote><p>检查zookeeper配置conf/zookeeper.properties</p><p>例如clientPort和server.N配置</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Nifi集群HTTP模式安装时遇到的一些问题记录集&lt;/p&gt;
&lt;p&gt;官网：&lt;a href=&quot;https://nifi.apache.org/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Apache NiFi&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;集群配置文档：&lt;a href=&quot;https://nifi.apache.org/docs/nifi-docs/html/administration-guide.html#clustering&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;NiFi System Administrator’s Guide (apache.org)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
    <category term="dataflow" scheme="https://lianyouli.gitee.io/tags/dataflow/"/>
    
    <category term="nifi" scheme="https://lianyouli.gitee.io/tags/nifi/"/>
    
  </entry>
  
  <entry>
    <title>hive - lateral view使用事例</title>
    <link href="https://lianyouli.gitee.io/IT/it-bigdata-hive-lateralview/"/>
    <id>https://lianyouli.gitee.io/IT/it-bigdata-hive-lateralview/</id>
    <published>2022-02-13T05:18:24.000Z</published>
    <updated>2022-02-13T06:02:45.586Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>lateral view在处理拆分一列多值的情况非常有用，例如array，map等数据拆分。</p></blockquote><a id="more"></a><ol><li><p>创建一个专门用户hive language manual的数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> langmanual;</span><br><span class="line"><span class="keyword">use</span> langmanual;</span><br></pre></td></tr></table></figure></li><li><p>创建一个lateral view专属表： pageads</p></li></ol><ul><li><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+LateralView" target="_blank" rel="noopener">lateral view</a></p></li><li><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF#LanguageManualUDF-Built-inTable-GeneratingFunctions(UDTF)" target="_blank" rel="noopener">Built-in Table-Generating Functions[UDTF]</a></p></li><li><p>syntax [改进版本]</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lateralView: LATERAL VIEW [outer] udtf(expression) tableAlias AS columnAlias (',' columnAlias)*</span><br><span class="line">fromClause: FROM baseTable (',' lateralView)*</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> pageads;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> pageAds</span><br><span class="line">( pageid <span class="keyword">string</span>, </span><br><span class="line">adid_list <span class="built_in">array</span>&lt;<span class="built_in">int</span>&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ul><ol start="3"><li><p>插入两条数据</p><blockquote><p>array关键字</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds <span class="keyword">values</span> (<span class="string">'front-page'</span>, <span class="built_in">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds <span class="keyword">values</span> (<span class="string">'contact-page'</span>, <span class="built_in">array</span>(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure></li><li><p>查看数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pageads ;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|</span><br><span class="line">------------|---------|</span><br><span class="line">front-page  |[1,2,3]  |</span><br><span class="line">contact-page|[3,4,5]  |</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>使用lateral view 拆分广告id列表</p><blockquote><p>多个值转换成多行</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">select</span> pageid, adid </span><br><span class="line"><span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid|</span><br><span class="line">------------|----|</span><br><span class="line">front-page  |   1|</span><br><span class="line">front-page  |   2|</span><br><span class="line">front-page  |   3|</span><br><span class="line">contact-page|   3|</span><br><span class="line">contact-page|   4|</span><br><span class="line">contact-page|   5|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>lateral view拆分成多个字段：adidx, adid [index，value]。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pageid, adidx, adid <span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> posexplode(adid_list) adTable <span class="keyword">as</span> adidx, adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adidx|adid|</span><br><span class="line">------------|-----|----|</span><br><span class="line">front-page  |    0|   1|</span><br><span class="line">front-page  |    1|   2|</span><br><span class="line">front-page  |    2|   3|</span><br><span class="line">contact-page|    0|   3|</span><br><span class="line">contact-page|    1|   4|</span><br><span class="line">contact-page|    2|   5|</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>插入adid_list为null的记录</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds(pageid) <span class="keyword">values</span> (<span class="string">'link-page'</span>);</span><br></pre></td></tr></table></figure></li><li><p>查看记录</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pageads ;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| pageid       | adid_list |</span><br><span class="line">| ------------ | --------- |</span><br><span class="line">| front-page   | [1,2,3]   |</span><br><span class="line">| contact-page | [3,4,5]   |</span><br><span class="line">| link-page    | NULL      |</span><br></pre></td></tr></table></figure></li><li><p>查看lateral view针对null记录的处理</p><blockquote><p>将会忽略 adid_list为NULL记录</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pageid, adid </span><br><span class="line"><span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* </span><br><span class="line">pageid      |adid|</span><br><span class="line">------------|----|</span><br><span class="line">front-page  |   1|</span><br><span class="line">front-page  |   2|</span><br><span class="line">front-page  |   3|</span><br><span class="line">contact-page|   3| </span><br><span class="line">contact-page|   4|</span><br><span class="line">contact-page|   5|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>查看lateral view outer 对null记录的处理</p><blockquote><p>加上outer关键字将会保留id_list为null的记录</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pageid, adid </span><br><span class="line"><span class="keyword">from</span> pageads <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* </span><br><span class="line">pageid      |adid|</span><br><span class="line">------------|----|</span><br><span class="line">front-page  |   1|</span><br><span class="line">front-page  |   2|</span><br><span class="line">front-page  |   3|</span><br><span class="line">contact-page|   3|</span><br><span class="line">contact-page|   4|</span><br><span class="line">contact-page|   5|</span><br><span class="line">link-page   |    |</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>lateral view 对group by的处理</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> adid, <span class="keyword">count</span>(adid)</span><br><span class="line"><span class="keyword">from</span> pageads  <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">adid|_c1|</span><br><span class="line">----|---|</span><br><span class="line"> 1|  1|</span><br><span class="line"> 2|  1|</span><br><span class="line"> 3|  2|</span><br><span class="line"> 4|  1|</span><br><span class="line"> 5|  1| </span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>多个多值字段： 新增一个array字段，visit_count</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> pageads  <span class="keyword">add</span> <span class="keyword">columns</span> (visit_count <span class="built_in">array</span>&lt;<span class="built_in">int</span>&gt; <span class="keyword">comment</span> <span class="string">'访问次数'</span>);</span><br></pre></td></tr></table></figure></li><li><p>造数&amp;查看数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pageAds <span class="keyword">values</span> (<span class="string">'footer-page'</span>, <span class="built_in">array</span>(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>), <span class="built_in">array</span>(<span class="number">700</span>, <span class="number">800</span>, <span class="number">900</span>));</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> pageads ;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|visit_count  |</span><br><span class="line">------------|---------|-------------|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |</span><br><span class="line">link-page   |NULL     |NULL         |</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>一个lateral view对另外一个字段的处理</p><blockquote><p>另外一字段和常规字段一样，都是不变。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> pageads </span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|visit_count  |adid|</span><br><span class="line">------------|---------|-------------|----|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   1|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   2|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   3|</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   3|</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   4|</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   5|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>多个lateral view</p><blockquote><p>会拆分成多对多情况，即full outer join中，排除lateral view 任何字段为null的记录。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> pageads </span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">explode</span>(visit_count)  vTable <span class="keyword">as</span> vct;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid     |adid_list|visit_count  |adid|vct|</span><br><span class="line">-----------|---------|-------------|----|---|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   7|700|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   7|800|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   7|900|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   8|700|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   8|800|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   8|900|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   9|700|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   9|800|</span><br><span class="line">footer-page|[7,8,9]  |[700,800,900]|   9|900|</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>多个lateral view outer</p><blockquote><p>会拆分成多对多情况，类似full outer join。</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * </span><br><span class="line"><span class="keyword">from</span> pageads </span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> <span class="keyword">explode</span>(adid_list) adTable <span class="keyword">as</span> adid</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> <span class="keyword">explode</span>(visit_count)  vTable <span class="keyword">as</span> vct;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line">pageid      |adid_list|visit_count  |adid|vct|</span><br><span class="line">------------|---------|-------------|----|---|</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   1|   |</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   2|   |</span><br><span class="line">front-page  |[1,2,3]  |NULL         |   3|   |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   3|   |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   4|   |</span><br><span class="line">contact-page|[3,4,5]  |NULL         |   5|   |</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|700|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|800|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   7|900|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|700|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|800|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   8|900|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|700|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|800|</span><br><span class="line">footer-page |[7,8,9]  |[700,800,900]|   9|900|</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;lateral view在处理拆分一列多值的情况非常有用，例如array，map等数据拆分。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    
    <category term="lateral" scheme="https://lianyouli.gitee.io/tags/lateral/"/>
    
    <category term="lateralview" scheme="https://lianyouli.gitee.io/tags/lateralview/"/>
    
    <category term="hive" scheme="https://lianyouli.gitee.io/tags/hive/"/>
    
    <category term="bigdata" scheme="https://lianyouli.gitee.io/tags/bigdata/"/>
    
  </entry>
  
  <entry>
    <title>259号文</title>
    <link href="https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-no259/"/>
    <id>https://lianyouli.gitee.io/Payment/%E6%B3%95%E8%A7%84/rules-pboc-no259/</id>
    <published>2022-01-23T08:49:58.000Z</published>
    <updated>2022-02-13T06:02:41.988Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="http://www.pbc.gov.cn/tiaofasi/144941/3581332/4359567/index.html" target="_blank" rel="noopener">259号文</a>是既21号之后针对终端再次补充，更加严格了，当然此次也针对了条码支付终端相关的要求。足以看出终端的重要性，也侧面反映了现在洗钱、涉黑涉黄等非法行为泛滥。</p><p>259号文是提纲挈领的法规，那么中国支付清算协会关于印发<a href="http://www.pcac.org.cn/eportal/ui?pageId=598041&articleKey=614091&columnId=595027" target="_blank" rel="noopener">《特约商户巡检指引》</a>的通知就针对特约商户明确了巡检的方式、周期、内容和频率等内容。</p></blockquote><a id="more"></a><h1 id="259号文"><a href="#259号文" class="headerlink" title="259号文"></a>259号文</h1><p>支付受理终端业务管理其大多数内容还是延续21号文，其总结起来就是<strong>1：1：1</strong>，即：</p><blockquote><p>一台银行卡受理终端对应一个终端序列号，对应一个特约商户</p></blockquote><p>条码支付受理终端及相关业务要求了 条码的场景和用途。</p><p>例如个人静态收款条码不可以远程非面对面收款，这个也有效扼制了现在微信支付宝之类的跑分等洗钱行为。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://www.pbc.gov.cn/tiaofasi/144941/3581332/4359567/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;259号文&lt;/a&gt;是既21号之后针对终端再次补充，更加严格了，当然此次也针对了条码支付终端相关的要求。足以看出终端的重要性，也侧面反映了现在洗钱、涉黑涉黄等非法行为泛滥。&lt;/p&gt;
&lt;p&gt;259号文是提纲挈领的法规，那么中国支付清算协会关于印发&lt;a href=&quot;http://www.pcac.org.cn/eportal/ui?pageId=598041&amp;articleKey=614091&amp;columnId=595027&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;《特约商户巡检指引》&lt;/a&gt;的通知就针对特约商户明确了巡检的方式、周期、内容和频率等内容。&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/categories/Payment/"/>
    
    <category term="法规" scheme="https://lianyouli.gitee.io/categories/Payment/%E6%B3%95%E8%A7%84/"/>
    
    
    <category term="Payment" scheme="https://lianyouli.gitee.io/tags/Payment/"/>
    
    <category term="中国人民银行法规" scheme="https://lianyouli.gitee.io/tags/%E4%B8%AD%E5%9B%BD%E4%BA%BA%E6%B0%91%E9%93%B6%E8%A1%8C%E6%B3%95%E8%A7%84/"/>
    
    <category term="终端" scheme="https://lianyouli.gitee.io/tags/%E7%BB%88%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>docker jupyter nignix 400问题</title>
    <link href="https://lianyouli.gitee.io/IT/Issues/it-issue-jupyter-nignix-400/"/>
    <id>https://lianyouli.gitee.io/IT/Issues/it-issue-jupyter-nignix-400/</id>
    <published>2021-09-05T00:32:57.000Z</published>
    <updated>2022-05-08T23:08:08.122Z</updated>
    
    <content type="html"><![CDATA[<h1 id="jupyter-kernel一直连接不上服务器"><a href="#jupyter-kernel一直连接不上服务器" class="headerlink" title="jupyter kernel一直连接不上服务器"></a>jupyter kernel一直连接不上服务器</h1><blockquote><p> Docker上拉取了hortonworks/sandbox-hdp 和 hortonworks/sandbox-proxy, 在sandbox-hdp上安装了jupyter来写一些pyspark的代码。不过jupyter kernel一直连接不上服务器</p></blockquote><a id="more"></a><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>其中sandbox-proxy做了如下配置</p><h3 id="HDP3-sandbox-proxy-conf-d-http-hdp-conf"><a href="#HDP3-sandbox-proxy-conf-d-http-hdp-conf" class="headerlink" title="HDP3/sandbox/proxy/conf.d/http-hdp.conf"></a>HDP3/sandbox/proxy/conf.d/http-hdp.conf</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># jupyter notebook </span><br><span class="line">server &#123;</span><br><span class="line">  listen 9999;</span><br><span class="line">  server_name sandbox-hdp.hortonworks.com;</span><br><span class="line">  location / &#123;</span><br><span class="line">                proxy_pass http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host $host;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HDP3-sandbox-proxy-proxy-deploy-sh"><a href="#HDP3-sandbox-proxy-proxy-deploy-sh" class="headerlink" title="HDP3/sandbox/proxy/proxy-deploy.sh"></a>HDP3/sandbox/proxy/proxy-deploy.sh</h3><p>新增一行-p 9999:9999 \</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">!/usr/bin/env bash</span><br><span class="line">docker rm -f sandbox-proxy 2&gt;/dev/null</span><br><span class="line">docker run --name sandbox-proxy --network=cda \</span><br><span class="line">-v /Users/arthur/Software/Docker/HDP3/assets/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /Users/arthur/Software/Docker/HDP3/sandbox/proxy/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /Users/arthur/Software/Docker/HDP3/sandbox/proxy/conf.stream.d:/etc/nginx/conf.stream.d \</span><br><span class="line">-p 1080:1080 \</span><br><span class="line">-p 9999:9999 \</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="浏览器访问，jupyter后台错误日志"><a href="#浏览器访问，jupyter后台错误日志" class="headerlink" title="浏览器访问，jupyter后台错误日志"></a>浏览器访问，jupyter后台错误日志</h2><p>NotebookApp] 400 GET /api/kernels/</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2<span class="comment"># jupyter-notebook --allow-root</span></span><br><span class="line">[W 23:05:07.281 NotebookApp] Config option `use_redirect_file` not recognized by `NotebookApp`.</span><br><span class="line">[I 23:05:07.462 NotebookApp] Serving notebooks from <span class="built_in">local</span> directory: /root/notebook</span><br><span class="line">[I 23:05:07.462 NotebookApp] The Jupyter Notebook is running at:</span><br><span class="line">[I 23:05:07.462 NotebookApp] http://sandbox-hdp.hortonworks.com:9999/?token=9c46a4fbfa4a432be0275f2381cd24543ba763566c0cc8fe</span><br><span class="line">[I 23:05:07.462 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[W 23:05:07.466 NotebookApp] No web browser found: could not locate runnable browser.</span><br><span class="line">[C 23:05:07.467 NotebookApp] </span><br><span class="line"></span><br><span class="line">    To access the notebook, open this file <span class="keyword">in</span> a browser:</span><br><span class="line">        file:///root/.<span class="built_in">local</span>/share/jupyter/runtime/nbserver-38953-open.html</span><br><span class="line">    Or copy and paste one of these URLs:</span><br><span class="line">        http://sandbox-hdp.hortonworks.com:9999/?token=9c46a4fbfa4a432be0275f2381cd24543ba763566c0cc8fe</span><br><span class="line">[E 23:05:14.835 NotebookApp] Could not open static file <span class="string">''</span></span><br><span class="line">[W 23:05:15.184 NotebookApp] 404 GET /static/components/react/react-dom.production.min.js (172.18.0.2) 14.91ms referer=http://sandbox-hdp.hortonworks.com:9999/notebooks/Untitled1.ipynb?kernel_name=python2</span><br><span class="line">[I 23:05:15.786 NotebookApp] Kernel started: eae1b42e-120e-4d69-9266-c06432677d5a</span><br><span class="line">[I 23:05:16.372 NotebookApp] Adapting to protocol v5.1 <span class="keyword">for</span> kernel eae1b42e-120e-4d69-9266-c06432677d5a</span><br><span class="line">[W 23:05:16.375 NotebookApp] 400 GET /api/kernels/eae1b42e-120e-4d69-9266-c06432677d5a/channels?session_id=0fea190ca5e94abd89500020f29a66fb (172.18.0.2) 521.39ms referer=None</span><br><span class="line">[W 23:05:17.437 NotebookApp] Replacing stale connection: eae1b42e-120e-4d69-9266-c06432677d5a:0fea190ca5e94abd89500020f29a66fb</span><br><span class="line">[W 23:05:18.140 NotebookApp] 404 GET /static/components/react/react-dom.production.min.js (172.18.0.2) 6.56ms referer=http://sandbox-hdp.hortonworks.com:9999/tree?token=9c46a4fbfa4a432be0275f2381cd24543ba763566c0cc8fe</span><br><span class="line">[W 23:05:20.220 NotebookApp] 404 GET /static/components/react/react-dom.production.min.js (172.18.0.2) 4.17ms referer=http://sandbox-hdp.hortonworks.com:9999/notebooks/Untitled1.ipynb</span><br><span class="line">[I 23:05:20.443 NotebookApp] Adapting to protocol v5.1 <span class="keyword">for</span> kernel eae1b42e-120e-4d69-9266-c06432677d5a</span><br><span class="line">[W 23:05:20.444 NotebookApp] 400 GET /api/kernels/eae1b42e-120e-4d69-9266-c06432677d5a/channels?session_id=ed975e0dfee44503a3a2405dac3718cc (172.18.0.2) 3.54ms referer=None</span><br><span class="line">[W 23:05:21.516 NotebookApp] Replacing stale connection: eae1b42e-120e-4d69-9266-c06432677d5a:ed975e0dfee44503a3a2405dac3718cc</span><br><span class="line">[W 23:06:23.550 NotebookApp] Replacing stale connection: eae1b42e-120e-4d69-9266-c06432677d5a:ed975e0dfee44503a3a2405dac3718cc</span><br></pre></td></tr></table></figure><h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><p><a href="https://www.cnblogs.com/ycc1/p/14229534.html" target="_blank" rel="noopener">Virya的博客</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jupyter notebook</span></span><br><span class="line">server &#123;</span><br><span class="line">  listen 9999;</span><br><span class="line">  server_name sandbox-hdp.hortonworks.com;</span><br><span class="line">  location / &#123;</span><br><span class="line">                proxy_pass http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host <span class="variable">$host</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  location ~ /api/kernels/ &#123;</span><br><span class="line">                proxy_pass            http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host <span class="variable">$host</span>;</span><br><span class="line"></span><br><span class="line">                proxy_http_version    1.1;  <span class="comment"># websocket support</span></span><br><span class="line">                proxy_set_header      Upgrade <span class="string">"websocket"</span>;</span><br><span class="line">                proxy_set_header      Connection <span class="string">"Upgrade"</span>;</span><br><span class="line">                proxy_read_timeout    86400;</span><br><span class="line">        &#125;</span><br><span class="line">  location ~ /terminals/ &#123;</span><br><span class="line">                proxy_pass            http://sandbox-hdp:9999;</span><br><span class="line">                proxy_set_header      Host <span class="variable">$host</span>;</span><br><span class="line"></span><br><span class="line">                proxy_http_version    1.1;  <span class="comment"># websocket support</span></span><br><span class="line">                proxy_set_header      Upgrade <span class="string">"websocket"</span>;</span><br><span class="line">                proxy_set_header      Connection <span class="string">"Upgrade"</span>;</span><br><span class="line">                proxy_read_timeout    86400;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;jupyter-kernel一直连接不上服务器&quot;&gt;&lt;a href=&quot;#jupyter-kernel一直连接不上服务器&quot; class=&quot;headerlink&quot; title=&quot;jupyter kernel一直连接不上服务器&quot;&gt;&lt;/a&gt;jupyter kernel一直连接不上服务器&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt; Docker上拉取了hortonworks/sandbox-hdp 和 hortonworks/sandbox-proxy, 在sandbox-hdp上安装了jupyter来写一些pyspark的代码。不过jupyter kernel一直连接不上服务器&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="IT" scheme="https://lianyouli.gitee.io/categories/IT/"/>
    
    <category term="Issues" scheme="https://lianyouli.gitee.io/categories/IT/Issues/"/>
    
    
    <category term="jupyter" scheme="https://lianyouli.gitee.io/tags/jupyter/"/>
    
    <category term="nginx" scheme="https://lianyouli.gitee.io/tags/nginx/"/>
    
  </entry>
  
</feed>
